
local uis = cloneref(game:GetService("UserInputService"))
local players = cloneref(game:GetService("Players"))
local ws = cloneref(game:GetService("Workspace"))
local http_service = cloneref(game:GetService("HttpService"))
local gui_service = cloneref(game:GetService("GuiService"))
local lighting = cloneref(game:GetService("Lighting"))
local run = cloneref(game:GetService("RunService"))
local stats = cloneref(game:GetService("Stats"))
local coregui = cloneref(game:GetService("CoreGui"))
local debris = cloneref(game:GetService("Debris"))
local tween_service = cloneref(game:GetService("TweenService"))
local sound_service = cloneref(game:GetService("SoundService"))
local starter_gui = cloneref(game:GetService("StarterGui"))
local rs = cloneref(game:GetService("ReplicatedStorage"))
local cas = cloneref(game:GetService("ContextActionService"))

local vec2 = Vector2.new
local vec3 = Vector3.new
local dim2 = UDim2.new
local dim = UDim.new 
local rect = Rect.new
local cfr = CFrame.new
local empty_cfr = cfr()
local point_object_space = empty_cfr.PointToObjectSpace
local angle = CFrame.Angles
local dim_offset = UDim2.fromOffset

local color = Color3.new
local hsv = Color3.fromHSV
local rgb = Color3.fromRGB
local hex = Color3.fromHex
local rgbseq = ColorSequence.new
 local rgbkey = ColorSequenceKeypoint.new
 local numseq = NumberSequence.new
 local numkey = NumberSequenceKeypoint.new

 


local IsCameraLockActive, IsRaycastActive, DeathCheckEnabled = false, false, false
local TargetFOV, selectedPart = 65, "Head"
local FOVCircle, FOVOutline, CurrentTarget
local FOVMiniDots = {}
local FOVColor, FOVAlpha = Color3.fromRGB(255,255,255), 1
local SilentTargetFOV = 65
local SilentFOVCircle, SilentFOVOutline
local SilentFOVMiniDots = {}
local SilentFOVColor, SilentFOVAlpha = Color3.fromRGB(255,255,255), 1
local DottedParams = { Num_Dots = 80, Dotted_Size = 1.5 }
local leftMouseDown = false
local SilentRate = 0.1
local USE_NAMECALL_HOOK = true
local shotRemote = nil
local flags = {}
local library 
local lp = players.LocalPlayer
local camera = ws.CurrentCamera
local SCPESPCache = {}
local lastSCPScan = 0
local SCPNameCache = {}
local SCPCandidateCache = {}

local function updateSCPCandidate(descendant, adding)
    if not descendant:IsA("Model") then return end
    local name = string.lower(descendant.Name)
    if string.find(name, "scp") then
        -- Filter out useless visuals (static props, signs, terminals, cameras, etc.)
        if name:find("sign") or name:find("terminal") or name:find("button") or name:find("door") or name:find("class") or name:find("containment") or name:find("tesla") or name:find("camera") or name:find("bowl") or name:find("cc") or name:find("pipe") or name:find("966") or name:find("299") or name:find("2950") or name:find("066") or name:find("023") or (name:find("049") and not name:find("049%-2")) or name:find("082") or name:find("180") or name:find("076") then
            if adding then
                SCPCandidateCache[descendant] = nil -- Ensure it's removed if it was there
            end
            return
        end

        if adding then
            SCPCandidateCache[descendant] = true
        else
            SCPCandidateCache[descendant] = nil
        end
    end
end
ws.DescendantAdded:Connect(function(d) updateSCPCandidate(d, true) end)
ws.DescendantRemoving:Connect(function(d) updateSCPCandidate(d, false) end)
task.spawn(function()
    local descendants = ws:GetDescendants()
    local batchSize = 1000
    for i, d in ipairs(descendants) do
        updateSCPCandidate(d, true)
        if i % batchSize == 0 then task.wait() end
    end
end)

local VisualsTextFontName = "SourceSansBold"
local VisualsTextSize = 12
local oldLightingSettings = {
    Brightness = lighting.Brightness,
    ClockTime = lighting.ClockTime,
    FogEnd = lighting.FogEnd,
    GlobalShadows = lighting.GlobalShadows,
    OutdoorAmbient = lighting.OutdoorAmbient
}


local ESP_SETTINGS = { SkeletonColor = Color3.fromRGB(255,255,255), Enabled = true, ShowSkeleton = false }
local ESPRenderDistance = math.huge
local SCPRenderDistance = 5000


local RoleColors = {
    ["Class - D"] = Color3.fromRGB(255,136,0),
    ["Security Department"] = Color3.fromRGB(128,128,128),
    ["Mobile Task Force"] = Color3.fromRGB(0,102,255),
    ["Chaos Insurgency"] = Color3.fromRGB(36,36,36),
    ["Scientific Department"] = Color3.fromRGB(255,255,255),
    ["Medical Department"] = Color3.fromRGB(173,216,230),
    ["Administrative Department"] = Color3.fromRGB(0,128,0),
    ["Intelligence Agency"] = Color3.fromRGB(255,117,117),
    ["Internal Security Department"] = Color3.fromRGB(201,33,33),
    ["Rapid Response Team"] = Color3.fromRGB(255,188,188),
}


local function createDraw(cls, props)
    local d = Drawing.new(cls)
    for k,v in pairs(props) do d[k] = v end
    return d
end

local function updateDotted(dotsTable, center, radius, color, visible, numDots, dotSize)
    if not visible then
        for _, dot in pairs(dotsTable) do dot:Remove() end
        table.clear(dotsTable)
        return
    end
    
    -- Create missing dots
    if #dotsTable < numDots then
        for i = #dotsTable + 1, numDots do
            local dot = createDraw("Circle", {
                Filled = true,
                Transparency = 1,
                Thickness = 1,
                Visible = true
            })
            table.insert(dotsTable, dot)
        end
    end
    
    -- Remove excess dots
    if #dotsTable > numDots then
        for i = numDots + 1, #dotsTable do
            dotsTable[i]:Remove()
            dotsTable[i] = nil
        end
    end
    
    -- Update positions
    for i = 1, numDots do
        local dot = dotsTable[i]
        dot.Color = color
        dot.Radius = dotSize
        
        local angle = math.rad((i - 1) / numDots * 360)
        local offsetX = math.cos(angle) * radius
        local offsetY = math.sin(angle) * radius
        dot.Position = center + Vector2.new(offsetX, offsetY)
        dot.Visible = true
    end
end

local function GetBestCamlockTarget()
    if not lp.Character then return nil, nil, nil end
    local best, bd = nil, math.huge
    for _, p in ipairs(players:GetPlayers()) do
        if p ~= lp and ValidateTarget(lp, p) then
            local part = getPartSafe(p.Character, selectedPart) or getPartSafe(p.Character, "Head")
            if part then
                local sp, on = camera:WorldToViewportPoint(part.Position)
                if on then
                    local dist = (Vector2.new(sp.X, sp.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
                    if dist < TargetFOV * 5 and dist < bd then
                        if PerformLineOfSightCheck(p) then
                            best, bd = p, dist
                        end
                    end
                end
            end
        end
    end
    if best and best.Character then
        local tp = getPartSafe(best.Character, selectedPart) or getPartSafe(best.Character, "Head")
        if tp then
            return tp, tp.Position, best
        end
    end
    return nil, nil, nil
end

local function getPartSafe(char, name)
    if not char then return nil end
    if name == "Torso" then name = "UpperTorso" end
    local p = char:FindFirstChild(name)
    if not p then return nil end
    if p:IsA("Accessory") then
        return p:FindFirstChild("Handle")
    elseif p:IsA("BasePart") then
        return p
    end
    return nil
end

local function IsFriend(p) return lp and lp:IsFriendsWith(p.UserId) end
local function RetrievePlayerTeamName(p) return p.Team and p.Team.Name or "NoTeam" end
local function ResolveFont(name)
    if type(name) ~= "string" then return Enum.Font.SourceSansBold end
    
    -- Match buckets from DrawingFontFromName exactly
    
    -- Bucket 1: Tech/Retro -> Plex (Drawing) -> RobotoMono (Roblox)
    -- This ensures visual similarity to the Drawing "Plex" font
    if name == "Plex" or name == "Minecraftia" or name == "Pixel" or name == "Arcade" then 
        return Enum.Font.RobotoMono 
    end
    
    -- Bucket 2: Monospace -> Monospace (Drawing) -> Code (Roblox)
    if name == "RobotoMono" or name == "Code" then 
        return Enum.Font.Code 
    end
    
    -- Bucket 3: System -> System (Drawing) -> Arial (Roblox)
    if name == "System" then 
        return Enum.Font.Arial 
    end
    
    -- Bucket 4: Default -> UI (Drawing) -> SourceSansBold (Roblox)
    return Enum.Font.SourceSansBold
end

local function ValidateTarget(lp, tp)
    if flags.toggle_friend_check and IsFriend(tp) then return false end
    local tch = tp.Character
    if not tch then return false end
    if flags.toggle_forcefield_check and tch:FindFirstChildOfClass("ForceField") then return false end
    local hum = tch:FindFirstChildOfClass("Humanoid")
    if not hum or (flags.toggle_death_check and hum.Health <= 0) then return false end
    if not flags.toggle_team_check then
        return true
    end
    local lt, tt = RetrievePlayerTeamName(lp), RetrievePlayerTeamName(tp)
    local hostile = {}
    if lt == "Class - D" or lt == "Chaos Insurgency" then
        hostile = {
            ["Security Department"]=true,["Mobile Task Force"]=true,
            ["Internal Security Department"]=true,["Rapid Response Team"]=true,
            ["Scientific Department"]=true,["Medical Department"]=true,
            ["Administrative Department"]=true,["Intelligence Agency"]=true,
        }
    else
        hostile = { ["Class - D"]=true, ["Chaos Insurgency"]=true }
    end
    return hostile[tt] or false
end

local LOS_PARTS = {"Head", "UpperTorso"}
local LOS_PARAMS = RaycastParams.new()
LOS_PARAMS.FilterType = Enum.RaycastFilterType.Blacklist

local function PerformLineOfSightCheck(target)
    if not flags.toggle_raycast then return true end
    local origin = getPartSafe(lp.Character, "Head")
    if not origin then return false end

    LOS_PARAMS.FilterDescendantsInstances = {lp.Character}

    local char = target
    if target:IsA("Player") then char = target.Character end
    if not char then return false end

    local checkedAny = false
    -- Expanded list to include Torso and HumanoidRootPart explicitly for better SCP/R6 detection
    local checkParts = {"Head", "UpperTorso", "Torso", "HumanoidRootPart"}
    
    for _, name in ipairs(checkParts) do
        -- Direct FindFirstChild to avoid getPartSafe's renaming logic for Torso
        local part = char:FindFirstChild(name)
        if part and part:IsA("BasePart") then
            checkedAny = true
            local ray = ws:Raycast(origin.Position, part.Position - origin.Position, LOS_PARAMS)
            if not ray or ray.Instance == part or ray.Instance.Name == "Handle" or ray.Instance:IsDescendantOf(char) then
                return true
            end
        end
    end

    if not checkedAny then
        local part = char.PrimaryPart or char:FindFirstChild("HumanoidRootPart")
        if not part then
             for _, ch in ipairs(char:GetChildren()) do
                 if ch:IsA("BasePart") then part = ch break end
             end
        end
        
        if part then
            local ray = ws:Raycast(origin.Position, part.Position - origin.Position, LOS_PARAMS)
            if not ray or ray.Instance == part or ray.Instance.Name == "Handle" or ray.Instance:IsDescendantOf(char) then
                return true
            end
        end
    end

    return false
end

local function LockCameraToTargetPlayer()
    if not lp.Character then
        CurrentTarget = nil
        return
    end

    if flags.toggle_required_weapon then
        local tool = lp.Character:FindFirstChildOfClass("Tool")
        if not tool then
            CurrentTarget = nil
            return
        end
    end

    if flags.toggle_sticky_lock and CurrentTarget then
        local ct = CurrentTarget
        local ch = ct
        if ct:IsA("Player") then ch = ct.Character end
        
        if ch then
            local hum = ch:FindFirstChildOfClass("Humanoid")
            local isAlive = true
            if hum then isAlive = hum.Health > 0 end

            if isAlive then
                local tp = getPartSafe(ch, selectedPart) or ch.PrimaryPart or ch:FindFirstChild("Head") or ch:FindFirstChild("HumanoidRootPart")
                if not tp then
                     for _, child in ipairs(ch:GetChildren()) do
                         if child:IsA("BasePart") then tp = child break end
                     end
                end

                if tp then
                    local cf = camera.CFrame
                    local predictedPos = tp.Position
                    camera.CFrame = CFrame.new(cf.Position, predictedPos)
                    return
                end
            end
        end
        CurrentTarget = nil
    end

    local best, bd = nil, math.huge
    for _, p in ipairs(players:GetPlayers()) do
        if p ~= lp and ValidateTarget(lp, p) then
            local part = getPartSafe(p.Character, selectedPart)
            if part then
                local sp, on = camera:WorldToViewportPoint(part.Position)
                if on then
                    local dist = (Vector2.new(sp.X, sp.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
                    if dist < TargetFOV * 5 and dist < bd then
                        if PerformLineOfSightCheck(p) then
                            best, bd = p, dist
                        end
                    end
                end
            end
        end
    end

    -- Built-in SCP check (always active)
    for scpModel, _ in pairs(SCPCandidateCache) do
        if scpModel and scpModel.Parent then
            local scpName = string.lower(scpModel.Name)
            local allowed = false
            -- Only matches "SCP-049-2", "SCP-008-2", and "SCP-016-2" variants
            if scpName:find("scp[%s%-]*049[%s%-]*2") or scpName:find("scp[%s%-]*008[%s%-]*2") or scpName:find("scp[%s%-]*016[%s%-]*2") then
                allowed = true
            end

            if allowed then
                    local part = getPartSafe(scpModel, selectedPart) or scpModel.PrimaryPart or scpModel:FindFirstChild("HumanoidRootPart")
                    if not part then
                        for _, ch in ipairs(scpModel:GetChildren()) do
                            if ch:IsA("BasePart") then part = ch break end
                        end
                    end

                    local hum = scpModel:FindFirstChildOfClass("Humanoid")
                    local isAlive = true
                    if hum then
                        isAlive = hum.Health > 0
                    end

                    if part and isAlive then
                        local sp, on = camera:WorldToViewportPoint(part.Position)
                        if on then
                            local dist = (Vector2.new(sp.X, sp.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
                            if dist < TargetFOV * 5 and dist < bd then
                                if PerformLineOfSightCheck(scpModel) then
                                    best, bd = scpModel, dist
                                end
                            end
                        end
                    end
                end
            end
        end

    if best then
        local char = best
        if best:IsA("Player") then char = best.Character end

        local tp = getPartSafe(char, selectedPart) or char.PrimaryPart or char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
        if tp then
            local predictedPos = tp.Position

            local cf = camera.CFrame
            local targetLook = CFrame.new(cf.Position, predictedPos)
            camera.CFrame = CFrame.new(cf.Position, predictedPos)
            CurrentTarget = best
            return
        end
    end
    CurrentTarget = nil
end

local function SinkInput()
    return Enum.ContextActionResult.Sink
end



uis.InputBegan:Connect(function(input, gs)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and not gs then
        leftMouseDown = true
        task.spawn(function()
            while leftMouseDown and (flags.toggle_silent or false) and (flags.toggle_auto_aim or (not flags.toggle_auto_aim and flags.keybind_silent_aim and flags.keybind_silent_aim.active)) do
                local lpchar = lp.Character
                local head = lpchar and lpchar:FindFirstChild("Head")
                if not head then
                    break
                end
                local best, bd = nil, math.huge
                local camDir = camera.CFrame.LookVector
                for _, p in ipairs(players:GetPlayers()) do
                    if p ~= lp and ValidateTarget(lp, p) and p.Character and p.Character:FindFirstChild("Humanoid") then
                        local part = getPartSafe(p.Character, selectedPart) or getPartSafe(p.Character, "Head")
                        if part then
                            local dirTo = (part.Position - head.Position).Unit
                            local ang = math.acos(math.clamp(camDir:Dot(dirTo), -1, 1))
                            local maxAng = math.rad((SilentTargetFOV or 65) / 2)
                            if ang <= maxAng then
                                local dist = (part.Position - head.Position).Magnitude
                                if dist < bd then
                                    best, bd = p, dist
                                end
                            end
                        end
                    end
                end
                if best and best.Character then
                    local th = best.Character:FindFirstChild("Head")
                    if th then
                        local origin = head.Position
                        local targetPos = th.Position
                        local canFire = true
                        local dir = (targetPos - origin).Unit
                        local dist = (targetPos - origin).Magnitude
                        local rp = RaycastParams.new()
                        rp.FilterType = Enum.RaycastFilterType.Blacklist
                        rp.FilterDescendantsInstances = {lp.Character}
                        local rr = ws:Raycast(origin, dir * dist, rp)
                        if rr and rr.Instance and rr.Instance.Parent ~= best.Character and rr.Instance.Name ~= "Handle" then
                            canFire = false
                        end
                        if canFire then
                            
                        end
                    end
                end
                task.wait(SilentRate)
            end
        end)
    end
end)
uis.InputEnded:Connect(function(input, gs)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and not gs then
        leftMouseDown = false
    end
end)

local function GetBestSilentTarget()
    local lpchar = lp.Character
    local head = lpchar and lpchar:FindFirstChild("Head")
    if not head then
        return nil, nil
    end
    local best, bd = nil, math.huge
    local camDir = camera.CFrame.LookVector
    
    for _, p in ipairs(players:GetPlayers()) do
        -- Use ValidateTarget to ensure Team Check (and other checks) are applied exactly like Camlock
        if p ~= lp and ValidateTarget(lp, p) and p.Character and p.Character:FindFirstChild("Humanoid") then
            local part = getPartSafe(p.Character, selectedPart) or getPartSafe(p.Character, "Head")
            if part then
                local dirTo = (part.Position - head.Position).Unit
                local ang = math.acos(math.clamp(camDir:Dot(dirTo), -1, 1))
                local maxAng = math.rad((SilentTargetFOV or 65) / 2)
                
                if ang <= maxAng then
                    -- Check visibility INSIDE the loop (like Camlock) to find the best VISIBLE target
                    -- This prevents the aim from locking onto a wall-obscured player and doing nothing
                    if PerformLineOfSightCheck(p) then
                         local dist = (part.Position - head.Position).Magnitude
                         if dist < bd then
                             best, bd = p, dist
                         end
                    end
                end
            end
        end
    end
    
    if best and best.Character then
        local th = getPartSafe(best.Character, selectedPart) or getPartSafe(best.Character, "Head")
        if th then
            return th, th.Position
        end
    end
    return nil, nil
end


local function DeepRetargetTable(payload, targetPart, targetPos)
    local replacedPart = false
    local replacedPos = false
    local function visit(tbl)
        for k, v in pairs(tbl) do
            local t = typeof(v)
            if t == "Instance" and v:IsA("BasePart") and not replacedPart then
                tbl[k] = targetPart
                replacedPart = true
            elseif (t == "Vector3" or t == "CFrame") then
                local key = typeof(k) == "string" and string.lower(k) or ""
                local looksLikePos =
                    key:find("pos") or key:find("position") or key:find("hit") or key:find("target") or key:find("to")
                if looksLikePos or (replacedPart and not replacedPos) then
                    tbl[k] = (t == "CFrame") and CFrame.new(targetPos) or targetPos
                    replacedPos = true
                end
            elseif t == "table" then
                visit(v)
            end
            if replacedPart and replacedPos then
                return
            end
        end
    end
    if typeof(payload) == "table" then
        visit(payload)
    end
    return replacedPart or replacedPos
end

do
    if USE_NAMECALL_HOOK then
        -- print("Silent Aim Hook Initialized")
        local mt = getrawmetatable(game)
        local old_namecall = mt.__namecall
        setreadonly(mt, false)

        -- Using a regular function instead of newcclosure to prevent "no closure" errors on some executors
        mt.__namecall = function(self, ...)
            local args = {...}
            local method = getnamecallmethod()
            
            -- Debug: Print ALL RemoteEvent calls to find the right one
             if tostring(method) == "FireServer" and typeof(self) == "Instance" and self:IsA("RemoteEvent") then
                print("[SilentAim Debug] Remote:", self.Name, "Args:", unpack(args))
             end

            if typeof(self) == "Instance" and tostring(method) == "FireServer" and self.Name == "RemoteEvent" and (flags.toggle_silent or false) and ((flags.toggle_auto_aim and uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)) or (not flags.toggle_auto_aim and flags.keybind_silent_aim and flags.keybind_silent_aim.active)) then
                if (not checkcaller or not checkcaller()) then
                    local targetPart, targetPos = GetBestSilentTarget()
                    
                    -- Debug: Print if we found a target
                    if targetPart then print("[SilentAim Debug] Target Found:", targetPart.Name) end

                    if targetPart and targetPos then
                        local replaced = false
                        
                        -- Simple argument scanning (like Camlock logic)
                        -- Instead of deep recursive table scanning, we just check top-level arguments
                        -- This avoids "smart" logic that might be breaking specific game remotes
                        for i, v in ipairs(args) do
                            if typeof(v) == "Vector3" then
                                args[i] = targetPos
                                replaced = true
                            elseif typeof(v) == "CFrame" then
                                if ws.CurrentCamera then
                                    -- Camera CFrame Angles: Look from Camera to Target
                                    args[i] = CFrame.new(ws.CurrentCamera.CFrame.Position, targetPos)
                                else
                                    args[i] = CFrame.new(targetPos)
                                end
                                replaced = true
                            elseif typeof(v) == "Instance" and v:IsA("BasePart") then
                                local char = v.Parent
                                if char and (char:FindFirstChild("Humanoid") or char.Parent:FindFirstChild("Humanoid")) then
                                    args[i] = targetPart
                                    replaced = true
                                end
                            end
                        end
                        
                        if replaced then
                             print("[SilentAim Debug] Arguments replaced for", self.Name)
                             if setnamecallmethod then setnamecallmethod(method) end
                             return old_namecall(self, unpack(args))
                        end
                    end
                end
            end
            
            if setnamecallmethod then setnamecallmethod(method) end
            return old_namecall(self, ...)
        end

        setreadonly(mt, true)
    end
end

local CameraSilentAimHooked = false
local __silentIndexBusy = false
local function EnableCameraSilentAim()
    if CameraSilentAimHooked then return true end
    if hookmetamethod then
        local mouseRef = lp and lp:GetMouse()
        local original
        local hookFunc = function(self, key)
            if typeof(self) == "Instance" and not __silentIndexBusy then
                if (flags.toggle_silent_camlock or false)
                    and self == ws.CurrentCamera
                    and (key == "CFrame" or key == "Focus")
                    and ((flags.keybind_camera_lock and flags.keybind_camera_lock.active) or (flags.toggle_auto_aim and uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) and flags.keybind_camera_lock and flags.keybind_camera_lock.key == Enum.UserInputType.MouseButton2) or false)
                then
                    __silentIndexBusy = true
                    local targetPart, targetPos = GetBestCamlockTarget()
                    __silentIndexBusy = false
                    if targetPart and targetPos then
                        local base = original(self, key)
                        if typeof(base) == "CFrame" then
                            return CFrame.new(base.Position, targetPos)
                        end
                        return base
                    end
                elseif (flags.toggle_silent or false) and ((flags.toggle_auto_aim and uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)) or (not flags.toggle_auto_aim and flags.keybind_silent_aim and flags.keybind_silent_aim.active)) and mouseRef and self == mouseRef and (key == "Hit" or key == "Target") then
                    __silentIndexBusy = true
                    local targetPart, targetPos = GetBestSilentTarget()
                    __silentIndexBusy = false
                    if targetPart and targetPos then
                        if key == "Hit" then
                            return CFrame.new(targetPos)
                        else
                            return targetPart
                        end
                    end
                end
            end
            return original(self, key)
        end
        
        if newcclosure then
            hookFunc = newcclosure(hookFunc)
        end
        
        original = hookmetamethod(game, "__index", hookFunc)
        CameraSilentAimHooked = true
        return true
    end
    return false
end

EnableCameraSilentAim()

local occlusionRects = {}
local function isOccluded(pos)
    if not library or not library.menu_open then return false end
    for _, rect in ipairs(occlusionRects) do
        if pos.X >= rect.x and pos.X <= rect.x + rect.w and
           pos.Y >= rect.y and pos.Y <= rect.y + rect.h then
            return true
        end
    end
    return false
end


local ESPCache = {}
local function setupESPCache(p)
    ESPCache[p] = {
        isVisible = false,
        lines = {},
        lines_outline = {},
        box_lines = {},
        box_outline_lines = {},
        corner_lines = {},
        corner_outline_lines = {},
        filled_box = createDraw("Square", {Visible = false, Filled = true, Color = Color3.fromRGB(255,255,255), Transparency = 0.8}),
        name_text = createDraw("Text", {Visible = false, Color = Color3.new(1,1,1), Outline = true, OutlineColor = Color3.new(0,0,0), Size = 12, Font = Drawing.Fonts.UI, Center = false}),
        dist_text = createDraw("Text", {Visible = false, Color = Color3.new(1,1,1), Outline = true, OutlineColor = Color3.new(0,0,0), Size = 12, Font = Drawing.Fonts.UI, Center = false}),
        health_text = createDraw("Text", {Visible = false, Color = Color3.new(1,1,1), Outline = true, OutlineColor = Color3.new(0,0,0), Size = 12, Font = Drawing.Fonts.UI, Center = false}),
        health_back_outline = createDraw("Line", {Visible = false, Color = Color3.new(0,0,0), Thickness = 5}),
        health_back = createDraw("Line", {Visible = false, Color = Color3.fromRGB(30,30,30), Thickness = 3}),
        health_front_outline = createDraw("Line", {Visible = false, Color = Color3.new(0,0,0), Thickness = 5}),
        health_front = createDraw("Line", {Visible = false, Color = Color3.fromRGB(0,255,0), Thickness = 3}),
        health_ratio = 1,
        box_prev_minX = nil,
        box_prev_minY = nil,
        box_prev_maxX = nil,
        box_prev_maxY = nil,
        box_prev_valid = false
    }
    for i = 1, 15 do
        table.insert(ESPCache[p].lines_outline, createDraw("Line", {
            Visible = false,
            Color = Color3.new(0,0,0),
            Thickness = 3
        }))
        table.insert(ESPCache[p].lines, createDraw("Line", {
            Visible = false,
            Color = ESP_SETTINGS.SkeletonColor,
            Thickness = 1
        }))
    end
    for i = 1, 4 do
        table.insert(ESPCache[p].box_outline_lines, createDraw("Line", {Visible = false, Color = Color3.new(0,0,0), Thickness = 3}))
        table.insert(ESPCache[p].box_lines, createDraw("Line", {Visible = false, Color = Color3.fromRGB(255,255,255), Thickness = 1}))
    end
    for i = 1, 8 do
        table.insert(ESPCache[p].corner_outline_lines, createDraw("Line", {Visible = false, Color = Color3.new(0,0,0), Thickness = 3}))
        table.insert(ESPCache[p].corner_lines, createDraw("Line", {Visible = false, Color = Color3.fromRGB(255,255,255), Thickness = 2}))
    end
end

local PlayerChamsCache = {}
players.PlayerAdded:Connect(setupESPCache)
players.PlayerRemoving:Connect(function(p)
    if ESPCache[p] then
        for _, line in ipairs(ESPCache[p].lines) do line:Remove() end
        for _, line in ipairs(ESPCache[p].lines_outline) do line:Remove() end
        for _, line in ipairs(ESPCache[p].box_lines) do line:Remove() end
        for _, line in ipairs(ESPCache[p].box_outline_lines) do line:Remove() end
        for _, line in ipairs(ESPCache[p].corner_lines) do line:Remove() end
        for _, line in ipairs(ESPCache[p].corner_outline_lines) do line:Remove() end
        if ESPCache[p].filled_box then ESPCache[p].filled_box:Remove() end
        if ESPCache[p].name_text then ESPCache[p].name_text:Remove() end
        if ESPCache[p].dist_text then ESPCache[p].dist_text:Remove() end
        if ESPCache[p].health_text then ESPCache[p].health_text:Remove() end
        if ESPCache[p].health_back_outline then ESPCache[p].health_back_outline:Remove() end
        if ESPCache[p].health_back then ESPCache[p].health_back:Remove() end
        if ESPCache[p].health_front_outline then ESPCache[p].health_front_outline:Remove() end
        if ESPCache[p].health_front then ESPCache[p].health_front:Remove() end
        ESPCache[p] = nil
    end
    if PlayerChamsCache[p] then
        PlayerChamsCache[p]:Destroy()
        PlayerChamsCache[p] = nil
    end
end)
for _, p in ipairs(players:GetPlayers()) do
    setupESPCache(p)
end

local function hidePlayerESP(p)
    local c = ESPCache[p]
    if not c or not c.isVisible then return end
    c.isVisible = false
    for _, l in ipairs(c.lines) do l.Visible = false end
    for _, l in ipairs(c.lines_outline) do l.Visible = false end
    for _, l in ipairs(c.box_lines) do l.Visible = false end
    for _, l in ipairs(c.box_outline_lines) do l.Visible = false end
    for _, l in ipairs(c.corner_lines) do l.Visible = false end
    for _, l in ipairs(c.corner_outline_lines) do l.Visible = false end
    c.filled_box.Visible = false
    c.name_text.Visible = false
    c.dist_text.Visible = false
    c.health_text.Visible = false
    if c.health_back_outline then c.health_back_outline.Visible = false end
    c.health_back.Visible = false
    if c.health_front_outline then c.health_front_outline.Visible = false end
    c.health_front.Visible = false
    c.box_prev_valid = false
end

local function characterCenterOnScreen(char)
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return false end
    local v2, on = camera:WorldToViewportPoint(root.Position)
    return on and v2.Z > 0
end

local function DrawingFontFromName(name)
    -- Bucket 1: Tech/Retro -> Plex
    if name == "Plex" or name == "Minecraftia" or name == "Pixel" or name == "Arcade" then 
        return Drawing.Fonts.Plex 
    end
    -- Bucket 2: Monospace -> Monospace
    if name == "RobotoMono" or name == "Code" then 
        return Drawing.Fonts.Monospace 
    end
    -- Bucket 3: System -> System
    if name == "System" then 
        return Drawing.Fonts.System 
    end
    -- Bucket 4: Default -> UI
    return Drawing.Fonts.UI
end
local function computeAABB(character)
    if not character then return nil end
    local minX, minY = math.huge, math.huge
    local maxX, maxY = -math.huge, -math.huge
    local any = false
    
    local cf, size = character:GetBoundingBox()
    if not cf or not size then return nil end
    local hx, hy, hz = size.X/2, size.Y/2, size.Z/2
    local pts = {
        cf:PointToWorldSpace(Vector3.new(-hx,-hy,-hz)),
        cf:PointToWorldSpace(Vector3.new(hx,-hy,-hz)),
        cf:PointToWorldSpace(Vector3.new(-hx,hy,-hz)),
        cf:PointToWorldSpace(Vector3.new(hx,hy,-hz)),
        cf:PointToWorldSpace(Vector3.new(-hx,-hy,hz)),
        cf:PointToWorldSpace(Vector3.new(hx,-hy,hz)),
        cf:PointToWorldSpace(Vector3.new(-hx,hy,hz)),
        cf:PointToWorldSpace(Vector3.new(hx,hy,hz)),
    }
    for i = 1, #pts do
        local v2, on = camera:WorldToViewportPoint(pts[i])
        if on then
            any = true
            if v2.X < minX then minX = v2.X end
            if v2.Y < minY then minY = v2.Y end
            if v2.X > maxX then maxX = v2.X end
            if v2.Y > maxY then maxY = v2.Y end
        end
    end
    
    if not any then return nil end
    if minX == math.huge or minY == math.huge or maxX == -math.huge or maxY == -math.huge then return nil end
    return minX, minY, maxX, maxY
end

local function validateBox(minX, minY, maxX, maxY)
    if not (minX and minY and maxX and maxY) then return false end
    local w, h = maxX - minX, maxY - minY
    if w <= 2 or h <= 2 then return false end
    local vw, vh = camera.ViewportSize.X, camera.ViewportSize.Y
    if w > vw * 1.5 or h > vh * 1.5 then return false end
    return true
end

local function clampBox(minX, minY, maxX, maxY)
    local vw, vh = camera.ViewportSize.X, camera.ViewportSize.Y
    minX = math.clamp(minX, 0, vw)
    maxX = math.clamp(maxX, 0, vw)
    minY = math.clamp(minY, 0, vh)
    maxY = math.clamp(maxY, 0, vh)
    return minX, minY, maxX, maxY
end


local currentHighlight = nil
local function setHighlight(tp)
    if currentHighlight then currentHighlight:Destroy() end
    if not tp or not tp.Character then return end
    local hl = Instance.new("Highlight")
    hl.Adornee = tp.Character
    hl.FillColor = Color3.new(0,0,0)
    hl.OutlineColor = Color3.fromRGB(255,255,255)
    hl.FillTransparency = 0.6
    hl.OutlineTransparency = 0
    hl.Parent = tp.Character
    currentHighlight = hl
end
local function clearHighlight()
    if currentHighlight then
        currentHighlight:Destroy()
        currentHighlight = nil
    end
end


local DrawTargetName = createDraw("Text", {
    Visible = false,
    Center = false,
    Color = Color3.new(1,1,1),
    Outline = true,
    OutlineColor = Color3.new(0,0,0),
    Size = VisualsTextSize or 12,
    Font = DrawingFontFromName(VisualsTextFontName or "Plex")
})

local DrawTargetHealth = createDraw("Text", {
    Visible = false,
    Center = false,
    Color = Color3.new(0,1,0),
    Outline = true,
    OutlineColor = Color3.new(0,0,0),
    Size = VisualsTextSize or 12,
    Font = DrawingFontFromName(VisualsTextFontName or "Plex")
})

 


local skeletonConnections = {
    {"Head", "UpperTorso"},
    {"UpperTorso", "LowerTorso"},
    {"UpperTorso", "LeftUpperArm"},
    {"LeftUpperArm", "LeftLowerArm"},
    {"LeftLowerArm", "LeftHand"},
    {"UpperTorso", "RightUpperArm"},
    {"RightUpperArm", "RightLowerArm"},
    {"RightLowerArm", "RightHand"},
    {"LowerTorso", "LeftUpperLeg"},
    {"LeftUpperLeg", "LeftLowerLeg"},
    {"LeftLowerLeg", "LeftFoot"},
    {"LowerTorso", "RightUpperLeg"},
    {"RightUpperLeg", "RightLowerLeg"},
    {"RightLowerLeg", "RightFoot"},
}

local function updateSkeletonLines(p, lines, outlines)
    if not p.Character then
        for _, line in ipairs(lines) do
            line.Visible = false
        end
        if outlines then
            for _, line in ipairs(outlines) do
                line.Visible = false
            end
        end
        return
    end

    for i, connection in ipairs(skeletonConnections) do
        local p1Name, p2Name = connection[1], connection[2]
        local p1 = getPartSafe(p.Character, p1Name)
        local p2 = getPartSafe(p.Character, p2Name)

        local line = lines[i]
        local oline = outlines and outlines[i] or nil

        
        if not (p1 and p2) then
            line.Visible = false
            if oline then oline.Visible = false end
            continue
        end

        local p1Pos, p2Pos = p1.Position, p2.Position

        
        local p1ScreenPos, p1OnScreen = camera:WorldToViewportPoint(p1Pos)
        local p2ScreenPos, p2OnScreen = camera:WorldToViewportPoint(p2Pos)

        if p1OnScreen and p2OnScreen then
            local v1 = Vector2.new(p1ScreenPos.X, p1ScreenPos.Y)
            local v2 = Vector2.new(p2ScreenPos.X, p2ScreenPos.Y)
            if isOccluded(v1) or isOccluded(v2) then
                line.Visible = false
                if oline then oline.Visible = false end
            else
                line.Visible = true
                line.From = v1
                line.To = v2
                if oline then
                    oline.Visible = true
                    oline.From = line.From
                    oline.To = line.To
                end
            end
        else
            line.Visible = false
            if oline then oline.Visible = false end
        end
    end
end


local lastEspUpdate = 0
local espUpdateInterval = 1/30
local lastSkeletonUpdate = 0
local skeletonUpdateInterval = 1/30
local lastTextUpdate = 0
local textUpdateInterval = 1/15
local wasLocked = false


run.RenderStepped:Connect(function()
    if library.menu_open and library.main_frames then
        table.clear(occlusionRects)
        for _, frame in ipairs(library.main_frames) do
            if frame.Visible then
                local ap = frame.AbsolutePosition
                local as = frame.AbsoluteSize
                table.insert(occlusionRects, {x=ap.X, y=ap.Y, w=as.X, h=as.Y})
            end
        end
    else
        table.clear(occlusionRects)
    end

    ESP_SETTINGS.Enabled = not library.menu_open
    ESP_SETTINGS.ShowSkeleton = flags.toggle_skeleton_esp or false
    
     local lockKeyActive
    if flags.toggle_auto_aim then
        lockKeyActive = uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)
    else
        lockKeyActive = flags.keybind_camera_lock and flags.keybind_camera_lock.active
    end

    local isLocked = flags.toggle_camera_lock and not (flags.toggle_silent_camlock or false) and lockKeyActive

    if isLocked then
        LockCameraToTargetPlayer()
        if CurrentTarget then
            if not wasLocked then
                cas:BindAction("CamLockInputSink", SinkInput, false, Enum.UserInputType.MouseMovement, Enum.UserInputType.Touch, Enum.UserInputType.Gamepad1, Enum.UserInputType.Gamepad2)
                wasLocked = true
            end
        else
            if wasLocked then
                cas:UnbindAction("CamLockInputSink")
                wasLocked = false
            end
        end
    else
        if wasLocked then
            cas:UnbindAction("CamLockInputSink")
            wasLocked = false
        end
        clearHighlight()
        CurrentTarget = nil
    end

    if flags.toggle_aimbot_highlight and not library.menu_open then
        local shouldHighlight = false
        if CurrentTarget and CurrentTarget.Character then
            local part = getPartSafe(CurrentTarget.Character, selectedPart)
            if not part then
                part = getPartSafe(CurrentTarget.Character, "Head")
            end
            if part then
                local _, onScreen = camera:WorldToViewportPoint(part.Position)
                if flags.toggle_raycast then
                    shouldHighlight = onScreen and PerformLineOfSightCheck(CurrentTarget)
                else
                    shouldHighlight = onScreen
                end
            end
        end
        if shouldHighlight then
            setHighlight(CurrentTarget)
        else
            clearHighlight()
        end
    end

    
    local center = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)

    if FOVCircle then
        local visible = not library.menu_open
        local dotted = flags.toggle_dotted_fov
        if visible and dotted then
            FOVCircle.Visible = false
            if FOVOutline then FOVOutline.Visible = false end
            updateDotted(FOVMiniDots, center, TargetFOV * 5, FOVColor, true, DottedParams.Num_Dots, DottedParams.Dotted_Size)
        else
            updateDotted(FOVMiniDots, center, TargetFOV * 5, FOVColor, false, DottedParams.Num_Dots, DottedParams.Dotted_Size)
            FOVCircle.Visible = visible
            if FOVCircle.Visible then
                FOVCircle.Position = center
                FOVCircle.Radius = TargetFOV * 5
            end
            if FOVOutline then
                FOVOutline.Visible = visible
                if FOVOutline.Visible then
                    FOVOutline.Position = center
                    FOVOutline.Radius = (TargetFOV * 5) + 4
                end
            end
        end
    else
        updateDotted(FOVMiniDots, center, 0, FOVColor, false, 0, 0)
    end

    if SilentFOVCircle then
        local visible = not library.menu_open
        local dotted = flags.toggle_dotted_fov_silent
        if visible and dotted then
            SilentFOVCircle.Visible = false
            if SilentFOVOutline then SilentFOVOutline.Visible = false end
            updateDotted(SilentFOVMiniDots, center, SilentTargetFOV * 5, SilentFOVColor, true, DottedParams.Num_Dots, DottedParams.Dotted_Size)
        else
            updateDotted(SilentFOVMiniDots, center, SilentTargetFOV * 5, SilentFOVColor, false, DottedParams.Num_Dots, DottedParams.Dotted_Size)
            SilentFOVCircle.Visible = visible
            if SilentFOVCircle.Visible then
                SilentFOVCircle.Position = center
                SilentFOVCircle.Radius = SilentTargetFOV * 5
            end
            if SilentFOVOutline then
                SilentFOVOutline.Visible = visible
                if SilentFOVOutline.Visible then
                    SilentFOVOutline.Position = center
                    SilentFOVOutline.Radius = (SilentTargetFOV * 5) + 4
                end
            end
        end
    else
        updateDotted(SilentFOVMiniDots, center, 0, SilentFOVColor, false, 0, 0)
    end

    
    if (flags.toggle_target_name or flags.toggle_target_distance or flags.toggle_target_health) and CurrentTarget and CurrentTarget.Character and not library.menu_open then
        local head = getPartSafe(CurrentTarget.Character, "Head") or getPartSafe(CurrentTarget.Character, selectedPart)
        if head then
            local pos, onScreen = camera:WorldToViewportPoint(head.Position)
            if onScreen then
                local dist = math.floor((camera.CFrame.Position - head.Position).Magnitude)
                local sideOffsetX = 12
                local sideOffsetY = -8
                local tPos = Vector2.new(pos.X + sideOffsetX, pos.Y + sideOffsetY)
                
                
                if flags.toggle_target_name or flags.toggle_target_distance then
                    DrawTargetName.Visible = true
                    DrawTargetName.Position = tPos
                    
                    local textToShow = ""
                    if flags.toggle_target_name then
                        textToShow = CurrentTarget.Name
                    end
                    if flags.toggle_target_distance then
                        if textToShow ~= "" then
                            textToShow = textToShow .. " [" .. dist .. "m]"
                        else
                            textToShow = "[" .. dist .. "m]"
                        end
                    end
                    DrawTargetName.Text = textToShow
                else
                    DrawTargetName.Visible = false
                end

                
                if flags.toggle_target_health then
                    local hum = CurrentTarget.Character:FindFirstChild("Humanoid")
                    if hum then
                         local health = math.floor(hum.Health)
                         local maxHealth = hum.MaxHealth
                         
                         
                         local color = Color3.fromHSV(math.clamp(health/maxHealth, 0, 1) * 0.33, 1, 1)
                         
                         local offsetY = 0
                         if DrawTargetName.Visible then
                             offsetY = (VisualsTextSize or 12) + 2
                         end

                         DrawTargetHealth.Visible = true
                         DrawTargetHealth.Position = Vector2.new(tPos.X, tPos.Y + offsetY)
                         DrawTargetHealth.Text = tostring(health)
                         DrawTargetHealth.Color = color
                    else
                         DrawTargetHealth.Visible = false
                    end
                else
                    DrawTargetHealth.Visible = false
                end
            else
                DrawTargetName.Visible = false
                DrawTargetHealth.Visible = false
            end
        else
            DrawTargetName.Visible = false
            DrawTargetHealth.Visible = false
        end
    else
        DrawTargetName.Visible = false
        DrawTargetHealth.Visible = false
    end
    
    if flags.toggle_scp_esp and not library.menu_open then
        if tick() - lastSCPScan > 0.5 then
            lastSCPScan = tick()
            for m, hl in pairs(SCPESPCache) do
                if not m or not m.Parent then
                    if hl then hl:Destroy() end
                    SCPESPCache[m] = nil
                end
            end
            for m, bb in pairs(SCPNameCache) do
                if not m or not m.Parent then
                    if bb then bb:Destroy() end
                    SCPNameCache[m] = nil
                end
            end
            for d, _ in pairs(SCPCandidateCache) do
                if d and d.Parent then
                    -- Filter out non-humanoid SCPs (static props that slipped through)
                    if not d:FindFirstChildOfClass("Humanoid") then
                        if SCPESPCache[d] then
                            SCPESPCache[d]:Destroy()
                            SCPESPCache[d] = nil
                        end
                        if SCPNameCache[d] then
                            SCPNameCache[d]:Destroy()
                            SCPNameCache[d] = nil
                        end
                        continue
                    end

                    local posPart = d.PrimaryPart or d:FindFirstChild("HumanoidRootPart")
                    if not posPart then
                        for _, ch in ipairs(d:GetChildren()) do
                            if ch:IsA("BasePart") then posPart = ch break end
                        end
                    end
                    local within = true
                    if posPart then
                        local dist = (camera.CFrame.Position - posPart.Position).Magnitude
                        within = dist <= SCPRenderDistance
                    end
                    if not within then
                        if SCPESPCache[d] then
                            SCPESPCache[d]:Destroy()
                            SCPESPCache[d] = nil
                        end
                        if SCPNameCache[d] then
                            SCPNameCache[d]:Destroy()
                            SCPNameCache[d] = nil
                        end
                    elseif not SCPESPCache[d] then
                        local hl = Instance.new("Highlight")
                        hl.Adornee = d
                        local teamName = nil
                        local tv = d:FindFirstChild("Team")
                        if tv and tv:IsA("StringValue") then
                            teamName = tv.Value
                        elseif d:GetAttribute("Team") then
                            teamName = d:GetAttribute("Team")
                        else
                            local n = string.lower(d.Name)
                            if n:find("class") or n:find("d%-") or n:find("class d") then teamName = "Class - D"
                            elseif n:find("security") then teamName = "Security Department"
                            elseif n:find("mtf") or n:find("task force") then teamName = "Mobile Task Force"
                            elseif n:find("chaos") then teamName = "Chaos Insurgency"
                            elseif n:find("scientific") or n:find("science") then teamName = "Scientific Department"
                            elseif n:find("medical") then teamName = "Medical Department"
                            elseif n:find("admin") then teamName = "Administrative Department"
                            elseif n:find("intel") then teamName = "Intelligence Agency"
                            elseif n:find("internal security") then teamName = "Internal Security Department"
                            elseif n:find("rapid response") or n:find("rrt") then teamName = "Rapid Response Team"
                            end
                        end
                        local color = RoleColors[teamName] or Color3.fromRGB(255,255,255)
                        hl.FillColor = Color3.new(0,0,0)
                        hl.OutlineColor = color
                        hl.FillTransparency = 0.6
                        hl.OutlineTransparency = 0
                        hl.Parent = d
                        SCPESPCache[d] = hl
                    end
                    if within and flags.toggle_scp_name and SCPESPCache[d] and not SCPNameCache[d] then
                        local adornee = d:FindFirstChild("HumanoidRootPart") or d.PrimaryPart
                        if not adornee then
                            for _, ch in ipairs(d:GetChildren()) do
                                if ch:IsA("BasePart") then adornee = ch break end
                            end
                        end
                        if adornee then
                            local bb = Instance.new("BillboardGui")
                            bb.Parent = d
                            bb.Adornee = adornee
                            bb.Size = UDim2.new(0, 120, 0, 24)
                            bb.StudsOffset = Vector3.new(0, 3, 0)
                            bb.AlwaysOnTop = true
                            local tl = Instance.new("TextLabel")
                            tl.Parent = bb
                            tl.Size = UDim2.new(1, 0, 1, 0)
                            tl.BackgroundTransparency = 1
                            tl.TextScaled = false
                            -- Force hardcoded font and size as requested
                            tl.Font = Enum.Font.RobotoMono
                            tl.TextSize = 10
                            tl.TextStrokeTransparency = 0
                            tl.TextStrokeColor3 = Color3.new(0,0,0)
                            tl.TextXAlignment = Enum.TextXAlignment.Center
                            tl.TextYAlignment = Enum.TextYAlignment.Center
                            tl.AnchorPoint = Vector2.new(0.5, 0.5)
                            tl.Position = UDim2.fromScale(0.5, 0.5)
                            local teamName = nil
                            local tv = d:FindFirstChild("Team")
                            if tv and tv:IsA("StringValue") then
                                teamName = tv.Value
                            elseif d:GetAttribute("Team") then
                                teamName = d:GetAttribute("Team")
                            end
                            local col = RoleColors[teamName] or Color3.fromRGB(255,255,255)
                            tl.TextColor3 = col
                            tl.Text = d.Name
                            SCPNameCache[d] = bb
                        end
                    end
                elseif SCPESPCache[d] then
                    local hl = SCPESPCache[d]
                    local teamName = nil
                    local tv = d:FindFirstChild("Team")
                    if tv and tv:IsA("StringValue") then
                        teamName = tv.Value
                    elseif d:GetAttribute("Team") then
                        teamName = d:GetAttribute("Team")
                    end
                    if teamName then
                        local color = RoleColors[teamName] or hl.OutlineColor
                        hl.OutlineColor = color
                        local bb = SCPNameCache[d]
                        if bb then
                            local tl = bb:FindFirstChildOfClass("TextLabel")
                            if tl then tl.TextColor3 = color end
                        end
                    end
                end
            end
            if not flags.toggle_scp_name then
                for m, bb in pairs(SCPNameCache) do
                    if bb then bb:Destroy() end
                    SCPNameCache[m] = nil
                end
            end
        end
        
        
        for m, bb in pairs(SCPNameCache) do
            if bb and m and m.Parent then
                local pos = m:GetPivot().Position
                local screenPos, onScreen = camera:WorldToViewportPoint(pos)
                if onScreen and not isOccluded(Vector2.new(screenPos.X, screenPos.Y)) then
                    bb.Enabled = true
                else
                    bb.Enabled = false
                end
            elseif bb then
                bb.Enabled = false
            end
        end
        for m, hl in pairs(SCPESPCache) do
            if hl and m and m.Parent then
                local pos = m:GetPivot().Position
                local screenPos, onScreen = camera:WorldToViewportPoint(pos)
                if onScreen and not isOccluded(Vector2.new(screenPos.X, screenPos.Y)) then
                    hl.Enabled = true
                else
                    hl.Enabled = false
                end
            elseif hl then
                hl.Enabled = false
            end
        end
    else
        for m, hl in pairs(SCPESPCache) do
            if hl then hl:Destroy() end
            SCPESPCache[m] = nil
        end
        for m, bb in pairs(SCPNameCache) do
            if bb then bb:Destroy() end
            SCPNameCache[m] = nil
        end
    end

    if ESP_SETTINGS.Enabled then
        local now = tick()
        local doEspUpdate = (now - lastEspUpdate) >= espUpdateInterval
        local doSkeletonUpdate = (now - lastSkeletonUpdate) >= skeletonUpdateInterval
        local doTextUpdate = (now - lastTextUpdate) >= textUpdateInterval
        
        if doEspUpdate then lastEspUpdate = now end
        if doSkeletonUpdate then lastSkeletonUpdate = now end
        if doTextUpdate then lastTextUpdate = now end
        
        for _, p in ipairs(players:GetPlayers()) do
            if p ~= lp and p.Character and p.Character:FindFirstChildOfClass("Humanoid") and p.Character:FindFirstChild("Humanoid").Health > 0 then
                local root = p.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    local dist = (camera.CFrame.Position - root.Position).Magnitude
                    local centerOn = characterCenterOnScreen(p.Character)
                     if dist <= ESPRenderDistance and centerOn then
                        if not ESPCache[p] then
                            setupESPCache(p)
                        end
                        ESPCache[p].isVisible = true
                        
                        
                        if doEspUpdate then
                            local color = ESP_SETTINGS.SkeletonColor
                            local teamName = RetrievePlayerTeamName(p)
                            color = RoleColors[teamName] or color
                            if CurrentTarget == p and ESP_SETTINGS.ShowSkeleton then
                                color = Color3.fromRGB(255,255,255)
                            end
                            if ESP_SETTINGS.ShowSkeleton then
                                for _, line in ipairs(ESPCache[p].lines) do
                                    line.Color = color
                                end
                            end
    
                            if ESP_SETTINGS.ShowSkeleton then
                                if doSkeletonUpdate then
                                    updateSkeletonLines(p, ESPCache[p].lines, ESPCache[p].lines_outline)
                                end
                            else
                                for _, line in ipairs(ESPCache[p].lines) do
                                    line.Visible = false
                                end
                                for _, line in ipairs(ESPCache[p].lines_outline) do
                                    line.Visible = false
                                end
                            end
                            local minX, minY, maxX, maxY = computeAABB(p.Character)
                            if validateBox(minX, minY, maxX, maxY) then
                                minX, minY, maxX, maxY = clampBox(minX, minY, maxX, maxY)
                                local prev = ESPCache[p]
                                
                                prev.box_prev_minX, prev.box_prev_minY, prev.box_prev_maxX, prev.box_prev_maxY = minX, minY, maxX, maxY
                                prev.box_prev_valid = true
                                local w, h = maxX - minX, maxY - minY
                                local boxColor = color
                                local font = DrawingFontFromName(VisualsTextFontName or "Plex")
                                local baseSize = VisualsTextSize or 13
                                
                                
                                
                                
                                local ts = math.clamp(14 - (dist / 250), 10, 14)
                                
                                local nameText = ESPCache[p].name_text
                                local distText = ESPCache[p].dist_text
                                
                                
                                local padding = math.max(3, math.floor(ts * 0.35))
                                
                                local hideESP = (p == CurrentTarget) and (flags.toggle_target_name or flags.toggle_target_distance)

                                if flags.esp_names then
                                    local nPos = Vector2.new(maxX + padding, minY)
                                    if isOccluded(nPos) or hideESP then
                                        nameText.Visible = false
                                    else
                                        nameText.Position = nPos
                                        nameText.Visible = true
                                    end
                                    
                                    if doTextUpdate then
                                        nameText.Text = p.Name
                                        nameText.Color = boxColor
                                        nameText.Font = font
                                        nameText.Size = ts
                                    end
                                else
                                    nameText.Visible = false
                                end
                                if flags.esp_distance_text then
                                    local offsetY = 0
                                    if flags.esp_names then
                                        offsetY = ts + math.max(1, math.floor(padding * 0.5))
                                    end
                                    local dPos = Vector2.new(maxX + padding, minY + offsetY)
                                    if isOccluded(dPos) or hideESP then
                                        distText.Visible = false
                                    else
                                        distText.Position = dPos
                                        distText.Visible = true
                                    end

                                    if doTextUpdate then
                                        distText.Text = tostring(math.floor(dist)) .. "m"
                                        distText.Color = boxColor
                                        distText.Font = font
                                        distText.Size = ts
                                    end
                                else
                                    distText.Visible = false
                                end
                                
                                ESPCache[p].health_text.Visible = false
                                local hbBack = ESPCache[p].health_back
                                local hbFront = ESPCache[p].health_front
                                local hbBackO = ESPCache[p].health_back_outline
                                local hbFrontO = ESPCache[p].health_front_outline
                                hbBack.Visible = false
                                hbFront.Visible = false
                                if hbBackO then hbBackO.Visible = false end
                                if hbFrontO then hbFrontO.Visible = false end
                                if flags.esp_chams then
                                    local hl = PlayerChamsCache[p]
                                    if not hl then
                                        hl = Instance.new("Highlight")
                                        hl.Adornee = p.Character
                                        hl.Parent = p.Character
                                        PlayerChamsCache[p] = hl
                                    end
                                    hl.FillColor = Color3.new(0,0,0)
                                    hl.FillTransparency = 0.6
                                    hl.OutlineColor = boxColor
                                    hl.OutlineTransparency = 0
                                    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                                    hl.Enabled = true
                                else
                                    if PlayerChamsCache[p] then
                                        PlayerChamsCache[p].Enabled = false
                                    end
                                end
                            else
                                hidePlayerESP(p)
                                if PlayerChamsCache[p] then PlayerChamsCache[p].Enabled = false end
                            end
                        end 
                    else
                        hidePlayerESP(p)
                        if PlayerChamsCache[p] then PlayerChamsCache[p].Enabled = false end
                    end
                else
                    hidePlayerESP(p)
                    if PlayerChamsCache[p] then PlayerChamsCache[p].Enabled = false end
                end
            elseif ESPCache[p] then
                hidePlayerESP(p)
                if PlayerChamsCache[p] then PlayerChamsCache[p].Enabled = false end
            end
        end
    else
        
        for _, p in ipairs(players:GetPlayers()) do
            if ESPCache[p] then
                hidePlayerESP(p)
                if PlayerChamsCache[p] then PlayerChamsCache[p].Enabled = false end
            end
        end
    end
end)

camera = ws.CurrentCamera
lp = players.LocalPlayer 
local mouse = lp:GetMouse() 
local gui_offset = gui_service:GetGuiInset().Y

local max = math.max 
local floor = math.floor 
local min = math.min 
local abs = math.abs 
local noise = math.noise
local rad = math.rad 
local random = math.random 
local pow = math.pow 
local sin = math.sin 
local pi = math.pi 
local tan = math.tan 
local atan2 = math.atan2 
local cos = math.cos 
local round = math.round;
local clamp = math.clamp; 
local ceil = math.ceil; 
local sqrt = math.sqrt;
local acos = math.acos; 

local insert = table.insert 
local find = table.find 
local remove = table.remove
local concat = table.concat



library = {
    directory = "raeleigh",
    folders = {
        "/fonts",
        "/configs",
        "/images"
    },
    flags = flags,
    config_flags = {},
    visible_flags = {}, 
    guis = {}, 
    connections = {},   
    notifications = {},
    playerlist_data = {},

    current_tab, 
    current_element_open, 
    dock_button_holder,  
    old_config; 
    font, 
    keybind_list,
    binds = {}, 
    
    copied_flag; 
    is_rainbow;

    display_orders = 0; 
    menu_open = true;
    main_frames = {};
}

local flags = library.flags
local config_flags = library.config_flags

local themes = {
    preset = {
        ["outline"] = hex("#0A0A0A"), 
        ["inline"] = hex("#2D2D2D"), 
        ["accent"] = rgb(191, 162, 219), 
        ["high_contrast"] = hex("#141414"),
        ["low_contrast"] = hex("#1E1E1E"),
        ["text"] = hex("#B4B4B4"),
        ["text_outline"] = rgb(0, 0, 0),
        ["glow"] = rgb(0, 0, 0), 
    },

    utility = {
        ["outline"] = {
            ["BackgroundColor3"] = {}, 	
            ["Color"] = {}, 
        },
        ["inline"] = {
            ["BackgroundColor3"] = {}, 	
            ["ImageColor3"] = {},
        },
        ["accent"] = {
            ["BackgroundColor3"] = {}, 	
            ["TextColor3"] = {}, 
            ["ImageColor3"] = {}, 
            ["ScrollBarImageColor3"] = {} 
        },
        ["contrast"] = {
            ["Color"] = {}, 	
        },
        ["text"] = {
            ["TextColor3"] = {}, 	
        },
        ["text_outline"] = {
            ["Color"] = {}, 	
        },
        ["glow"] = {
            ["ImageColor3"] = {}, 	
        }, 
        ["high_contrast"] = {
            ["BackgroundColor3"] = {},
        },
        ["low_contrast"] = {
            ["BackgroundColor3"] = {},
        }
    }, 

    find = {
        ["Frame"] = "BackgroundColor3", 
        ["TextLabel"] = "TextColor3", 
        ["UIGradient"] = "Color",
        ["UIStroke"] = "Color",
        ["ImageLabel"] = "ImageColor3",
        ["TextButton"] = "BackgroundColor3", 
        ["ScrollingFrame"] = "ScrollBarImageColor3"
    }
}

local keys = {
    [Enum.KeyCode.LeftShift] = "LS",
    [Enum.KeyCode.RightShift] = "RS",
    [Enum.KeyCode.LeftControl] = "LC",
    [Enum.KeyCode.RightControl] = "RC",
    [Enum.KeyCode.Insert] = "INS",
    [Enum.KeyCode.Backspace] = "BS",
    [Enum.KeyCode.Return] = "Ent",
    [Enum.KeyCode.LeftAlt] = "LA",
    [Enum.KeyCode.RightAlt] = "RA",
    [Enum.KeyCode.CapsLock] = "CAPS",
    [Enum.KeyCode.One] = "1",
    [Enum.KeyCode.Two] = "2",
    [Enum.KeyCode.Three] = "3",
    [Enum.KeyCode.Four] = "4",
    [Enum.KeyCode.Five] = "5",
    [Enum.KeyCode.Six] = "6",
    [Enum.KeyCode.Seven] = "7",
    [Enum.KeyCode.Eight] = "8",
    [Enum.KeyCode.Nine] = "9",
    [Enum.KeyCode.Zero] = "0",
    [Enum.KeyCode.KeypadOne] = "Num1",
    [Enum.KeyCode.KeypadTwo] = "Num2",
    [Enum.KeyCode.KeypadThree] = "Num3",
    [Enum.KeyCode.KeypadFour] = "Num4",
    [Enum.KeyCode.KeypadFive] = "Num5",
    [Enum.KeyCode.KeypadSix] = "Num6",
    [Enum.KeyCode.KeypadSeven] = "Num7",
    [Enum.KeyCode.KeypadEight] = "Num8",
    [Enum.KeyCode.KeypadNine] = "Num9",
    [Enum.KeyCode.KeypadZero] = "Num0",
    [Enum.KeyCode.Minus] = "-",
    [Enum.KeyCode.Equals] = "=",
    [Enum.KeyCode.Tilde] = "~",
    [Enum.KeyCode.LeftBracket] = "[",
    [Enum.KeyCode.RightBracket] = "]",
    [Enum.KeyCode.RightParenthesis] = ")",
    [Enum.KeyCode.LeftParenthesis] = "(",
    [Enum.KeyCode.Semicolon] = ",",
    [Enum.KeyCode.Quote] = "'",
    [Enum.KeyCode.BackSlash] = "\\",
    [Enum.KeyCode.Comma] = ",",
    [Enum.KeyCode.Period] = ".",
    [Enum.KeyCode.Slash] = "/",
    [Enum.KeyCode.Asterisk] = "*",
    [Enum.KeyCode.Plus] = "+",
    [Enum.KeyCode.Period] = ".",
    [Enum.KeyCode.Backquote] = "`",
    [Enum.UserInputType.MouseButton1] = "MB1",
    [Enum.UserInputType.MouseButton2] = "MB2",
    [Enum.UserInputType.MouseButton3] = "MB3",
    [Enum.KeyCode.Escape] = "ESC",
    [Enum.KeyCode.Space] = "SPC",
}
    
library.__index = library

for _, path in next, library.folders do 
    makefolder(library.directory .. path)
end 

if not isfile("ffff.ttf") then
    local success, content = pcall(game.HttpGet, game, "https://github.com/colloper/Random/raw/refs/heads/main/WindowsXPTahoma.ttf")
    if success then
        writefile("ffff.ttf", content)
    end
end

local tahoma = {
    name = "Tahoma",
    faces = {
        {
            name = "Regular",
            weight = 400,
            style = "normal",
            assetId = getcustomasset("ffff.ttf")
        }
    }
}

writefile("dddd.ttf", http_service:JSONEncode(tahoma))

library.font = Font.new(getcustomasset("dddd.ttf"), Enum.FontWeight.Regular)

local config_holder 




    function library:hoverify(hover, parent) 
        local hover_instance = library:create("Frame", {
            Parent = parent,
            BackgroundTransparency = 1,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent,
            ZIndex = 1;
        }) library:apply_theme(hover_instance, "accent", "BackgroundColor3") 

        hover.MouseEnter:Connect(function()
            library:tween(hover_instance, {
                BackgroundTransparency = 0, 
            }) 
        end)
        
        hover.MouseLeave:Connect(function()
            library:tween(hover_instance, {
                BackgroundTransparency = 1, 
            }) 
        end)

        return hover_instance;
    end 

    function library:hovering(Object)
        if type(Object) == "table" then 
            local Pass = false;

            for _,obj in Object do 
                if library:hovering(obj) then 
                    Pass = true
                    return Pass
                end 
            end 
        else 
            local y_cond = Object.AbsolutePosition.Y <= mouse.Y and mouse.Y <= Object.AbsolutePosition.Y + Object.AbsoluteSize.Y
            local x_cond = Object.AbsolutePosition.X <= mouse.X and mouse.X <= Object.AbsolutePosition.X + Object.AbsoluteSize.X
            
            return (y_cond and x_cond)
        end 
    end  

    function library:make_resizable(frame) 
        local Frame = Instance.new("TextButton")
        Frame.Position = dim2(1, -10, 1, -10)
        Frame.BorderColor3 = rgb(0, 0, 0)
        Frame.Size = dim2(0, 10, 0, 10)
        Frame.BorderSizePixel = 0
        Frame.BackgroundColor3 = rgb(255, 255, 255)
        Frame.Parent = frame
        Frame.BackgroundTransparency = 1 
        Frame.Text = ""

        local resizing = false 
        local start_size 
        local start 
        local og_size = frame.Size  

        Frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                resizing = true
                start = input.Position
                start_size = frame.Size
            end
        end)

        Frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                resizing = false
            end
        end)

        library:connection(uis.InputChanged, function(input, game_event) 
            if resizing and input.UserInputType == Enum.UserInputType.MouseMovement then
                local viewport_x = camera.ViewportSize.X
                local viewport_y = camera.ViewportSize.Y

                local current_size = dim2(
                    start_size.X.Scale,
                    math.clamp(
                        start_size.X.Offset + (input.Position.X - start.X),
                        og_size.X.Offset,
                        viewport_x
                    ),
                    start_size.Y.Scale,
                    math.clamp(
                        start_size.Y.Offset + (input.Position.Y - start.Y),
                        og_size.Y.Offset,
                        viewport_y
                    )
                )
                frame.Size = current_size
            end
        end)
    end

    local dependents_registry = {}

    function library:draggify(frame)
        local dragging = false 
        local start_size = frame.Position
        local start 
        local dependent_starts = {}

        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                start = input.Position
                start_size = frame.Position
                
                dependent_starts = {}
                if dependents_registry[frame] then
                    for _, dep in next, dependents_registry[frame] do
                         dependent_starts[dep] = dep.Position
                    end
                end

                if library.current_element_open then 
                    library.current_element_open.set_visible(false)
                    library.current_element_open.open = false 
                    library.current_element_open = nil 
                end 

                if frame.Parent:IsA("ScreenGui") and frame.Parent.DisplayOrder ~= 999999 then 
                    library.display_orders += 1 
                    frame.Parent.DisplayOrder = library.display_orders
                end   
            end
        end)

        frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)

        library:connection(uis.InputChanged, function(input, game_event) 
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local viewport_x = camera.ViewportSize.X
                local viewport_y = camera.ViewportSize.Y

                local current_position = dim2(
                    0,
                    clamp(
                        start_size.X.Offset + (input.Position.X - start.X),
                        0,
                        viewport_x - frame.Size.X.Offset
                    ),
                    0,
                    clamp(
                        start_size.Y.Offset + (input.Position.Y - start.Y),
                        0,
                        viewport_y - frame.Size.Y.Offset
                    )
                )

                frame.Position = current_position
                
                if dependents_registry[frame] then
                    local delta = current_position - start_size
                    for _, dep in next, dependents_registry[frame] do
                        if dependent_starts[dep] then
                             dep.Position = dependent_starts[dep] + delta
                        end
                    end
                end
            end
        end)
    end

    function library:new_drawing(class, properties)
        local ins = Drawing.new(class)

        for _, v in next, properties do 
            ins[_] = v
        end 

        insert(raeleigh.drawings, ins)

        return ins 
    end 
    
    function library:new_item(class, properties) 
        local ins = Instance.new(class)

        for _, v in next, properties do 
            ins[_] = v
        end 

        insert(raeleigh.instances, ins)

        return ins 
    end 

    function library:convert_enum(enum)
        local enum_parts = {}
    
        for part in string.gmatch(enum, "[%w_]+") do
            insert(enum_parts, part)
        end
    
        local enum_table = Enum
        for i = 2, #enum_parts do
            local enum_item = enum_table[enum_parts[i]]
    
            enum_table = enum_item
        end
    
        return enum_table
    end

    function library:tween(obj, properties) 
        local tween = tween_service:Create(obj, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut, 0, false, 0), properties):Play()
            
        return tween
    end 

    function library:config_list_update() 
        if not config_holder then return end 
    
        local list = {}
    
        for idx, file in next, listfiles(library.directory .. "/configs") do
            local name = string.sub(file:gsub(library.directory .. "/configs\\", ""):gsub(library.directory .. "\\configs\\", ""), 1, -5)
            list[#list + 1] = name
        end
        
        config_holder.refresh_options(list)
    end 

    function library:get_config()
        local Config = {}
    
        for _, v in flags do
            if type(v) == "table" and v.key then
                Config[_] = {active = v.active, mode = v.mode, key = tostring(v.key)}
            elseif type(v) == "table" and v["Transparency"] and v["Color"] then
                Config[_] = {Transparency = v["Transparency"], Color = v["Color"]:ToHex()}
            else
                Config[_] = v
            end
        end 
        
        return http_service:JSONEncode(Config)
    end

    function library:load_config(config_json) 
        local config = http_service:JSONDecode(config_json)
    
        for _, v in next, config do 
            local function_set = library.config_flags[_]
            
            if function_set then 
                if type(v) == "table" and v["Transparency"] and v["Color"] then
                    function_set(hex(v["Color"]), v["Transparency"])
                elseif type(v) == "table" and v["active"] then 
                    function_set(v)
                else 
                    function_set(v)
                end
            end 
        end 
    end 
    
    function library:round(number, float) 
        local multiplier = 1 / (float or 1)

        return floor(number * multiplier + 0.5) / multiplier
    end 

    function library:apply_theme(instance, theme, property) 
        insert(themes.utility[theme][property], instance)
    end

    function library:update_theme(theme, color)
        for _, property in next, themes.utility[theme] do 

            for m, object in next, property do 
                if object[_] == themes.preset[theme] or object.ClassName == "UIGradient" then
                    object[_] = color 
                end
            end 
        end 

        themes.preset[theme] = color 
    end 

    function library:connection(signal, callback)
        local connection = signal:Connect(callback)
        
        insert(library.connections, connection)

        return connection 
    end

    function library:apply_stroke(parent) 
        local stroke = library:create("UIStroke", {
            Parent = parent,
            Color = themes.preset.text_outline, 
            LineJoinMode = Enum.LineJoinMode.Miter
        }) 
        
        library:apply_theme(stroke, "text_outline", "Color")
    end

    function library:create(instance, options)
        local ins = Instance.new(instance) 
        
        for prop, value in next, options do 
            ins[prop] = value
        end
        
        if instance == "TextLabel" or instance == "TextButton" or instance == "TextBox" then 	
            library:apply_theme(ins, "text", "TextColor3")
            library:apply_stroke(ins)
        elseif instance == "ScreenGui" then 
            insert(library.guis, ins)
        end
        
        return ins 
    end
    



    local tooltip_sgui = library:create("ScreenGui", {
        Enabled = true,
        Parent = gethui(),
        Name = "",
        DisplayOrder = 10001, 
    })

    function library:tool_tip(options) 
        local cfg = {
            name = options.name or "hi", 
            path = options.path or nil, 
        }

        if cfg.path then 
            local watermark_outline = library:create("Frame", {
                Parent = tooltip_sgui,
                Name = "",
                Size = dim2(0, 0, 0, 22),
                Position = dim2(0, 500, 0, 300),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Visible = false,
                AutomaticSize = Enum.AutomaticSize.X,
                BackgroundColor3 = themes.preset.outline
            })
            
            local watermark_inline = library:create("Frame", {
                Parent = watermark_outline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            
            local watermark_background = library:create("Frame", {
                Parent = watermark_inline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = watermark_background,
                Name = "",
                Color = rgbseq{rgbkey(0, rgb(41, 41, 55)), rgbkey(1, rgb(35, 35, 47))}
            }); library:apply_theme(UIGradient, "contrast", "Color")
            
            local text = library:create("TextLabel", {
                Parent = watermark_background,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = " " .. cfg.name .. " ",
                Size = dim2(0, 0, 1, 0),
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, -1),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIStroke = library:create("UIStroke", {
                Parent = text,
                Name = "",
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            cfg.path.MouseEnter:Connect(function()
                watermark_outline.Visible = true 
            end)   

            cfg.path.MouseLeave:Connect(function()
                watermark_outline.Visible = false 
            end)

            library:connection(uis.InputChanged, function(input)
                if watermark_outline.Visible and input.UserInputType == Enum.UserInputType.MouseMovement then
                    watermark_outline.Position = dim_offset(input.Position.X + 10, input.Position.Y + 10)
                end
            end)
        end 
        
        return cfg
    end 

    function library:panel(options) 
        local cfg = {
            name = options.text or options.name or "Window", 
            size = options.size or dim2(0, 530, 0, 590),
            position = options.position or dim2(0, 500, 0, 500),
            anchor_point = options.anchor_point or vec2(0, 0),

            
            image = options.image or "rbxassetid://79856374238119",
            open = (options.open ~= nil and options.open) or (options.open == nil and true),

            
            items = {},
        }
        
        local items = cfg.items do 
            
                items.sgui = library:create("ScreenGui", {
                    Enabled = cfg.open,
                    Parent = gethui(),
                    Name = "",
                    DisplayOrder = 10000
                })
                
                items.main_holder = library:create("Frame", {
                    Parent = items.sgui,
                    Name = "",
                    AnchorPoint = vec2(cfg.anchor_point.X, cfg.anchor_point.Y),
                    Position = cfg.position,
                    Active = true, 
                    BorderColor3 = rgb(0, 0, 0),
                    Size = cfg.size,
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.outline
                })
                
                library.main_frames = library.main_frames or {}
                table.insert(library.main_frames, items.main_holder)

                library:draggify(items.main_holder)
                library:make_resizable(items.main_holder)

                local Close = library:create( "TextButton" , {
                    Parent = items.main_holder;
                    FontFace = library.font;
                    Name = "\0";
                    AnchorPoint = vec2(1, 0);
                    Active = false;
                    BorderColor3 = rgb(0, 0, 0);
                    Text = "X";
                    Size = dim2(0, 0, 0, 0);
                    Selectable = false;
                    Position = dim2(1, -7, 0, 5);
                    BorderSizePixel = 0;
                    BackgroundTransparency = 1;
                    TextXAlignment = Enum.TextXAlignment.Right;
                    AutomaticSize = Enum.AutomaticSize.XY;
                    TextColor3 = themes.preset.text;
                    TextSize = 12;
                    ZIndex = 100;
                    BackgroundColor3 = rgb(255, 255, 255)
                });

                library:create( "UIStroke" , {
                    Parent = Close
                });         
                
                Close.MouseButton1Click:Connect(function()
                    items.sgui.Enabled = false;
                end)

                
                
                items.window_inline = library:create("Frame", {
                    Parent = items.main_holder,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.accent
                })
                
                library:apply_theme(items.window_inline, "accent", "BackgroundColor3") 
                
                items.window_holder = library:create("Frame", {
                    Parent = items.window_inline,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = themes.preset.outline,
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                            
                items.UIGradient = library:create("UIGradient", {
                    Parent = items.window_holder,
                    Name = "",
                    Rotation = 90,
                    Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
                })
    
                library:apply_theme(items.UIGradient, "contrast", "Color") 
                
                items.text = library:create("TextLabel", {
                    Parent = items.window_holder,
                    Name = "",
                    FontFace = library.font,
                    TextColor3 = themes.preset.accent,
                    BorderColor3 = rgb(0, 0, 0),
                    Text = cfg.name,
                    BackgroundTransparency = 1,
                    Position = dim2(0, 2, 0, 4),
                    BorderSizePixel = 0,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    Size = dim2(1, -20, 0, 0),
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextTruncate = Enum.TextTruncate.AtEnd,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) library:apply_theme(items.text, "accent", "TextColor3")
                
                items.UIStroke = library:create("UIStroke", {
                    Parent = items.text,
                    Name = "",
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
                
                items.UIPadding = library:create("UIPadding", {
                    Parent = items.window_holder,
                    Name = "",
                    PaddingBottom = dim(0, 4),
                    PaddingRight = dim(0, 4),
                    PaddingLeft = dim(0, 4)
                })
                
                items.outline = library:create("Frame", {
                    Parent = items.window_holder,
                    Name = "",
                    Position = dim2(0, 0, 0, 18),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, 0, 1, -18),
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.inline
                })
                
                library:apply_theme(items.outline, "inline", "BackgroundColor3") 
                
                items.inline = library:create("Frame", {
                    Parent = items.outline,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.outline
                })
                
                library:apply_theme(items.inline, "outline", "BackgroundColor3") 
                
                items.holder = library:create("Frame", {
                    Parent = items.inline,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                items.UIGradient = library:create("UIGradient", {
                    Parent = items.holder,
                    Name = "",
                    Rotation = 90,
                    Color = rgbseq{
                        rgbkey(0, rgb(41, 41, 55)),
                        rgbkey(1, rgb(35, 35, 47))
                    }
                })
                
                library:apply_theme(items.UIGradient, "contrast", "Color") 
                
                items.UIPadding = library:create("UIPadding", {
                    Parent = items.holder,
                    Name = "",
                    PaddingTop = dim(0, 5),
                    PaddingBottom = dim(0, 5),
                    PaddingRight = dim(0, 5),
                    PaddingLeft = dim(0, 5)
                })
                
                items.glow = library:create("ImageLabel", {
                    Parent = items.main_holder,
                    Name = "",
                    ImageColor3 = themes.preset.glow,
                    ScaleType = Enum.ScaleType.Slice,
                    BorderColor3 = rgb(0, 0, 0),
                    BackgroundColor3 = rgb(255, 255, 255),
                    Visible = true,
                    Image = "http://www.roblox.com/asset/?id=18245826428",
                    BackgroundTransparency = 1,
                    ImageTransparency = 0.8, 
                    Position = dim2(0, -20, 0, -20),
                    Size = dim2(1, 40, 1, 40),
                    ZIndex = 2,
                    BorderSizePixel = 0,
                    SliceCenter = rect(vec2(21, 21), vec2(79, 79))
                }) library:apply_theme(items.glow, "glow", "ImageColor3") 
            
            
            
                items.button = library:create("TextButton", {
                    Parent = library.dock_holder,
                    Name = "",
                    TextColor3 = rgb(0, 0, 0),
                    BorderColor3 = rgb(0, 0, 0),
                    Text = "",
                    Size = dim2(0, 25, 0, 25),
                    BorderSizePixel = 0,
                    TextSize = 14,
                    BackgroundColor3 = themes.preset.inline
                })
                
                local button_inline = library:create("Frame", {
                    Parent = items.button,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.outline
                }) library:apply_theme(button_inline, "outline", "BackgroundColor3") 
                
                local button_inline = library:create("Frame", {
                    Parent = button_inline,
                    Name = "",
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, -2, 1, -2),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) library:apply_theme(button_inline, "inline", "BackgroundColor3")
                
                local UIGradient = library:create("UIGradient", {
                    Parent = button_inline,
                    Name = "",
                    Rotation = 90,
                    Color = rgbseq{
                        rgbkey(0, rgb(35, 35, 47)),
                        rgbkey(1, rgb(41, 41, 55))
                    }
                }) library:apply_theme(UIGradient, "contrast", "Color") 
                
                items.Icon = library:create("ImageLabel", {
                    Parent = button_inline,
                    Name = "",
                    ImageColor3 = cfg.open and themes.preset.accent or themes.preset.inline,
                    Image = cfg.image,
                    BackgroundTransparency = 1,
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, 0, 1, 0),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) library:apply_theme(items.Icon, "accent", "ImageColor3") library:apply_theme(items.Icon, "inline", "ImageColor3") 
                
                local UIPadding = library:create("UIPadding", {
                    Parent = button_inline,
                    Name = "",
                    PaddingTop = dim(0, 4),
                    PaddingBottom = dim(0, 4),
                    PaddingRight = dim(0, 4),
                    PaddingLeft = dim(0, 4)
                })
            

            library:tool_tip({name = cfg.name, path = items.button})
        end 

        items.sgui:GetPropertyChangedSignal("Enabled"):Connect(function()
            items.Icon.ImageColor3 = items.sgui.Enabled and themes.preset.accent or themes.preset.inline
        end)

        items.button.MouseButton1Click:Connect(function()
            items.sgui.Enabled = not items.sgui.Enabled
        end)
        
        return setmetatable(cfg, library)
    end 

    local sgui = library:create("ScreenGui", {
        Enabled = true,
        Parent = gethui(),
        Name = "",
        DisplayOrder = 999999, 
    })

    local notif_holder = library:create("ScreenGui", {
        Parent = gethui(),
        Name = "",
        IgnoreGuiInset = true, 
        DisplayOrder = 999999, 
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    function library:fold_elements(origin, elements)
        for _, x in next, elements do 
            local flag = library.visible_flags[x]

            if flag then    
                flag(flags[origin])
            end     
        end 
    end 

    function library:indicator() 
        local cfg = {
            items = {};
        }

        local items = cfg.items; do 
            items.Window = library:create( "Frame" , {
                Parent = sgui;
                Name = "\0";
                Position = dim2(0, 400, 0, 500);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(0, 322, 0, 147);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.outline
            });	library:apply_theme(items.Window, "outline", "BackgroundColor3"); library:draggify(items.Window)
            
            items.InfoTitle = library:create( "TextLabel" , {
                FontFace = library.font;
                TextColor3 = themes.preset.text;
                BorderColor3 = rgb(0, 0, 0);
                Text = "Indicators";
                Parent = items.Window;
                Name = "\0";
                Size = dim2(1, 0, 0, 0);
                Position = dim2(0, 7, 0, 5);
                BackgroundTransparency = 1;
                TextXAlignment = Enum.TextXAlignment.Left;
                BorderSizePixel = 0;
                ZIndex = 5;
                AutomaticSize = Enum.AutomaticSize.Y;
                TextSize = 12;
            }); 

            items.Accent = library:create( "Frame" , {
                Parent = items.Window;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.accent
            });	library:apply_theme(items.Accent, "accent", "BackgroundColor3")
            
            items.Background = library:create( "Frame" , {
                Parent = items.Accent;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.high_contrast
            });	library:apply_theme(items.Background, "high_contrast", "BackgroundColor3")
            
            items.Inline = library:create( "Frame" , {
                Parent = items.Background;
                Name = "\0";
                Position = dim2(0, 4, 0, 18);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -8, 1, -22);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.outline
            });	library:apply_theme(items.Inline, "outline", "BackgroundColor3")
            
            items.Outline = library:create( "Frame" , {
                Parent = items.Inline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.inline
            });	library:apply_theme(items.Outline, "inline", "BackgroundColor3")
            
            items.LowContrast = library:create( "Frame" , {
                Parent = items.Outline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.low_contrast
            });	library:apply_theme(items.LowContrast, "low_contrast", "BackgroundColor3")
            
            items.Inline = library:create( "Frame" , {
                Parent = items.LowContrast;
                Name = "\0";
                Position = dim2(0, 4, 0, 4);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -8, 1, -8);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.inline
            });	library:apply_theme(items.Inline, "inline", "BackgroundColor3")
            
            items.Outline = library:create( "Frame" , {
                Parent = items.Inline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.outline
            });	library:apply_theme(items.Outline, "outline", "BackgroundColor3")
            
            items.LowContrast = library:create( "Frame" , {
                Parent = items.Outline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.low_contrast
            });	library:apply_theme(items.LowContrast, "low_contrast", "BackgroundColor3"); local image_holder = items.LowContrast;
            
            items.Inline = library:create( "Frame" , {
                Parent = items.LowContrast;
                Name = "\0";
                Position = dim2(0, 4, 0, 4);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -8, 1, -8);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.inline
            });	library:apply_theme(items.Inline, "inline", "BackgroundColor3")
            
            items.Outline = library:create( "Frame" , {
                Parent = items.Inline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.outline
            });	library:apply_theme(items.Outline, "outline", "BackgroundColor3")
            
            items.LowContrast = library:create( "Frame" , {
                Parent = items.Outline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.low_contrast
            });	library:apply_theme(items.LowContrast, "low_contrast", "BackgroundColor3")

            items.InfoTitle = library:create( "TextLabel" , {
                FontFace = library.font;
                TextColor3 = themes.preset.text;
                BorderColor3 = rgb(0, 0, 0);
                Text = "Info";
                Parent = items.Outline;
                Name = "\0";
                Size = dim2(1, 0, 0, 0);
                Position = dim2(0, 7, 0, 5);
                BackgroundTransparency = 1;
                TextXAlignment = Enum.TextXAlignment.Left;
                BorderSizePixel = 0;
                ZIndex = 5;
                AutomaticSize = Enum.AutomaticSize.Y;
                TextSize = 12;
            });

            library:create( "UIStroke" , {
                Parent = items.InfoTitle
            });
            
            items.Accent = library:create( "Frame" , {
                Name = "\0";
                Parent = items.LowContrast;
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, 0, 0, 2);
                BackgroundColor3 = themes.preset.accent;
                BorderSizePixel = 0;
            });	library:apply_theme(items.Accent, "accent", "BackgroundColor3");
            
            items.Shadow = library:create( "Frame" , {
                AnchorPoint = vec2(0, 1);
                Parent = items.Accent;
                Name = "\0";
                Position = dim2(0, 0, 1, 0);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, 0, 0, 1);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.accent;
            }); library:apply_theme(items.Shadow, "accent", "BackgroundColor3");
            
            library:create( "UIGradient" , {
                Rotation = 90;
                Parent = items.Shadow;
                Color = rgbseq{rgbkey(0, rgb(150, 150, 150)), rgbkey(1, rgb(150, 150, 150))}
            });
            
            items.holder = library:create( "Frame" , {
                Parent = items.LowContrast;
                Name = "\0";
                Position = dim2(0, 76, 0, 21);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -80, 0, 0);
                BorderSizePixel = 0;
            });	

            library:create("UIListLayout", {
                Parent = items.holder,
                Padding = dim(0, 4),
                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            items.Inline = library:create( "Frame" , {
                Parent = image_holder;
                Name = "\0";
                Position = dim2(0, 10, 0, 28);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(0, 68, 0, 67);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.outline
            });	library:apply_theme(items.Inline, "outline", "BackgroundColor3")
            
            items.Outline = library:create( "Frame" , {
                Parent = items.Inline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.inline
            });	library:apply_theme(items.Outline, "inline", "BackgroundColor3")
            
            items.LowContrast = library:create( "Frame" , {
                Parent = items.Outline;
                Name = "\0";
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.low_contrast
            });	library:apply_theme(items.LowContrast, "low_contrast", "BackgroundColor3")

            items.Profile = library:create( "ImageLabel" , {
                BorderColor3 = rgb(0, 0, 0);
                Parent = items.LowContrast;
                Image = "rbxasset://textures/ui/GuiImagePlaceholder.png";
                BackgroundTransparency = 1;
                Name = "\0";
                Size = dim2(1, 0, 1, 0);
                BorderSizePixel = 0;
            });	

            local section = setmetatable(items, library)
            items.label = section:label({name = "Player: "})
            items.label.instance.TextWrapped = true
            items.label.instance.Size = dim2(1, 0, 0, 0)
            items.label.instance.Parent.Size = dim2(1, -4, 0, 14)
            items.slider = section:slider({name = "Health", custom = rgb(255, 0, 0), min = 0, max = 100, default = 50, input = true})
            
            library:create( "UIStroke" , {
                Parent = items.InfoTitle
            });            
        end

        function cfg.set_visible(bool)
            items.Window.Visible = bool
        end 

        function cfg.change_health(int)
            items.slider.set(int)
            if items.slider.fill then
                if int > 70 then
                    items.slider.fill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                elseif int > 30 then
                    items.slider.fill.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
                else
                    items.slider.fill.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                end
            end
        end

        function cfg.change_profile(player)
            items.label.set(string.format("Player: %s (%s)", player.Name, player.DisplayName))
            items.Profile.Image = "rbxthumb://type=AvatarHeadShot&id=" .. player.UserId .. "&w=420&h=420"
        end 

        return setmetatable(cfg, library)
    end     

    function library:window(properties)
        local window = {opened = true}            
        local opened = {}
        local dock_outline;
        local blur = library:create( "BlurEffect" , {
            Parent = lighting;
            Enabled = true;
            Size = 15
        });    

        library.cache = library:create("ScreenGui", {
            Enabled = false,
            Parent = gethui(),
            Name = "" 
        })

        function window.set_menu_visibility(bool) 
            window.opened = bool 
            library.menu_open = bool
            
            if bool then 
                for _,gui in opened do 
                    gui.Enabled = true 
                    opened = {}
                end 
            else
                for _,gui in library.guis do 
                    if gui.Enabled and gui ~= sgui then 
                        gui.Enabled = false
                        table.insert(opened, gui)
                    end
                end
            end
            
            library:tween(blur, {Size = bool and (flags["Blur Size"] or 15) or 0})
            
            dock_outline.Visible = true;

            sgui.Enabled = true
            notif_holder.Enabled = true
            tooltip_sgui.Enabled = true
            library.cache.Enabled = false

            for _,tooltip in tooltip_sgui:GetChildren() do 
                tooltip.Visible = false;
            end 

            if library.current_element_open then 
                library.current_element_open.set_visible(false)
                library.current_element_open.open = false 
                library.current_element_open = nil 
            end
        end 

        
            dock_outline = library:create("Frame", {
                Parent = sgui,
                Name = "",
                Visible = true,
                BorderColor3 = rgb(0, 0, 0),
                AnchorPoint = vec2(0, 1),
                Position = dim2(0, 10, 1, -360 - 45), -- Approx position above where keybinds was
                Size = dim2(0, 157, 0, 39),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }); 

            library:apply_theme(dock_outline, "outline", "BackgroundColor3"); 
            -- dock_outline.Position = dim2(0, dock_outline.AbsolutePosition.X, 0, dock_outline.AbsolutePosition.Y); -- Remove auto-adjustment to let it float
            dock_outline.AnchorPoint = vec2(0, 0); 
            library:draggify(dock_outline);

            local dock_inline = library:create("Frame", {
                Parent = dock_outline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(dock_inline, "inline", "BackgroundColor3") 
            
            local dock_holder = library:create("Frame", {
                Parent = dock_inline,
                Name = "",
                Size = dim2(1, -2, 1, -2),
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = themes.preset.outline,
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            }) library:apply_theme(dock_holder, "outline", "BackgroundColor3") 
            
            local accent = library:create("Frame", {
                Parent = dock_holder,
                Name = "",
                Size = dim2(1, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            }) library:apply_theme(accent, "accent", "BackgroundColor3") 
            
            local UIGradient = library:create("UIGradient", {
                Parent = accent,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                rgbkey(0, rgb(255, 255, 255)),
                rgbkey(1, rgb(167, 167, 167))
            }
            })
            
            library:create("ImageLabel", {
                Parent = dock_holder,
                Name = "MinecraftHeart",
                BackgroundTransparency = 1,
                Position = dim2(1, -2, 0, 4), 
                Size = dim2(0, 14, 0, 14),
                AnchorPoint = vec2(1, 0),
                Image = "rbxassetid://10755569986",
                ZIndex = 5
            })

            local button_holder = library:create("Frame", {
                Parent = dock_holder,
                Name = "",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            }) library.dock_holder = button_holder;
            
            local UIListLayout = library:create("UIListLayout", {
                Parent = button_holder,
                Name = "",
                Padding = dim(0, 5),
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            local UIPadding = library:create("UIPadding", {
                Parent = button_holder,
                Name = "",
                PaddingTop = dim(0, 6),
                PaddingBottom = dim(0, 4),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })
                    
            local UIGradient = library:create("UIGradient", {
                Parent = dock_holder,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
        

        
            local outline = library:create("Frame", {
                Parent = dock_outline, -- Parented to dock
                Name = "",
                Visible = false, 
                Active = true,
                Draggable = false, -- Disabled individual dragging
                AnchorPoint = Vector2.new(0, 0),
                Position = dim2(0, 0, 1, 2), -- Below dock
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 182, 0, 25),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            library:apply_theme(outline, "outline", "BackgroundColor3") 
            -- library:draggify(outline) -- Removed draggify
            library:make_resizable(outline)
            library.keybind_list_frame = outline 
            
            local inline = library:create("Frame", {
                Parent = outline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            library:apply_theme(inline, "inline", "BackgroundColor3")

            local background = library:create("Frame", {
                Parent = inline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, themes.preset.high_contrast),
                    rgbkey(1, themes.preset.low_contrast)
                }
            })
            library:apply_theme(UIGradient, "contrast", "Color") 
            
            local bg = library:create("Frame", {
                Parent = background,
                Name = "a",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 0, 2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            }); library:apply_theme(bg, "accent", "BackgroundColor3")
            
            
            library:create("UIGradient", {
                Parent = bg,
                Name = "",
                Enabled = true, 
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })
            
            local text = library:create("TextLabel", {
                Parent = background,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "Keybinds",
                BackgroundTransparency = 1,
                TextTruncate = Enum.TextTruncate.AtEnd,
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                TextSize = 12,
                BackgroundColor3 = themes.preset.text
            }, "text")
            
            local UIStroke = library:create("UIStroke", {
                Parent = text,
                Name = "",
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            local text_holder = library:create("Frame", {
                Parent = background,
                Name = "",
                Position = dim2(0, -2, 1, 1),
                Size = dim2(1, 4, 0, 0),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline
            })
            library:apply_theme(text_holder, "outline", "BackgroundColor3")

            local inline = library:create("Frame", {
                Parent = text_holder,
                Name = "",
                Size = dim2(1, -2, 1, -2),
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                
                BackgroundColor3 = themes.preset.inline
            })
            library:apply_theme(inline, "inline", "BackgroundColor3")
            
            local background = library:create("Frame", {
                Parent = inline,
                Name = "",
                Size = dim2(1, -2, 1, -2),
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                
                BackgroundColor3 = rgb(255, 255, 255)
            })
            library.keybind_list = background
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, themes.preset.high_contrast),
                    rgbkey(1, themes.preset.low_contrast)
                }
            })
            library:apply_theme(UIGradient, "contrast", "Color") 
            
            library:create("UIListLayout", {
                Parent = background,
                Name = "",
                Padding = dim(0, -1),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            library:create("UIPadding", {
                Parent = background,
                Name = "",
                PaddingBottom = dim(0, 4),
                PaddingLeft = dim(0, 5)
            })
        

        
            local main_window = library:panel({
                name = properties and properties.name or "Home | ", 
                size = dim2(0, 604, 0, 628),
                position = dim2(0, (camera.ViewportSize.X / 2) - 302 - 96, 0, (camera.ViewportSize.Y / 2) - 421 - 12),
                image = "rbxassetid://98823308062942",
            })

            local items = main_window.items

            window["tab_holder"] = library:create("Frame", {
                Parent = items.holder,
                Name = " ",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 0, 22),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 5,
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            library:create("UIListLayout", {
                Parent = window["tab_holder"],
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Padding = dim(0, 2),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            local section_holder = library:create("Frame", {
                Parent = items.holder,
                Name = " ",
                BackgroundTransparency = 1,
                Position = dim2(0, -1, 0, 19),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, -22),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            window["section_holder"] = section_holder

            local outline = library:create("Frame", {
                Parent = section_holder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            
            library:apply_theme(outline, "outline", "BackgroundColor3") 

            local inline = library:create("Frame", {
                Parent = outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            
            library:apply_theme(inline, "inline", "BackgroundColor3") 

            local background = library:create("Frame", {
                Parent = inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            library.section_holder = background

            library:create("UIPadding", {
                Parent = background,
                PaddingTop = dim(0, 4),
                PaddingBottom = dim(0, 4),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })

            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            })
            
            library:apply_theme(UIGradient, "contrast", "Color") 
            library:make_resizable(items.main_holder) 
        

        
            local style = library:panel({
                name = "Style", 
                anchor_point = vec2(0, 0),
                size = dim2(0, 394, 0, 464),
                position = dim2(0, main_window.items.main_holder.AbsolutePosition.X + main_window.items.main_holder.AbsoluteSize.X + 2, 0, main_window.items.main_holder.AbsolutePosition.Y),
                image = "rbxassetid://115194686863276",
                open = false,
            })

            local watermark = library:watermark({default = os.date('Home |  - %b %d %Y - %H:%M:%S')})  

            task.spawn(function()
                while task.wait(1) do 
                    watermark.change_text(os.date('Home - Beta - %b %d %Y - %H:%M:%S'))
                end 
            end) 

            local items = style.items

            local column = setmetatable(items, library):column() 
            local section = column:section({name = "Theme"})
            section:label({name = "Accent"})
            :colorpicker({name = "Accent", color = themes.preset.accent, flag = "accent", callback = function(color, alpha)
                library:update_theme("accent", color)
            end, flag = "Accent"})
            section:label({name = "Contrast"})
            :colorpicker({name = "Low", color = themes.preset.low_contrast, flag = "low_contrast", callback = function(color)
                if (flags["high_contrast"] and flags["low_contrast"]) then 
                    library:update_theme("contrast", rgbseq{
                        rgbkey(0, flags["low_contrast"].Color),
                        rgbkey(1, flags["high_contrast"].Color)
                    })
                end 

                library:update_theme("low_contrast", flags["low_contrast"].Color)
            end})
            :colorpicker({name = "High", color = themes.preset.high_contrast, flag = "high_contrast", callback = function(color)
                library:update_theme("contrast", rgbseq{
                    rgbkey(0, flags["low_contrast"].Color),
                    rgbkey(1, flags["high_contrast"].Color)
                })

                library:update_theme("high_contrast", flags["high_contrast"].Color)
            end})
            section:label({name = "Inline"})
            :colorpicker({name = "Inline", color = themes.preset.inline, callback = function(color, alpha)
                library:update_theme("inline", color)
            end, flag = "Inline"})
            section:label({name = "Outline"})
            :colorpicker({name = "Outline", color = themes.preset.outline, callback = function(color, alpha)
                library:update_theme("outline", color)
            end, flag = "Outline"})
            section:label({name = "Text Color"})
            :colorpicker({name = "Main", color = themes.preset.text, callback = function(color, alpha)
                library:update_theme("text", color)
            end, flag = "Main"})
            :colorpicker({name = "Outline", color = themes.preset.text_outline, callback = function(color, alpha)
                library:update_theme("text_outline", color)
            end, flag = "Outline"})
            section:label({name = "Glow"})
            :colorpicker({name = "Glow", color = themes.preset.glow, callback = function(color, alpha)
                library:update_theme("glow", color)
            end, flag = "Glow"})
            section:slider({name = "Blur Size", flag = "Blur Size", min = 0, max = 56, default = 10, interval = 1, callback = function(int)
                if window.opened then 
                    blur.Size = int
                end
            end})
            local section = column:section({name = "Other"})
            section:label({name = "UI Bind"})
            :keybind({callback = window.set_menu_visibility, key = Enum.KeyCode.Z})
            section:toggle({name = "Keybind List", flag = "keybind_list", default = true, callback = function(bool)
                library.keybind_list_frame.Visible = bool
            end})
            section:toggle({name = "Watermark", flag = "watermark", default = false, callback = function(bool)
                watermark.set_visible(bool)
            end})
            library.keybind_list_frame.Visible = true
            watermark.set_visible(false)
            section:button_holder({})
            section:button({name = "Copy JobId", callback = function()
                setclipboard(game.JobId)
            end})
            section:button_holder({})
            section:button({name = "Copy GameID", callback = function()
                setclipboard(game.GameId)
            end})
            section:button_holder({})
            section:button({name = "Copy Join Script", callback = function()
                setclipboard('game:GetService("TeleportService"):TeleportToPlaceInstance(' .. game.PlaceId .. ', "' .. game.JobId .. '", game.Players.LocalPlayer)')
            end})
            section:button_holder({})
            section:button({name = "Rejoin", callback = function()
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, lp)
            end})
            section:button_holder({})
            section:button({name = "Join New Server", callback = function()
                local apiRequest = game:GetService("HttpService"):JSONDecode(game:HttpGetAsync("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
                local data = apiRequest.data[random(1, #apiRequest.data)]
                    
                if data.playing <= flags["max_players"] then 
                    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, data.id)
                end 
            end})
            section:slider({name = "Max Players", flag = "max_players", min = 0, max = 40, default = 15, interval = 1})
        

        
            local configurations = library:panel({
                name = "Configurations", 
                size = dim2(0, 324, 0, 410),
                position = dim2(0, items.main_holder.AbsolutePosition.X + items.main_holder.AbsoluteSize.X + 2, 0, items.main_holder.AbsolutePosition.Y),
                image = "rbxassetid://105199726008012",
                open = false,
            }) 

            local items = configurations.items

            getgenv().load_config = function(name)
                library:load_config(readfile(library.directory .. "/configs/" .. name .. ".cfg"))
            end 

            local column = setmetatable(items, library):column() 
            local section = column:section({name = "Options"})
                config_holder = section:list({flag = "config_name_list"})
                section:textbox({flag = "config_name_text_box"})
                section:button_holder({})
                section:button({name = "Create", callback = function()
                    writefile(library.directory .. "/configs/" .. flags["config_name_text_box"] .. ".cfg", library:get_config())
                    library:config_list_update()
                end})
                section:button({name = "Delete", callback = function()
                    delfile(library.directory .. "/configs/" .. flags["config_name_list"] .. ".cfg")
                    library:config_list_update()
                end})
                section:button_holder({})
                section:button({name = "Load", callback = function()
                    library:load_config(readfile(library.directory .. "/configs/" .. flags["config_name_list"] .. ".cfg"))
                    library:notification({text = "Loaded Config: " .. flags["config_name_list"], time = 3})
                end})
                section:button({name = "Save", callback = function()
                    writefile(library.directory .. "/configs/" .. flags["config_name_list"] .. ".cfg", library:get_config())
                    library:config_list_update()
                    library:notification({text = "Saved Config: " .. flags["config_name_list"], time = 3})
                end})
                section:button_holder({})
                section:button({name = "Refresh Configs", callback = function()
                    library:config_list_update()
                end})
                section:button_holder({})
                section:button({name = "Unload Config", callback = function()
                    library:load_config(library.old_config)
                end})
                section:button({name = "Unload Menu", callback = function()
                    library:load_config(library.old_config)

                    for _, gui in library.guis do 
                        gui:Destroy() 
                    end 

                    for _, connection in library.connections do 
                        connection:Disconnect() 
                    end

                    blur:Destroy()
                end})
        
                
        
            local esp_preview = library:panel({
                name = "ESP Preview", 
                anchor_point = vec2(0, 0),
                size = dim2(0, 300, 0, 325),
                position = dim2(0, style.items.main_holder.AbsolutePosition.X, 0, style.items.main_holder.AbsolutePosition.Y + style.items.main_holder.AbsoluteSize.Y + 2),
                image = "rbxassetid://77684377836328",
                open = false,
            })  
            
            local items = esp_preview.items
            
            local column = setmetatable(items, library):column() 
            window.esp_section = column:section({name = "Main"})
            flags["Enabled"] = flags["Enabled"] ~= nil and flags["Enabled"] or true
            flags["Name_Color"] = flags["Name_Color"] or { Color = Color3.fromRGB(255,255,255) }
            flags["Distance_Color"] = flags["Distance_Color"] or { Color = Color3.fromRGB(255,255,255) }
            flags["Weapon_Color"] = flags["Weapon_Color"] or { Color = Color3.fromRGB(255,255,255) }
            flags["Health_Low"] = flags["Health_Low"] or { Color = Color3.fromRGB(255, 0, 0) }
            flags["Health_High"] = flags["Health_High"] or { Color = Color3.fromRGB(0, 255, 0) }
            local espPreview = window.esp_section:esp_preview({})
            window.esp_preview = espPreview
            if espPreview and espPreview.items and espPreview.items.viewportframe then
                espPreview.items.viewportframe.Visible = true
            end
            espPreview.refresh_elements()
        

        
            local playerlist = library:panel({
                name = "Playerlist", 
                anchor_point = vec2(0, 0),
                size = dim2(0, 529, 0, 445),
                position = dim2(0, main_window.items.main_holder.AbsolutePosition.X - 531, 0, main_window.items.main_holder.AbsolutePosition.Y),
                image = "rbxassetid://107070078834415",
                open = false,
            })  
            
            local items = playerlist.items

            local column = setmetatable(items, library):column() 
            local section = column:section({name = "Playerlist"})
            local playerlist_element = section:playerlist({})
            section:dropdown({name = "Priority", items = {"Enemy", "Priority", "Neutral", "Friendly"}, default = "Neutral", flag = "PLAYERLIST_DROPDOWN", callback = function(text)
                library.prioritize(text)
            end})

            if main_window and main_window.items and main_window.items.main_holder then
                local deps = {}
                if style and style.items and style.items.main_holder then table.insert(deps, style.items.main_holder) end
                if configurations and configurations.items and configurations.items.main_holder then table.insert(deps, configurations.items.main_holder) end
                if esp_preview and esp_preview.items and esp_preview.items.main_holder then table.insert(deps, esp_preview.items.main_holder) end
                if playerlist and playerlist.items and playerlist.items.main_holder then table.insert(deps, playerlist.items.main_holder) end
                
                dependents_registry[main_window.items.main_holder] = deps
            end

            local function update_layout()
                if not (main_window and main_window.items and main_window.items.main_holder) then return end
                
                local main_frame = main_window.items.main_holder
                local style_frame = style.items.main_holder
                local config_frame = configurations.items.main_holder
                local esp_frame = esp_preview.items.main_holder
                
                local style_enabled = style.items.sgui.Enabled
                local config_enabled = configurations.items.sgui.Enabled
                local esp_enabled = esp_preview.items.sgui.Enabled
                
                -- Use Position/Size (Offset) directly to stay in ScreenGui coordinate space
                -- and avoid AbsolutePosition inset issues.
                local main_pos_x = main_frame.Position.X.Offset
                local main_pos_y = main_frame.Position.Y.Offset
                local main_size_x = main_frame.Size.X.Offset
                
                local slot1_x = main_pos_x + main_size_x + 2
                local slot1_y = main_pos_y
                
                if style_enabled then
                    style_frame.Position = dim2(0, slot1_x, 0, slot1_y)
                    
                    local style_width = style_frame.Size.X.Offset
                    local style_height = style_frame.Size.Y.Offset
                    
                    config_frame.Position = dim2(0, slot1_x + style_width + 2, 0, slot1_y)
                    esp_frame.Position = dim2(0, slot1_x, 0, slot1_y + style_height + 2)
                    
                elseif config_enabled then
                    config_frame.Position = dim2(0, slot1_x, 0, slot1_y)
                    
                    local config_height = config_frame.Size.Y.Offset
                    esp_frame.Position = dim2(0, slot1_x, 0, slot1_y + config_height + 2)
                    
                elseif esp_enabled then
                    esp_frame.Position = dim2(0, slot1_x, 0, slot1_y)
                end
            end

            -- Update layout when panels are enabled/disabled
            if style and style.items and style.items.sgui then
                style.items.sgui:GetPropertyChangedSignal("Enabled"):Connect(update_layout)
            end
            if configurations and configurations.items and configurations.items.sgui then
                configurations.items.sgui:GetPropertyChangedSignal("Enabled"):Connect(update_layout)
            end
            if esp_preview and esp_preview.items and esp_preview.items.sgui then
                esp_preview.items.sgui:GetPropertyChangedSignal("Enabled"):Connect(update_layout)
            end

            -- Update layout when panels are resized
            if main_window and main_window.items and main_window.items.main_holder then
                main_window.items.main_holder:GetPropertyChangedSignal("Size"):Connect(update_layout)
            end
            if style and style.items and style.items.main_holder then
                style.items.main_holder:GetPropertyChangedSignal("Size"):Connect(update_layout)
            end
            if configurations and configurations.items and configurations.items.main_holder then
                configurations.items.main_holder:GetPropertyChangedSignal("Size"):Connect(update_layout)
            end
            
            task.defer(update_layout)
        
        return setmetatable(window, library)
    end

    function library:watermark(options) 
        local cfg = {
            default = options.text or options.default or os.date('drain.lol | %b %d %Y | %H:%M')
        }

        local watermark_outline = library:create("Frame", {
            Parent = sgui,
            Name = "",
            BorderColor3 = rgb(0, 0, 0),
            AnchorPoint = vec2(1, 1),
            Position = dim2(1, -20, 0, 20),
            Size = dim2(0, 0, 0, 24),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = themes.preset.outline
        }) library:apply_theme(watermark_outline, "outline", "BackgroundColor3") 
        watermark_outline.Position = dim_offset(watermark_outline.AbsolutePosition.X, watermark_outline.AbsolutePosition.Y)
        library:draggify(watermark_outline)

        local watermark_inline = library:create("Frame", {
            Parent = watermark_outline,
            Name = "",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        }) library:apply_theme(watermark_inline, "inline", "BackgroundColor3") 
        
        local watermark_background = library:create("Frame", {
            Parent = watermark_inline,
            Name = "",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local UIGradient = library:create("UIGradient", {
            Parent = watermark_background,
            Name = "",
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
        }) library:apply_theme(UIGradient, "contrast", "Color") 
        
        local text = library:create("TextLabel", {
            Parent = watermark_background,
            Name = "",
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = "  drain.lol | Beta | Aug 29 2024 | 07:29:00  ",
            Size = dim2(0, 0, 1, 0),
            BackgroundTransparency = 1,
            Position = dim2(0, -1, 0, 1),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.X,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIStroke", {
            Parent = text,
            Name = "",
            LineJoinMode = Enum.LineJoinMode.Miter
        })
        
        local accent = library:create("Frame", {
            Parent = watermark_outline,
            Name = "",
            Position = dim2(0, 2, 0, 2),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -4, 0, 2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        }) library:apply_theme(accent, "accent", "BackgroundColor3") 
        
        local UIGradient = library:create("UIGradient", {
            Parent = accent,
            Name = "",
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(255, 255, 255)),
                rgbkey(1, rgb(167, 167, 167))
            }
        })
        
        function cfg.change_text(input)
            text.Text = "  ".. input .."  "
        end 

        function cfg.set_visible(bool) 
            watermark_outline.Visible = bool
        end 


        cfg.change_text(cfg.default)

        return cfg 

    end 

    function library:esp_preview(properties)
        local cfg = {items = {}, rotation = 0; objects = {}; character_model = nil}
        local items = cfg.items

        items.viewportframe = library:create( "ViewportFrame" , {
            Parent = self.holder;
            BackgroundTransparency = 1;
            Size = dim2(1, 0, 0, 220);
            BorderColor3 = rgb(0, 0, 0);
            ZIndex = 1;
            Position = dim2(0, 0, 0, 10);
            BorderSizePixel = 0;
            BackgroundColor3 = rgb(255, 255, 255)
        });
        
        items.camera = library:create( "Camera" , {
            FieldOfView = 70.00022888183594;
            CameraType = Enum.CameraType.Track;
            Focus = cfr(0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1);
            CFrame = cfr(0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1);
            Parent = items.viewportframe;
            Name = "\0"
        }); 

        items.viewportframe.CurrentCamera = items.camera

        items.worldmodel = library:create("WorldModel", {
            Parent = items.viewportframe
        })

        local cached_emote_id = nil

        local function update_character()
            if cfg.character_model then cfg.character_model:Destroy() end
            if not lp.Character then return end
            
            lp.Character.Archivable = true
            local character = lp.Character:Clone()
            if not character then return end
            
            character.Name = "PreviewCharacter"
            if character:FindFirstChild("Animate") then character.Animate:Destroy() end
            character.PrimaryPart = character:FindFirstChild("HumanoidRootPart")

            
            for _, obj in ipairs(character:GetDescendants()) do
                if obj:IsA("BasePart") then
                    obj.CastShadow = false
                    obj.CanCollide = false
                    obj.CanTouch = false
                    obj.CanQuery = false
                    obj.Massless = true
                    if obj.Name == "HumanoidRootPart" then
                        obj.Anchored = true
                    else
                        obj.Anchored = false
                    end
                elseif obj:IsA("Script") or obj:IsA("LocalScript") or obj:IsA("Sound") or obj:IsA("ParticleEmitter") or obj:IsA("Beam") or obj:IsA("Fire") or obj:IsA("Smoke") or obj:IsA("Sparkles") or obj:IsA("Trail") or obj:IsA("Light") or obj:IsA("Explosion") then
                    obj:Destroy()
                elseif obj:IsA("Decal") and obj.Name ~= "face" then
                    obj:Destroy()
                elseif obj:IsA("Texture") then
                    obj:Destroy()
                end
            end
            
            local hum = character:FindFirstChild("Humanoid")
            if hum then
                hum.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
                hum.HealthDisplayType = Enum.HumanoidHealthDisplayType.AlwaysOff
            end

            character.Parent = items.worldmodel
            items.camera.CameraSubject = character
            
            if cfg.objects["chams"] then
                cfg.objects["chams"].Adornee = character
            end

            
            task.spawn(function()
                local anim = Instance.new("Animation")
                
                if cached_emote_id then
                    anim.AnimationId = cached_emote_id
                else
                    anim.AnimationId = "rbxassetid://83716500004313"

                    
                    local success, result = pcall(function()
                        return game:GetObjects("rbxassetid://83716500004313")[1]
                    end)
                    
                    if success and result then
                        local found_anim = result:IsA("Animation") and result or result:FindFirstChildWhichIsA("Animation")
                        if found_anim then
                            anim.AnimationId = found_anim.AnimationId
                            cached_emote_id = anim.AnimationId
                        end
                        result:Destroy()
                    end
                end

                local humanoid = character:FindFirstChild("Humanoid")
                if humanoid then
                    local animator = humanoid:FindFirstChildOfClass("Animator")
                    if not animator then
                        animator = Instance.new("Animator")
                        animator.Parent = humanoid
                    end
                    local track = animator:LoadAnimation(anim)
                    track.Priority = Enum.AnimationPriority.Action
                    track.Looped = true
                    track:Play()
                end
            end)

            cfg.character_model = character
        end

        update_character()
        library:connection(lp.CharacterAdded, function(char)
            task.wait(10) 
            if lp.Character == char then
                update_character()
            end
        end)
        
        local chams = Instance.new("Highlight")
        chams.Name = "PreviewChams"
        chams.FillColor = Color3.fromRGB(0, 120, 255)
        chams.OutlineColor = Color3.fromRGB(255, 255, 255)
        chams.DepthMode = Enum.HighlightDepthMode.Occluded
        chams.Enabled = false
        chams.Adornee = cfg.character_model
        chams.Parent = items.viewportframe
        cfg.objects["chams"] = chams

        local lastRotate = 0
        local rotateInterval = 1/15 
        local lastHealthUpdate = 0
        local healthInterval = 0.2

        library:connection(run.Heartbeat, function()
            if not sgui.Enabled or not items.viewportframe.Visible or not cfg.character_model then return end
            local now = tick()
            
            
            if (now - lastRotate) >= rotateInterval then
                lastRotate = now
                cfg.rotation += 1.0 
                if cfg.character_model.PrimaryPart then
                    cfg.character_model:PivotTo(cfr(Vector3.new(0, 1, -6)) * angle(0, math.rad(cfg.rotation), 0))
                end
            end

            
            if (now - lastHealthUpdate) >= healthInterval then
                lastHealthUpdate = now
                cfg.change_health()
            end
        end)

        local objects = cfg.objects; do 
            objects[ "holder" ] = library:create( "Frame" , {
                Parent = items.viewportframe;
                Name = "\0";
                BackgroundTransparency = 1;
                Position = dim2(0.5, 0, 0.5, 10);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(0, 135, 0, 190);
                BorderSizePixel = 0;
                AnchorPoint = vec2(0.5, 0.5);
                BackgroundColor3 = rgb(255, 255, 255)
            });
            
            objects["skeleton"] = library:create("Frame", {
                Parent = library.cache,
                Name = "skeleton",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                Position = dim2(0, 0, 0, 0)
            })
            local function skeleton_line(name, pos, size)
                local f = library:create("Frame", {
                    Parent = objects["skeleton"],
                    Name = name,
                    BackgroundColor3 = ESP_SETTINGS.SkeletonColor,
                    BorderSizePixel = 0,
                    Position = pos,
                    Size = size
                })
                return f
            end
            local torso = skeleton_line("torso", dim2(0.5, -2, 0.25, 10), dim2(0, 4, 0.5, -20))
            local head = skeleton_line("head", dim2(0.5, -6, 0.15, 0), dim2(0, 12, 0, 12))
            local larm = skeleton_line("larm", dim2(0.4, -10, 0.3, 10), dim2(0, 12, 0.2, 0))
            local rarm = skeleton_line("rarm", dim2(0.6, -2, 0.3, 10), dim2(0, 12, 0.2, 0))
            local lleg = skeleton_line("lleg", dim2(0.48, -2, 0.75, -50), dim2(0, 3, 0.2, 0))
            local rleg = skeleton_line("rleg", dim2(0.52, 0, 0.75, -50), dim2(0, 3, 0.2, 0))
            
            objects[ "box_outline" ] = library:create( "UIStroke" , {
                Parent = library.cache;
                LineJoinMode = Enum.LineJoinMode.Miter
            });
            
            objects[ "name" ] = library:create( "TextLabel" , {
                FontFace = library.font;
                Parent = library.cache;
                TextColor3 = flags["Name_Color"].Color;
                BorderColor3 = rgb(0, 0, 0);
                Text = string.format("%s (@%s)", lp.DisplayName, lp.Name);
                Name = "\0";
                TextStrokeTransparency = 0;
                AnchorPoint = vec2(0, 1);
                Size = dim2(1, 0, 0, 0);
                BackgroundTransparency = 1;
                Position = dim2(0, 0, 0, -5);
                BorderSizePixel = 0;
                AutomaticSize = Enum.AutomaticSize.Y;
                TextSize = 12;
            });
            
            objects[ "box_handler" ] = library:create( "Frame" , {
                Parent = library.cache;
                Name = "\0";
                BackgroundTransparency = 1;
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = rgb(255, 255, 255)
            });
            
            objects[ "box_color" ] = library:create( "UIStroke" , {
                Color = rgb(255, 255, 255);
                LineJoinMode = Enum.LineJoinMode.Miter;
                Name = "\0";
                Parent = objects[ "box_handler" ]
            });
            
            objects[ "outline" ] = library:create( "Frame" , {
                Parent = objects[ "box_handler" ];
                Name = "\0";
                BackgroundTransparency = 1;
                Position = dim2(0, 1, 0, 1);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -2, 1, -2);
                BorderSizePixel = 0;
                BackgroundColor3 = rgb(255, 255, 255)
            });
            
            library:create( "UIStroke" , {
                Parent = objects[ "outline" ];
                LineJoinMode = Enum.LineJoinMode.Miter
            });  
            
            
            
            
            
                objects[ "healthbar_holder" ] = library:create( "Frame" , {
                    AnchorPoint = vec2(1, 0);
                    Parent = library.cache;
                    Name = "\0";
                    Position = dim2(0, -5, 0, 0);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(0, 4, 1, 0);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(0, 0, 0)
                });
                
                objects[ "healthbar" ] = library:create( "Frame" , {
                    Parent = objects[ "healthbar_holder" ];
                    Name = "\0";
                    Position = dim2(0, 1, 0, 1);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, -2, 1, -2);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                });
            

            
                objects[ "distance" ] = library:create( "TextLabel" , {
                    FontFace = library.font;
                    TextColor3 = flags["Distance_Color"].Color;
                    BorderColor3 = rgb(0, 0, 0);
                    Text = "127st";
                    Parent = library.cache;
                    TextStrokeTransparency = 0;
                    Name = "\0";
                    Size = dim2(1, 0, 0, 0);
                    BackgroundTransparency = 1;
                    Position = dim2(0, 0, 1, 5);
                    BorderSizePixel = 0;
                    AutomaticSize = Enum.AutomaticSize.Y;
                    TextSize = 12;
                });                
            

            
                objects[ "weapon" ] = library:create( "TextLabel" , {
                    FontFace = library.font;
                    TextColor3 = flags["Weapon_Color"].Color;
                    BorderColor3 = rgb(0, 0, 0);
                    Text = "[ Weapon ]";
                    Parent = library.cache;
                    TextStrokeTransparency = 0;
                    Name = "\0";
                    Size = dim2(1, 0, 0, 0);
                    BackgroundTransparency = 1;
                    Position = dim2(0, 0, 1, 19);
                    BorderSizePixel = 0;
                    AutomaticSize = Enum.AutomaticSize.Y;
                    TextSize = 12;
                });
            
        end 

        cfg.change_health = function()
            if not cfg.character_model then return end
            if flags[ "healthbar_holder" ] and flags[ "healthbar_holder" ].Parent ~= objects[ "holder" ] then 
                return 
            end

            local humanoid = cfg.character_model:FindFirstChild("Humanoid")
            if not humanoid then return end
            
            local multiplier = math.abs(math.sin(tick() * 2))
            local color = flags[ "Health_Low" ].Color:Lerp( flags["Health_High"].Color, multiplier)
            
            objects[ "healthbar" ].Size = UDim2.new(1, -2, multiplier, -2)
            objects[ "healthbar" ].Position = UDim2.new(0, 1, 1 - multiplier, 1)
            objects[ "healthbar" ].BackgroundColor3 = color
        end 

        function cfg.refresh_elements( )                                
            objects.holder.Parent = flags["Enabled"] and items.viewportframe or library.cache
            objects["name"].TextColor3 = (flags["Name_Color"] and flags["Name_Color"].Color) or objects["name"].TextColor3
            objects["distance"].TextColor3 = (flags["Distance_Color"] and flags["Distance_Color"].Color) or objects["distance"].TextColor3
            objects["weapon"].TextColor3 = (flags["Weapon_Color"] and flags["Weapon_Color"].Color) or objects["weapon"].TextColor3
            objects["name"].Parent = flags["Names"] and objects["holder"] or library.cache
            objects["distance"].Parent = flags["Distance"] and objects["holder"] or library.cache
            objects["weapon"].Parent = library.cache
            objects["box_handler"].Parent = library.cache
            objects["box_outline"].Parent = library.cache
            local sk = objects["skeleton"]
            if sk then
                sk.Parent = flags["Skeleton"] and objects["holder"] or library.cache
                for _, line in ipairs(sk:GetChildren()) do
                    if line:IsA("Frame") then
                        line.BackgroundColor3 = ESP_SETTINGS.SkeletonColor
                    end
                end
            end
            if cfg.objects["chams"] then
                cfg.objects["chams"].Enabled = flags["Chams"] and true or false
            end
        end


        return setmetatable(cfg, library)
    end

    function library:refresh_notifications()  	
        for _, notif in next, library.notifications do 
            tween_service:Create(notif, TweenInfo.new(0.3, Enum.EasingStyle.Exponential, Enum.EasingDirection.InOut), {Position = dim2(0, 20, 0, 72 + (_ * 28))}):Play()
        end     
    end

    function library:notification(properties)
        local cfg = {
            time = properties.time or 5,
            text = properties.text or properties.name or "Notification",
            flashing = false, 
        }
    
        
            local watermark_outline = library:create("Frame", {
                Parent = notif_holder,
                Name = "",
                Size = UDim2.new(0, 0, 0, 24),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Position = UDim2.new(0, 20, 0, 72 + (#library.notifications * 28)),
                AutomaticSize = Enum.AutomaticSize.X,
                BackgroundColor3 = themes.preset.outline,
                AnchorPoint = Vector2.new(1, 0)
            })
        
            local watermark_inline = library:create("Frame", {
                Parent = watermark_outline,
                Name = "",
                Position = UDim2.new(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = UDim2.new(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })

            local watermark_background = library:create("Frame", {
                Parent = watermark_inline,
                Name = "",
                Position = UDim2.new(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = UDim2.new(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
    
            local UIGradient = library:create("UIGradient", {
                Parent = watermark_background,
                Name = "",
                Color = ColorSequence.new{
                    rgbkey(0, themes.preset.high_contrast),
                    rgbkey(1, themes.preset.low_contrast)
                }
            })
    
            local text = library:create("TextLabel", {
                Parent = watermark_background,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "  " .. cfg.text .. "  ",
                Size = UDim2.new(0, 0, 1, 0),
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 0, 0, -1),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
    
            local accent = library:create("Frame", {
                Parent = watermark_outline,
                Name = "",
                Position = UDim2.new(0, 2, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = UDim2.new(0, 1, 1, -4),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            })

            library:apply_theme(accent, "accent", "BackgroundColor3")
    
            local UIGradient = library:create("UIGradient", {
                Parent = accent,
                Name = "",
                Rotation = 90,
                Color = ColorSequence.new{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })
            
            local accent_bottom = library:create("Frame", {
                Parent = watermark_outline,
                Name = "",
                Position = UDim2.new(0, 2, 1, -3),
                BorderColor3 = rgb(0, 0, 0),
                Size = UDim2.new(0, -4, 0, 1),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = accent,
                Name = "",
                Rotation = 90,
                Color = ColorSequence.new{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })

            local index = #library.notifications + 1
            library.notifications[index] =watermark_outline

            library:refresh_notifications()

            tween_service:Create(watermark_outline, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {AnchorPoint = Vector2.new(0, 0)}):Play()
            
            tween_service:Create(accent_bottom, TweenInfo.new(cfg.time, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Size = UDim2.new(1, -4, 0, 1)}):Play()
        
        
        task.spawn(function()
            task.wait(cfg.time)

            library.notifications[index] = nil

            tween_service:Create(watermark_outline, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {AnchorPoint = Vector2.new(1, 0), BackgroundTransparency = 1}):Play()
            
            for _, v in next, watermark_outline:GetDescendants() do 
                if v:IsA("TextLabel") then 
                    tween_service:Create(v, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {TextTransparency = 1}):Play()
                elseif v:IsA("Frame") then 
                    tween_service:Create(v, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {BackgroundTransparency = 1}):Play()
                elseif v:IsA("ImageLabel") then
                    tween_service:Create(v, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {ImageTransparency = 1}):Play()
                elseif v:IsA("UIStroke") then 
                    tween_service:Create(v, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Transparency = 1}):Play()
                end 
            end 

            task.wait(1)

            watermark_outline:Destroy()
        end)    
    end 

    function library:tab(options)	
        local cfg = {
            name = options.name or "tab", 
            enabled = false, 
        }
        
        
            local tab_holder = library:create("TextButton", {
                Parent = self.tab_holder,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(0, 0, 1, -2),
                ZIndex = 5,
                TextSize = 12,
                BackgroundColor3 = themes.preset.outline,
                AutoButtonColor = false
            }) library:apply_theme(tab_holder, "outline", "BackgroundColor3") 

            local inline = library:create("Frame", {
                Parent = tab_holder,
                Size = dim2(1, -2, 1, 0),
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 5,
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 

            local background = library:create("Frame", {
                Parent = inline,
                Size = dim2(1, -2, 1, -1),
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 5,
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Color = rgbseq{rgbkey(0, rgb(41, 41, 55)), rgbkey(1, rgb(35, 35, 47))}
            }) library:apply_theme(UIGradient, "contrast", "Color") 

            local text = library:create("TextLabel", {
                Parent = background,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = cfg.name,
                Name = "\0",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                TextSize = 12,
                ZIndex = 5,
                BackgroundColor3 = rgb(255, 255, 255)
            }, "text")
            library:apply_theme(text, "accent", "TextColor3")
        

        
            local section_holder = library:create("Frame", {
                Parent = library.section_holder,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                Visible = false,
                BackgroundColor3 = rgb(255, 255, 255)
            })
        
            cfg["holder"] = section_holder

            library:create("UIListLayout", {
                Parent = section_holder,
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        

        function cfg.open_tab()
            if library.current_tab and library.current_tab[1] ~= background then 
                local button = library.current_tab[1]
                button.Size = dim2(1, -2, 1, -1)
                button:FindFirstChildOfClass("UIGradient").Rotation = 90
                button:FindFirstChildOfClass("TextLabel").TextColor3 = themes.preset.text
                    
                library.current_tab[2].Visible = false
                
                library.current_tab = nil
            end
            
            library.current_tab = {
                background, section_holder
            }
            
            local button = library.current_tab[1] 
            button.Size = dim2(1, -2, 1, 0) 
            button:FindFirstChildOfClass("UIGradient").Rotation = -90
            button:FindFirstChildOfClass("TextLabel").TextColor3 = themes.preset.accent 

            library.current_tab[2].Visible = true 

            if library.current_element_open and library.current_element_open ~= cfg then 
                library.current_element_open.set_visible(false)
                library.current_element_open.open = false 
                library.current_element_open = nil 
            end
        end
        
        tab_holder.MouseButton1Click:Connect(cfg.open_tab)
        
        return setmetatable(cfg, library) 
    end

    function library:column(path) 
        local cfg = {}
        
        local holder = path or self.holder
        
        local column = library:create("Frame", {
            Parent = holder,
            BackgroundTransparency = 1,
            Name = "\0",
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        }) library:apply_theme(column, "inline", "BackgroundColor3") 
        
        library:create("UIListLayout", {
            Parent = column,
            Padding = dim(0, 4),
            SortOrder = Enum.SortOrder.LayoutOrder,
            VerticalFlex = Enum.UIFlexAlignment.Fill
        })
        
        cfg["holder"] = column

        return setmetatable(cfg, library) 
    end

    function library:multi_section(options)
        local cfg = {
            names = options.names or {"First", "Second", "Third"}, 
            sections = {},
        }

        local section = library:create("Frame", {
            Parent = self.holder,
            Name = "",
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 260),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        }) library:apply_theme(section, "inline", "BackgroundColor3")
        
        local inline = library:create("Frame", {
            Parent = section,
            Name = "",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.outline
        }) library:apply_theme(inline, "outline", "BackgroundColor3") 
        
        local __background = library:create("Frame", {
            Parent = inline,
            Name = "",
            ClipsDescendants = true,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            ZIndex = 1,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local accent = library:create("Frame", {
            Parent = __background,
            Name = "",
            Size = dim2(1, 0, 0, 2),
            BorderColor3 = rgb(0, 0, 0),
            ZIndex = 3,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        }) library:apply_theme(accent, "accent", "BackgroundColor3")
        
        local UIGradient = library:create("UIGradient", {
            Parent = accent,
            Name = "",
            Rotation = 90,
            Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(167, 167, 167))}
        }) 
        
        local UIGradient = library:create("UIGradient", {
            Parent = __background,
            Name = "",
            Rotation = 90,
            Color = rgbseq{rgbkey(0, rgb(41, 41, 55)), rgbkey(1, rgb(35, 35, 47))}
        }) library:apply_theme(UIGradient, "contrast", "Color") 
        
        local tab_holder = library:create("Frame", {
            Parent = __background,
            Name = "",
            ClipsDescendants = true,
            BackgroundTransparency = 1,
            Position = dim2(0, -1, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 2, 0, 21),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        }) 
        
        library:create("UIListLayout", {
            Parent = tab_holder,
            Name = "",
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            Padding = dim(0, -3),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        for _, tab in next, cfg.names do 
            local multi = {
                open = false, 
            } 

            
                local tabb = library:create("TextButton", {
                    Parent = tab_holder,
                    Name = "",
                    AutoButtonColor = false,
                    FontFace = library.font,
                    TextColor3 = themes.preset.text,
                    BorderColor3 = rgb(0, 0, 0),
                    Text = "",
                    BorderSizePixel = 0,
                    Size = dim2(0, 0, 1, 0),
                    ZIndex = 1,
                    TextSize = 12,
                    BackgroundColor3 = themes.preset.outline
                }) library:apply_theme(tabb, "outline", "BackgroundColor3") 
                
                local background = library:create("Frame", {
                    Parent = tabb,
                    Name = "",
                    Size = dim2(1, 0, 1, -2),
                    Position = dim2(0, 1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    ZIndex = 1,
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                local UIGradient = library:create("UIGradient", {
                    Parent = background,
                    Name = "",
                    Rotation = 90,
                    Color = rgbseq{rgbkey(0, rgb(41, 41, 55)), rgbkey(1, rgb(35, 35, 47))}
                }) library:apply_theme(UIGradient, "contrast", "Color")
                
                local text = library:create("TextLabel", {
                    Parent = background,
                    Name = "",
                    FontFace = library.font,
                    TextColor3 = themes.preset.text,
                    BorderColor3 = rgb(0, 0, 0),
                    Text = tab,
                    BackgroundTransparency = 1,
                    Size = dim2(1, 0, 1, 0),
                    BorderSizePixel = 0,
                    AutomaticSize = Enum.AutomaticSize.X,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) library:apply_theme(text, "accent", "TextColor3")
                
                local UIStroke = library:create("UIStroke", {
                    Parent = text,
                    Name = "",
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
            

            
                local ScrollingFrame = library:create("ScrollingFrame", {
                    Parent = __background,
                    Name = "",
                    ScrollBarImageColor3 = themes.preset.accent,
                    Active = true,
                    MidImage = "rbxassetid://103468666327206",
                    TopImage = "rbxassetid://103468666327206",
                    BottomImage = "rbxassetid://103468666327206",
                    AutomaticCanvasSize = Enum.AutomaticSize.Y,
                    ScrollBarThickness = 2,
                    Size = dim2(1, 0, 1, -20),
                    Visible = false, 
                    BackgroundTransparency = 1,
                    Position = dim2(0, 0, 0, 24),
                    BackgroundColor3 = rgb(255, 255, 255),
                    BorderColor3 = rgb(0, 0, 0),
                    BorderSizePixel = 0,
                    ScrollBarThickness = 2,
                    CanvasSize = dim2(0, 0, 0, 0)
                }) library:apply_theme(ScrollingFrame, "accent", "ScrollBarImageColor3") 
                
                local elements = library:create("Frame", {
                    Parent = ScrollingFrame,
                    Name = "",
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, 0, 0, 0),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) multi.holder = elements
                
                local UIListLayout = library:create("UIListLayout", {
                    Parent = elements,
                    Name = "",
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    HorizontalAlignment = Enum.HorizontalAlignment.Center,
                    Padding = dim(0, 4)
                })
                
                local UIPadding = library:create("UIPadding", {
                    Parent = ScrollingFrame,
                    Name = "",
                    PaddingBottom = dim(0, 60)
                })
            
            
            function multi:open_tab(bool) 
                ScrollingFrame.Visible = bool 
                UIGradient.Rotation = bool and -90 or 90
                tabb.Size = dim2(0, 0, 1, bool and 1 or 0)
                text.TextColor3 = bool and themes.preset.accent or themes.preset.text
            end

            library:connection(tabb.MouseButton1Click, function()
                for _, multi_s in next, cfg.sections do 
                    multi_s:open_tab(false)
                end

                if library.current_element_open then 
                    library.current_element_open.set_visible(false)
                    library.current_element_open.open = false 
                    library.current_element_open = nil 
                end

                multi:open_tab(true) 
            end)

            cfg.sections[#cfg.sections + 1] = setmetatable(multi, library)
        end 

        cfg.sections[1]:open_tab(true)

        return unpack(cfg.sections)
    end 

    function library:section(options)
        local cfg = {
            name = options.name or "Section", 
        }
        
        local section = library:create("Frame", {
            Parent = self.holder,
            Name = "\0",
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 260),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        }) library:apply_theme(section, "inline", "BackgroundColor3") 

        local inline = library:create("Frame", {
            Parent = section,
            Name = "\0",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.outline
        }) library:apply_theme(inline, "outline", "BackgroundColor3") 

        local background = library:create("Frame", {
            Parent = inline,
            Name = "\0",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local text = library:create("TextLabel", {
            Parent = background,
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Name = "\0",
            BackgroundTransparency = 1,
            Position = dim2(0, 6, 0, 4),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        library:create("UIStroke", {
            Parent = text,
            LineJoinMode = Enum.LineJoinMode.Miter
        })

        local accent = library:create("Frame", {
            Parent = background,
            Name = "\0",
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        }) library:apply_theme(accent, "accent", "BackgroundColor3") 

        local UIGradient = library:create("UIGradient", {
            Parent = accent,
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(255, 255, 255)),
                rgbkey(1, rgb(167, 167, 167))
            }
        })

        local UIGradient = library:create("UIGradient", {
            Parent = background,
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
        }) library:apply_theme(UIGradient, "contrast", "Color") 

        local ScrollingFrame = library:create("ScrollingFrame", {
            Parent = background,
            ScrollBarImageColor3 = themes.preset.accent,
            Active = true,
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            ScrollBarThickness = 2,
            MidImage = "rbxassetid://103468666327206",
            TopImage = "rbxassetid://103468666327206",
            BottomImage = "rbxassetid://103468666327206",
            Size = dim2(1, 0, 1, -20),
            BackgroundTransparency = 1,
            Position = dim2(0, 0, 0, 20),
            BackgroundColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            CanvasSize = dim2(0, 0, 0, 0)
        }) library:apply_theme(ScrollingFrame, "accent", "ScrollBarImageColor3") 

        ScrollingFrame:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
            if library.current_element_open then 
                library.current_element_open.set_visible(false)
                library.current_element_open.open = false 
                library.current_element_open = nil
            end
        end) 

        local elements = library:create("Frame", {
            Parent = ScrollingFrame,
            Name = "\0",
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.holder = elements 

        library:create("UIListLayout", {
            Parent = elements,
            Padding = dim(0, 4),
            HorizontalAlignment = Enum.HorizontalAlignment.Center,
            SortOrder = Enum.SortOrder.LayoutOrder
        })

        library:create("UIPadding", {
            Parent = ScrollingFrame,
            PaddingBottom = dim(0, 10)
        })

        return setmetatable(cfg, library)
    end

    function library:slider(options)
        local cfg = {
            name = options.name or nil,
            suffix = options.suffix or "",
            flag = options.flag or tostring(2^789),
            callback = options.callback or function() end, 
            visible = options.visible or true, 
            input_disabled = options.input or false,
            custom_color = options.custom or nil; 

            min = options.min or options.minimum or 0,
            max = options.max or options.maximum or 100,
            intervals = options.interval or options.decimal or 1,
            default = options.default or 10,

            dragging = false,
            value = options.default or 10, 
        } 

        
            local slider_REAL = library:create("TextLabel", {
                Parent = self.holder, 
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                Name = "slider",
                ZIndex = 1,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local TEXT_LABEL; 
            if cfg.name then 
                local left_components = library:create("Frame", {
                    Parent = slider_REAL,
                    Name = "left_components",
                    BackgroundTransparency = 1,
                    Position = dim2(0, 2, 0, -1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(0, 0, 0, 14),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                TEXT_LABEL = library:create("TextLabel", {
                    Parent = left_components,
                    FontFace = library.font,
                    TextColor3 = themes.preset.text,
                    BorderColor3 = rgb(0, 0, 0),
                    Text = cfg.name,
                    Name = "text",
                    BackgroundTransparency = 1,
                    Size = dim2(0, 0, 1, -1),
                    BorderSizePixel = 0,
                    AutomaticSize = Enum.AutomaticSize.X,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                }, "text")

                library:create("UIListLayout", {
                    Parent = left_components,
                    Padding = dim(0, 5),
                    Name = "_",
                    FillDirection = Enum.FillDirection.Horizontal
                })
            end 
            
            local bottom_components = library:create("Frame", {
                Parent = slider_REAL,
                Name = "bottom_components",
                Position = dim2(0, 0, 0, cfg.name and 15 or 0),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local slider = library:create("TextButton", {
                Parent = bottom_components,
                Name = "slider",
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -1, 1, 12),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline,
                Text = "",
                AutoButtonColor = false,
            }) library:apply_theme(slider, "outline", "BackgroundColor3") 

            if not cfg.input_disabled then 
                library:hoverify(slider_REAL, slider)
            end

            local inline = library:create("Frame", {
                Parent = slider,
                Name = "inline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                ZIndex = 1;
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 

            local background = library:create("Frame", {
                Parent = inline,
                Name = "background",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
            }) 
            
            local contrast = library:create("Frame", {
                Parent = background,
                Name = "contrast",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local slidertext = library:create("TextLabel", {
                Parent = contrast,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "12.50/100.00",
                Name = "text",
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, -1),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                TextSize = 12,
                ZIndex = 2,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local fill = library:create("Frame", {
                Parent = contrast,
                Name = "fill",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = cfg.custom_color or themes.preset.accent
            }) if not cfg.custom_color then library:apply_theme(fill, "accent", "BackgroundColor3") end; 
            cfg.fill = fill 
            
            local UIGradient = library:create("UIGradient", {
                Parent = fill,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = contrast,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }); library:apply_theme(UIGradient, "contrast", "Color")
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })
            
            library:create("UIListLayout", {
                Parent = bottom_components,
                Padding = dim(0, 10),
                Name = "_",
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        

        function cfg.set(value)
            if type(value) == "userdata" then 
                return 
            end

            cfg.value = math.clamp(library:round(value, cfg.intervals), cfg.min, cfg.max)

            fill.Size = dim2((cfg.value - cfg.min) / (cfg.max - cfg.min), 0, 1, 0)
            slidertext.Text = tostring(cfg.value) .. cfg.suffix .. "/" .. tostring(cfg.max) .. cfg.suffix
            flags[cfg.flag] = cfg.value

            cfg.callback(flags[cfg.flag])
        end

        function cfg.set_element_visible(bool)
            slider_REAL.Visible = bool 

            if TEXT_LABEL then 
                TEXT_LABEL.Visible = bool 
            end 
        end

        if not cfg.input_disabled then 
            library:connection(uis.InputChanged, function(input)
                if cfg.dragging and input.UserInputType == Enum.UserInputType.MouseMovement then 
                    local size_x = (input.Position.X - slider.AbsolutePosition.X) / slider.AbsoluteSize.X
                    local value = ((cfg.max - cfg.min) * size_x) + cfg.min
                    cfg.set(value)
                end
            end)

            library:connection(uis.InputEnded, function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    cfg.dragging = false 
                end 
            end)

            slider.MouseButton1Down:Connect(function()
                cfg.dragging = true
            end)
        end

        if cfg.tooltip then 
            library:tool_tip({name = cfg.tooltip, path = slider_REAL})
        end

        cfg.set(cfg.default)
        cfg.set_element_visible(cfg.visible)
                
        config_flags[cfg.flag] = cfg.set

        library.config_flags[cfg.flag] = cfg.set
        library.visible_flags[cfg.flag] = cfg.set_element_visible

        return setmetatable(cfg, library) 
    end 

    function library:toggle(options)
        local cfg = {
            enabled = options.enabled or nil,
            name = options.name or "Toggle",
            flag = options.flag or tostring(random(1,9999999)),
            callback = options.callback or function() end,
            default = options.default or false,
            colorpicker = options.color or nil,
            visible = (options.visible == nil) and true or options.visible,
            tooltip = options.tooltip or nil,
        }

        
            local toggle_holder = library:create("TextButton", {
                Parent = self.holder,
                FontFace = library.font,
                TextColor3 = rgb(151, 151, 151),
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                Name = "toggle",
                ZIndex = 1,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local right_components = library:create("Frame", {
                Parent = toggle_holder,
                Name = "right_components",
                Position = dim2(1, -1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 0, 0, 12),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            cfg["right_holder"] = right_components
        
            local list = library:create("UIListLayout", {
                Parent = right_components,
                VerticalAlignment = Enum.VerticalAlignment.Center,
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                Padding = dim(0, 4),
                Name = "list",
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        
            library:create("UIPadding", {
                Parent = toggle_holder
            })
        
            local left_components = library:create("Frame", {
                Parent = toggle_holder,
                Name = "left_components",
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, 0),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 0, 0, 14),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local text = library:create("TextLabel", {
                Parent = left_components,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = cfg.name,
                Name = "text",
                BackgroundTransparency = 1,
                Size = dim2(0, 0, 1, -1),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            cfg["text_label"] = text
        
            library:create("UIStroke", {
                Parent = text,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
        
            library:create("UIListLayout", {
                Parent = left_components,
                Padding = dim(0, 5),
                Name = "_",
                FillDirection = Enum.FillDirection.Horizontal
            })
        
            local toggle = library:create("TextButton", {
                Parent = left_components,
                Name = "!toggle",
                Text = "",
                AutoButtonColor = false,
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 14, 0, 14),
                BorderSizePixel = 0,
                ZIndex = 1, 
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(toggle, "outline", "BackgroundColor3") 
            library:apply_theme(toggle, "accent", "BackgroundColor3") 

            local inline = library:create("Frame", {
                Parent = toggle,
                Name = "inline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                ZIndex = 2;
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
        
            local accent = library:create("Frame", {
                Parent = inline,
                BackgroundTransparency = 1;
                ZIndex = 3;
                Name = "background",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            })
            library:apply_theme(accent, "accent", "BackgroundColor3") 

            local UIGradient = library:create("UIGradient", {
                Parent = accent,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })

            local background = library:create("Frame", {
                Parent = inline,
                ZIndex = 2;
                Name = "background",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            library:apply_theme(background, "accent", "BackgroundColor3") 

            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Name = "_",
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
        

        library:hoverify(toggle_holder, toggle)

        function cfg.set(bool)
            library:tween(accent, {BackgroundTransparency = bool and 0 or 1})
            flags[cfg.flag] = bool
            
            cfg.callback(bool)
        end

        function cfg.set_element_visible(bool)
            toggle_holder.Visible = bool 
        end 
    
        library:connection(toggle_holder.MouseButton1Click, function()
            cfg.enabled = not cfg.enabled
    
            cfg.set(cfg.enabled)
        end)

        library:connection(toggle.MouseButton1Click, function()
            cfg.enabled = not cfg.enabled
    
            cfg.set(cfg.enabled)
        end)

        if cfg.tooltip then 
            library:tool_tip({name = cfg.tooltip, path = toggle_holder})
        end

        cfg.set(cfg.default)
        
        cfg.set_element_visible(cfg.visible)
        
        library.config_flags[cfg.flag] = cfg.set
        library.visible_flags[cfg.flag] = cfg.set_element_visible

        return setmetatable(cfg, library)
    end
    
    function library:colorpicker(options)
        local parent = self.right_holder
        
        local cfg = {
            name = options.name or "Color", 
            flag = options.flag or tostring(2^789),
            color = options.color or color(1, 1, 1), 
            alpha = options.alpha or 1,
            callback = options.callback or function() end,
            right_holder = self.right_holder,
        }

        local dragging_sat = false 
        local dragging_hue = false 
        local dragging_alpha = false 

        local h, s, v = cfg.color:ToHSV() 
        local a = cfg.alpha 
        
        
            local colorpicker_button = library:create("TextButton", {
                Parent = parent,
                Name = "outline",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 24, 0, 14),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline,
                Text = "",
                AutoButtonColor = false,
            }) library:apply_theme(colorpicker_button, "outline", "BackgroundColor3") 
        
            local inline = library:create("Frame", {
                Parent = colorpicker_button,
                Name = "inline",
                ZIndex = 2;
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
        
            local handler = library:create("Frame", {
                Parent = inline,
                Name = "handler",
                ZIndex = 2;
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(250, 165, 27)
            })

            library:hoverify(colorpicker_button, colorpicker_button)
        
            local UIGradient = library:create("UIGradient", {
                Parent = handler,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            })
        

        
            local colorpicker_holder = library:create("Frame", {
                Parent = sgui,
                Name = "colorpicker",
                Position = dim2(0, colorpicker_button.AbsolutePosition.X + 1, 0, colorpicker_button.AbsolutePosition.Y + 17),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 190, 0, 210),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline,
                Visible = false,
                ZIndex = 1
            }) library:apply_theme(colorpicker_holder, "outline", "BackgroundColor3") 

            library:make_resizable(colorpicker_holder)
            
            local window_inline = library:create("Frame", {
                Parent = colorpicker_holder,
                Name = "window_inline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            }) library:apply_theme(window_inline, "accent", "BackgroundColor3") 
            
            local window_holder = library:create("Frame", {
                Parent = window_inline,
                Name = "window_holder",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = themes.preset.outline,
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local UIGradient = library:create("UIGradient", {
                Parent = window_holder,
                Rotation = 90,
                Name = "_",
                Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local text = library:create("TextLabel", {
                Parent = window_holder,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = cfg.name,
                Name = "text",
                BackgroundTransparency = 1,
                Position = dim2(0, 2, 0, 4),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = text,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            library:create("UIPadding", {
                Parent = window_holder,
                Name = "_",
                PaddingBottom = dim(0, 4),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })
            
            local main_holder = library:create("Frame", {
                Parent = window_holder,
                Name = "main_holder",
                Position = dim2(0, 0, 0, 20),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, -40),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(main_holder, "inline", "BackgroundColor3") 
            
            cfg.holder = library:create( "Frame" , {
                Parent = colorpicker_holder;
                Name = "\0";
                Position = dim2(0, 6, 1, -21);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(1, -120, 0, 0);
                BorderSizePixel = 0;
            });
            
            local RainbowToggle = setmetatable(cfg, library):toggle({name = "Rainbow", flag = cfg.flag .. "_RAINBOW_FLAG"})

            cfg.holder = library:create( "Frame" , {
                Parent = colorpicker_holder;
                Name = "\0";
                Position = dim2(1, 2, 1, -23);
                BorderColor3 = rgb(0, 0, 0);
                AnchorPoint = vec2(1, 0);
                Size = dim2(1, -80, 0, 0);
                BorderSizePixel = 0;
            });
            
            local section = setmetatable(cfg, library)
            section:button_holder({})
            section:button({name = "Copy", callback = function()
                library.copied_flag = flags[cfg.flag]
                library.is_rainbow = cfg.flag .. "_RAINBOW_FLAG"
            end})
            section:button({name = "Paste", callback = function()
                RainbowToggle.set(library.is_rainbow)
                cfg.set(library.copied_flag.Color, library.copied_flag.Transparency)
            end})

            local main_holder_inline = library:create("Frame", {
                Parent = main_holder,
                Name = "main_holder_inline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(main_holder_inline, "outline", "BackgroundColor3") 
            
            local main_holder_background = library:create("Frame", {
                Parent = main_holder_inline,
                Name = "main_holder_background",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = main_holder_background,
                Rotation = 90,
                Name = "_",
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            library:create("UIPadding", {
                Parent = main_holder_background,
                PaddingTop = dim(0, 4),
                Name = "_",
                PaddingBottom = dim(0, 4),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })
            
            local alpha = library:create("TextButton", {
                Parent = main_holder_background,
                AnchorPoint = vec2(0, 0.5),
                Name = "alpha",
                Position = dim2(0, 0, 1, -8),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -20, 0, 14),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline,
                Text = "",
                AutoButtonColor = false,
            }) library:apply_theme(alpha, "inline", "BackgroundColor3") 
            
            local outline = library:create("Frame", {
                Parent = alpha,
                Name = "outline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(outline, "outline", "BackgroundColor3") 
            
            local alpha_drag = library:create("Frame", {
                Parent = outline,
                Name = "alpha_drag",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(0, 221, 255)
            })
            
            local alphaind = library:create("ImageLabel", {
                Parent = alpha_drag,
                ScaleType = Enum.ScaleType.Tile,
                BorderColor3 = rgb(0, 0, 0),
                Image = "rbxassetid://18274452449",
                BackgroundTransparency = 1,
                Name = "alphaind",
                Size = dim2(1, 0, 1, 0),
                TileSize = dim2(0, 6, 0, 6),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = alphaind,
                Transparency = numseq{
                    numkey(0, 0),
                    numkey(1, 1)
                }
            })
            
            local alpha_picker = library:create("Frame", {
                Parent = alpha_drag,
                Name = "alpha_picker",
                BorderMode = Enum.BorderMode.Inset,
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 4, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local hue = library:create("TextButton", {
                Parent = main_holder_background,
                AnchorPoint = vec2(1, 0),
                Name = "hue",
                Position = dim2(1, -1, 0, 0),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 14, 1, -20),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline,
                Text = "",
                AutoButtonColor = false
            })
            
            local outline = library:create("Frame", {
                Parent = hue,
                Name = "outline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            
            local Frame = library:create("Frame", {
                Parent = outline,
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = Frame,
                Rotation = 270,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 0, 0)),
                    rgbkey(0.17000000178813934, rgb(255, 255, 0)),
                    rgbkey(0.33000001311302185, rgb(0, 255, 0)),
                    rgbkey(0.5, rgb(0, 255, 255)),
                    rgbkey(0.6700000166893005, rgb(0, 0, 255)),
                    rgbkey(0.8299999833106995, rgb(255, 0, 255)),
                    rgbkey(1, rgb(255, 0, 0))
                }
            }) 
            
            local hue_picker = library:create("Frame", {
                Parent = Frame,
                Name = "hue_picker",
                BorderMode = Enum.BorderMode.Inset,
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 0, 4),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local visualize = library:create("Frame", {
                Parent = main_holder_background,
                AnchorPoint = vec2(1, 1),
                Name = "visualize",
                Position = dim2(1, -1, 1, -1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 14, 0, 14),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(visualize, "inline", "BackgroundColor3") 
            
            local outline = library:create("Frame", {
                Parent = visualize,
                Size = dim2(1, -2, 1, -2),
                Name = "outline",
                Active = true,
                BorderColor3 = rgb(0, 0, 0),
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(outline, "outline", "BackgroundColor3") 
            
            local visualize = library:create("Frame", {
                Parent = outline,
                Size = dim2(1, -2, 1, -2),
                Name = "visualize",
                Active = true,
                BorderColor3 = rgb(0, 0, 0),
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(0, 221, 255)
            })
            
            local satval_picker = library:create("Frame", {
                Parent = main_holder_background,
                Name = "satval_picker",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -20, 1, -20),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(satval_picker, "inline", "BackgroundColor3") 
            
            local outline = library:create("Frame", {
                Parent = satval_picker,
                Name = "outline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(outline, "outline", "BackgroundColor3") 
            
            local colorpicker = library:create("Frame", {
                Parent = outline,
                Name = "colorpicker",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(0, 221, 255)
            })
            
            local sat = library:create("TextButton", {
                Parent = colorpicker,
                Name = "sat",
                Size = dim2(1, 0, 1, 0),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 2,
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255),
                Text = "",
                AutoButtonColor = false,
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = sat,
                Rotation = 270,
                Transparency = numseq{
                    numkey(0, 0),
                    numkey(1, 1)
                },
                Color = rgbseq{
                    rgbkey(0, rgb(0, 0, 0)),
                    rgbkey(1, rgb(0, 0, 0))
                }
            })
            
            local val = library:create("TextButton", {
                Parent = colorpicker,
                Name = "val",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255),
                Text = "",
                AutoButtonColor = false,
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = val,
                Transparency = numseq{
                    numkey(0, 0),
                    numkey(1, 1)
                }
            })
            
            local satval_picker_REAL = library:create("Frame", {
                Parent = colorpicker,
                Name = "satval_picker_REAL",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 2, 0, 2),
                BorderSizePixel = 1,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 3, 
            })
        
            
        function cfg.set_visible(bool)
            colorpicker_holder.Visible = bool

            if bool then 
                if library.current_element_open and library.current_element_open ~= cfg then 
                    library.current_element_open.set_visible(false)
                    library.current_element_open.open = false 
                end

                library.current_element_open = cfg
                colorpicker_holder.Position = dim2(0, colorpicker_button.AbsolutePosition.X + 1, 0, colorpicker_button.AbsolutePosition.Y + 17)
            end
        end 

        colorpicker_button.MouseButton1Click:Connect(function()		
            cfg.open = not cfg.open

            cfg.set_visible(cfg.open) 
        end)

        function cfg.set(color, alpha)
            if color then 
                h, s, v = color:ToHSV()
            end 
        
            if alpha then 
                a = alpha
            end 
        
            local hsv_position = Color3.fromHSV(h, s, v)
            local Color = Color3.fromHSV(h, s, v)
            
            local value = 1 - h
            local offset = (value < 1) and 0 or -4
            hue_picker.Position = dim2(0, 0, value, offset)

            local offset = (a < 1) and 0 or -4
            alpha_picker.Position = dim2(a, offset, 0, 0)

            alpha_drag.BackgroundColor3 = Color3.fromHSV(h, s, v)
            
            visualize.BackgroundColor3 = Color
            handler.BackgroundColor3 = Color 

            colorpicker.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
            
            cfg.color = Color
            cfg.alpha = a
            
            local s_offset = (s < 1) and 0 or -3
            local v_offset = (1 - v < 1) and 0 or -3
            satval_picker_REAL.Position = dim2(s, s_offset, 1 - v, v_offset)

            flags[cfg.flag] = {} 
            flags[cfg.flag]["Color"] = Color
            flags[cfg.flag]["Transparency"] = a
        
            cfg.callback(Color, a)
        end

        function cfg.update_color() 
            local mouse = uis:GetMouseLocation() 

            if dragging_sat then	
                s = math.clamp((vec2(mouse.X, mouse.Y - gui_offset) - val.AbsolutePosition).X / val.AbsoluteSize.X, 0, 1)
                v = 1 - math.clamp((vec2(mouse.X, mouse.Y - gui_offset) - sat.AbsolutePosition).Y / sat.AbsoluteSize.Y, 0, 1)
            elseif dragging_hue then 
                h = math.clamp(1 - (vec2(mouse.X, mouse.Y - gui_offset) - hue.AbsolutePosition).Y / hue.AbsoluteSize.Y, 0, 1)
            elseif dragging_alpha then 
                a = math.clamp((vec2(mouse.X, mouse.Y - gui_offset) - alpha.AbsolutePosition).X / alpha.AbsoluteSize.X, 0, 1)
            end

            cfg.set(nil, nil)
        end
        
        alpha.MouseButton1Down:Connect(function()
            dragging_alpha = true 
        end)

        hue.MouseButton1Down:Connect(function()
            dragging_hue = true 
        end)

        sat.MouseButton1Down:Connect(function()
            dragging_sat = true  
        end)

        uis.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging_sat = false
                dragging_hue = false
                dragging_alpha = false 
            end
        end)

        uis.InputChanged:Connect(function(input)
            if (dragging_sat or dragging_hue or dragging_alpha) and input.UserInputType == Enum.UserInputType.MouseMovement then
                cfg.update_color() 
            end
        end)	

        task.spawn(function()
            while true do 
                task.wait()
                if flags[cfg.flag .. "_RAINBOW_FLAG"] then 
                    cfg.set(
                        hsv(math.abs(math.sin(tick())), 
                        s, 
                        v
                    ), a) 
                end     
            end     
        end)

        cfg.set(cfg.color, cfg.alpha)

        library.config_flags[cfg.flag] = cfg.set
    
        return setmetatable(cfg, library) 
    end

    function library:keybind(options)
        local parent = self.right_holder

        local cfg = {
            flag = options.flag or "SET ME A FLAG NOWWW!!!!",
            callback = options.callback or function() end,
            open = false,
            binding = nil, 
            name = options.name or nil, 
            ignore_key = options.ignore or false, 

            key = options.key or nil, 
            mode = options.mode or "toggle",
            active = options.default or false, 

            hold_instances = {},
        }

        flags[cfg.flag] = {} 
        
        local KEYBIND_ELEMENT;
        if cfg.name then 
            KEYBIND_ELEMENT = library:create("TextLabel", {
                Parent = library.keybind_list,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "[ Hold ]  Fly - X",
                Size = dim2(1, -5, 0, 18),
                Visible = false, 
                Position = dim2(0, 5, 0, -1),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                BackgroundColor3 = themes.preset.text
            }, "text")
        end 

        local element_outline = library:create("TextButton", {
            Parent = parent,
            Name = "",
            BorderColor3 = rgb(0, 0, 0),
            Text = "", 
            Size = dim2(0, 24, 0, 14),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = themes.preset.outline
        }) library:apply_theme(element_outline, "outline", "BackgroundColor3")

        library:create("UIPadding", {
            Parent = element_outline,
            PaddingRight = dim(0, 2),
        })

        local instance = library:hoverify(element_outline, element_outline)
        instance.Size = dim2(1, 2, 1, 0)

        local inline = library:create("Frame", {
            Parent = element_outline,
            Name = "",
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.X,
            Size = dim2(1, -2, 1, -2),
            ZIndex = 2;
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        }) library:apply_theme(inline, "inline", "BackgroundColor3") 

        library:create("UIPadding", {
            Parent = inline,
            PaddingRight = dim(0, 2),
        })
        
        local handler = library:create("Frame", {
            Parent = inline,
            Name = "",
            ZIndex = 2;
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local UIGradient = library:create("UIGradient", {
            Parent = handler,
            Name = "",
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
        }); library:apply_theme(UIGradient, "contrast", "Color") 
        
        local key_text = library:create("TextLabel", {
            Parent = handler,
            Name = "",
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            ZIndex = 2;
            Text = "b",
            Size = dim2(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Position = dim2(0, 0, 0, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        library:create("UIPadding", {
            Parent = key_text,
            PaddingLeft = dim(0, 3),
            PaddingRight = dim(0, 2),
        })
        
        
            local keybind_selector = library:create("Frame", {
                Parent = sgui,
                Name = "",
                Position = dim2(0, element_outline.AbsolutePosition.X + 1, 0, element_outline.AbsolutePosition.Y + 17),
                BorderColor3 = rgb(255, 255, 255),
                BorderSizePixel = 2,
                Visible = false, 
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIListLayout", {
                Parent = keybind_selector,
                Name = "",
                SortOrder = Enum.SortOrder.LayoutOrder,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Padding = dim(0, 2)
            })
            
            local hold_button = library:create("TextButton", {
                Parent = keybind_selector,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "hold",
                BackgroundTransparency = 1,
                AutomaticSize = Enum.AutomaticSize.XY,
                BorderSizePixel = 0,
                ZIndex = 2,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = hold_button,
                Name = "",
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            library:create("UIPadding", {
                Parent = keybind_selector,
                Name = "",
                PaddingTop = dim(0, 3),
                PaddingBottom = dim(0, 5),
                PaddingRight = dim(0, 5),
                PaddingLeft = dim(0, 5)
            })
            
            local toggle_button = library:create("TextButton", {
                Parent = keybind_selector,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "toggle",
                BackgroundTransparency = 1,
                AutomaticSize = Enum.AutomaticSize.XY,
                BorderSizePixel = 0,
                ZIndex = 2,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = toggle_button,
                Name = "",
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            local always_button = library:create("TextButton", {
                Parent = keybind_selector,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "always",
                BackgroundTransparency = 1,
                AutomaticSize = Enum.AutomaticSize.XY,
                BorderSizePixel = 0,
                ZIndex = 2,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = always_button,
                Name = "",
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = keybind_selector,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }); library:apply_theme(UIGradient, "contrast", "Color")
            
            local UIStroke = library:create("UIStroke", {
                Parent = keybind_selector,
                Name = "",
                Color = themes.preset.inline,
                LineJoinMode = Enum.LineJoinMode.Miter,
                ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            })
        

        
            function cfg.set_visible(bool)
                keybind_selector.Visible = bool
                keybind_selector.Position = dim2(0, element_outline.AbsolutePosition.X + 1, 0, element_outline.AbsolutePosition.Y + 17)

                if bool then 
                    if library.current_element_open and library.current_element_open ~= cfg then 
                        library.current_element_open.set_visible(false)
                        library.current_element_open.open = false 
                    end

                    library.current_element_open = cfg 
                end
            end 

            function cfg.set_mode(mode) 
                cfg.mode = mode 

                if mode == "always" then
                    cfg.set(true)
                elseif mode == "hold" then
                    cfg.set(false)
                end

                flags[cfg.flag]["mode"] = mode
            end 

            function cfg.set(input)
                if type(input) == "boolean" then 
                    local __cached = input 

                    if cfg.mode == "always" then 
                        __cached = true 
                    end 

                    cfg.active = __cached 
                    flags[cfg.flag]["active"] = __cached 
                    cfg.callback(__cached)
                elseif tostring(input):find("Enum") then 
                    input = input.Name == "Escape" and "none" or input
                    
                    cfg.key = input or "none"	

                    local _text = keys[cfg.key] or tostring(cfg.key):gsub("Enum.", "")
                    local _text2 = (tostring(_text):gsub("KeyCode.", ""):gsub("UserInputType.", "")) or "none"
                    cfg.key_name = _text2

                    flags[cfg.flag]["mode"] = cfg.mode 
                    flags[cfg.flag]["key"] = cfg.key 

                    key_text.Text = string.lower(_text2)

                    cfg.callback(cfg.active or false)
                elseif find({"toggle", "hold", "always"}, input) then 
                    cfg.set_mode(input)

                    if input == "always" then 
                        cfg.active = true 
                    end 

                    cfg.callback(cfg.active or false)
                elseif type(input) == "table" then 
                    input.key = type(input.key) == "string" and input.key ~= "none" and library:convert_enum(input.key) or input.key

                    input.key = input.key == Enum.KeyCode.Escape and "none" or input.key
                    cfg.key = input.key or "none"
                    
                    cfg.mode = input.mode or "toggle"

                    if input.active then
                        cfg.active = input.active
                    end

                    local text = tostring(cfg.key) ~= "Enums" and (keys[cfg.key] or tostring(cfg.key):gsub("Enum.", "")) or nil
                    local __text = text and (tostring(text):gsub("KeyCode.", ""):gsub("UserInputType.", ""))
                    
                    key_text.Text = string.lower(__text) or "none"
                    cfg.key_name = __text
                end 

                flags[cfg.flag] = {
                    mode = cfg.mode,
                    key = cfg.key, 
                    active = cfg.active
                }
                
                if cfg.name then 
                    KEYBIND_ELEMENT.Visible = cfg.active

                    library:tween(KEYBIND_ELEMENT, {
                        TextTransparency = cfg.active and 0 or 1, 
                    }) 

                    library:tween(KEYBIND_ELEMENT:FindFirstChildOfClass("UIStroke"), {
                        Transparency = cfg.active and 0 or 1, 
                    }) 
                    
                    local text = tostring(cfg.key) ~= "Enums" and (keys[cfg.key] or tostring(cfg.key):gsub("Enum.", "")) or nil
                    local __text = text and (tostring(text):gsub("KeyCode.", ""):gsub("UserInputType.", ""))

                    if cfg.name then 
                        KEYBIND_ELEMENT.Text = "[ " .. string.upper(string.sub(cfg.mode, 1, 1)) .. string.sub(cfg.mode, 2) .. " ] " .. cfg.name .. " - " .. __text
                    end
                end
            end


            
            hold_button.MouseButton1Click:Connect(function()
                cfg.set_mode("hold") 
                cfg.set_visible(false)
                cfg.open = false 
            end) 

            toggle_button.MouseButton1Click:Connect(function()
                cfg.set_mode("toggle") 
                cfg.set_visible(false)
                cfg.open = false 
            end) 

            always_button.MouseButton1Click:Connect(function()
                cfg.set_mode("always") 
                cfg.set_visible(false)
                cfg.open = false 
            end) 
            
            element_outline.MouseButton2Click:Connect(function()
                cfg.open = not cfg.open 

                cfg.set_visible(cfg.open)
            end)

            element_outline.MouseButton1Down:Connect(function()
                task.wait()
                key_text.Text = "none"	

                if cfg.binding then return end 

                cfg.binding = library:connection(uis.InputBegan, function(input, game_event)  
                    local selected_key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType

                    cfg.set(selected_key)

                    cfg.binding:Disconnect() 
                    cfg.binding = nil
                end)
            end)

            library:connection(uis.InputBegan, function(input, game_event) 
                local selected_key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType

                if not game_event then 
                    if selected_key == cfg.key then 
                        if cfg.mode == "toggle" then 
                            cfg.active = not cfg.active
                            cfg.set(cfg.active)
                        elseif cfg.mode == "hold" then 
                            cfg.set(true)
                        end
                    end
                end
            end)

            library:connection(uis.InputEnded, function(input, game_event) 
                if game_event then 
                    return 
                end 

                local selected_key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType
    
                if selected_key == cfg.key then
                    if cfg.mode == "hold" then 
                        cfg.set(false)
                    end
                end
            end)
    
            cfg.set({mode = cfg.mode, active = cfg.active, key = cfg.key})
    
            library.config_flags[cfg.flag] = cfg.set
        
        
        library.config_flags[cfg.flag] = cfg.set

        return setmetatable(cfg, library) 
    end 

    function library:dropdown(options)
        local parent = self.holder 

        local cfg = {
            name = options.name or nil,
            flag = options.flag or tostring(random(1,9999999)),

            items = options.items or {"1", "2", "3"},
            callback = options.callback or function() end,
            multi = options.multi or false, 
            visible = options.visible or true,

            open = false, 
            option_instances = {}, 
            multi_items = {}, 
            scrolling = options.scrolling or false, 
            ignore = options.ignore or nil,
        }

        cfg.default = options.default or (cfg.multi and {cfg.items[1]}) or cfg.items[1] or nil

        
            local dropdown_REAL = library:create("TextLabel", {
                Parent = parent,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                Name = "dropdown",
                ZIndex = 2,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local main_text      
            if cfg.name then 
                local left_components = library:create("Frame", {
                    Parent = dropdown_REAL,
                    Name = "left_components",
                    BackgroundTransparency = 1,
                    Position = dim2(0, 2, 0, -1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(0, 0, 0, 14),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                main_text = library:create("TextLabel", {
                    Parent = left_components,
                    FontFace = library.font,
                    TextColor3 = themes.preset.text,
                    BorderColor3 = rgb(0, 0, 0),
                    Text = cfg.name,
                    Name = "text",
                    BackgroundTransparency = 1,
                    Size = dim2(0, 0, 1, -1),
                    BorderSizePixel = 0,
                    AutomaticSize = Enum.AutomaticSize.X,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                library:create("UIStroke", {
                    Parent = main_text,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
                
                library:create("UIListLayout", {
                    Parent = left_components,
                    Padding = dim(0, 5),
                    Name = "_",
                    FillDirection = Enum.FillDirection.Horizontal
                })

                local right_components = library:create("Frame", {
                    Parent = dropdown_REAL,
                    Name = "right_components",
                    Position = dim2(1, -1, 0, 1),
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(0, 0, 0, 12),
                    BorderSizePixel = 0,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                cfg["right_holder"] = right_components
    
                local list = library:create("UIListLayout", {
                    Parent = right_components,
                    VerticalAlignment = Enum.VerticalAlignment.Center,
                    FillDirection = Enum.FillDirection.Horizontal,
                    HorizontalAlignment = Enum.HorizontalAlignment.Right,
                    Padding = dim(0, 4),
                    Name = "list",
                    SortOrder = Enum.SortOrder.LayoutOrder
                })
            end 

            local bottom_components = library:create("Frame", {
                Parent = dropdown_REAL,
                Name = "bottom_components",
                Position = dim2(0, 0, 0, cfg.name and 15 or 0),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 26, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local dropdown = library:create("TextButton", {
                Parent = bottom_components,
                Name = "dropdown",
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -27, 1, 18),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline,
                Text = "",
                AutoButtonColor = false, 
            }) library:apply_theme(dropdown, "outline", "BackgroundColor3") 
            
            library:hoverify(dropdown_REAL, dropdown)

            local inline = library:create("Frame", {
                Parent = dropdown,
                Name = "inline",
                ZIndex = 2;
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
            
            local background = library:create("Frame", {
                Parent = inline,
                Name = "background",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                ZIndex = 2;
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            }) library:apply_theme(background, "accent", "BackgroundColor3") 
            
            local contrast = library:create("Frame", {
                Parent = background,
                Name = "contrast",
                ZIndex = 2;
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local plus = library:create("TextLabel", {
                Parent = contrast,
                TextWrapped = true,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 2;
                Text = "+",
                Name = "plus",
                Size = dim2(1, -4, 1, 0),
                Position = dim2(0, 0, 0, -1),
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Right,
                FontFace = library.font,
                TextTruncate = Enum.TextTruncate.AtEnd,
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = plus,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            local text = library:create("TextLabel", {
                Parent = contrast,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                ZIndex = 2;
                BorderColor3 = rgb(0, 0, 0),
                Text = "aa",
                Name = "text",
                Size = dim2(1, -4, 1, 0),
                Position = dim2(0, 4, 0, -1),
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                TextTruncate = Enum.TextTruncate.AtEnd,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = text,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = contrast,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            library:create("UIListLayout", {
                Parent = bottom_components,
                Padding = dim(0, 10),
                Name = "_",
                SortOrder = Enum.SortOrder.LayoutOrder
            })     
        

        
            local dropdown_holder = library:create("Frame", {
                Parent = sgui,
                BorderColor3 = rgb(0, 0, 0),
                Name = "dropdown_holder",
                BackgroundTransparency = 1,
                Position = dim2(0, dropdown.AbsolutePosition.X + 1, 0, dropdown.AbsolutePosition.Y + 22),
                Size = dim2(0, dropdown.AbsoluteSize.X, 0, cfg.scrolling and 180 or 0),
                BorderSizePixel = 0,
                AutomaticSize = cfg.scrolling and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline,
                Visible = false
            })
            
            local inline = library:create("Frame", {
                Parent = dropdown_holder,
                Size = dim2(1, -2, 1, 2),
                Name = "inline",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 2,
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
            
            local background; 
            if not cfg.scrolling then 
                background = library:create("Frame", {
                    Parent = inline,
                    BorderColor3 = rgb(0, 0, 0),
                    Name = "background",
                    BackgroundTransparency = 1,
                    Position = dim2(0, 1, 0, 1),
                    Size = dim2(1, -2, 1, 1),
                    ZIndex = 2,
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.accent
                })
                library:apply_theme(background, "accent", "BackgroundColor3") 
            else 
                background = library:create("ScrollingFrame", {
                    Parent = inline,
                    BorderColor3 = rgb(0, 0, 0),
                    Name = "background",
                    BackgroundTransparency = 1,
                    MidImage = "rbxassetid://103468666327206",
                    TopImage = "rbxassetid://103468666327206",
                    BottomImage = "rbxassetid://103468666327206",
                    Position = dim2(0, 1, 0, 1),
                    Size = dim2(1, -2, 1, 1),
                    ZIndex = 2,
                    BorderSizePixel = 0,
                    BackgroundColor3 = themes.preset.accent,
                    CanvasSize = dim2(0, 0, 0, 0),
                    AutomaticCanvasSize = Enum.AutomaticSize.Y,
                    ScrollBarThickness = 2,
                    ScrollBarImageColor3 = themes.preset.accent
                })
                library:apply_theme(background, "accent", "BackgroundColor3") 
                library:apply_theme(background, "accent", "ScrollBarImageColor3") 
            end 
            
            local contrast = library:create("Frame", {
                Parent = background,
                Name = "contrast",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, -3),
                BorderSizePixel = 0,
                ZIndex = 2, 
                BackgroundColor3 = rgb(255, 255, 255),
                AutomaticSize = cfg.scrolling and Enum.AutomaticSize.Y or Enum.AutomaticSize.None,
            }); 

            library:create("UIPadding", {
                Parent = contrast,
                PaddingTop = dim(0, 2),
                PaddingBottom = dim(0, 2),
                PaddingRight = dim(0, 0),
                PaddingLeft = dim(0, 4)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = contrast,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
        
            library:create("UIListLayout", {
                Parent = contrast,
                Padding = dim(0, 5),
                SortOrder = Enum.SortOrder.LayoutOrder
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local stroke = library:create("UIStroke", {
                Parent = inline,
                Color = themes.preset.outline,
                LineJoinMode = Enum.LineJoinMode.Miter
            }) library:apply_theme(stroke, "outline", "Color") 
        
            
        function cfg.set_element_visible(bool)
            dropdown_REAL.Visible = bool 

            if main_text then 
                main_text.Visible = bool
            end 
        end 

        function cfg.set_visible(bool) 
            library.current_element_open = cfg.ignore or cfg

            dropdown_holder.Visible = bool

            plus.Text = bool and "-" or "+"
            plus.TextSize = bool and 12 or 8

            if bool then 
                if library.current_element_open and library.current_element_open ~= cfg and not cfg.ignore then 
                    library.current_element_open.set_visible(false)
                    library.current_element_open.open = false 
                end

                dropdown_holder.Size = dim2(0, dropdown.AbsoluteSize.X, 0, dropdown_holder.Size.Y.Offset)
                dropdown_holder.Position = dim2(0, dropdown.AbsolutePosition.X + 1, 0, dropdown.AbsolutePosition.Y + 22)                    
            end
        end

        function cfg.set(value) 
            local selected = {}

            local is_table = type(value) == "table"

            for _,v in next, cfg.option_instances do 
                if v.Text == value or (is_table and find(value, v.Text)) then 
                    insert(selected, v.Text)
                    cfg.multi_items = selected
                    v.TextColor3 = themes.preset.accent
                else 
                    v.TextColor3 = themes.preset.text
                end
            end

            text.Text = is_table and concat(selected, ", ") or selected[1] or "nun"
            flags[cfg.flag] = is_table and selected or selected[1]
            cfg.callback(flags[cfg.flag]) 
        end
        
        function cfg:refresh_options(refreshed_list) 
            for _, v in next, cfg.option_instances do 
                v:Destroy() 
            end

            cfg.option_instances = {} 

            for i,v in next, refreshed_list do 
                local TextButton = library:create("TextButton", {
                    Parent = contrast,
                    FontFace = library.font,
                    TextColor3 = themes.preset.text,
                    BorderColor3 = rgb(0, 0, 0),
                    Size = dim2(1, 0, 0, 0),
                    BackgroundTransparency = 1,
                    BorderSizePixel = 0,
                    TextWrapped = true,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    ZIndex = 2, 
                    Text = v,
                    BackgroundColor3 = rgb(255, 255, 255)
                }) library:apply_theme(TextButton, "accent", "TextColor3") 
                
                library:create("UIStroke", {
                    Parent = TextButton,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })

                insert(cfg.option_instances, TextButton)

                TextButton.MouseButton1Down:Connect(function()
                    if cfg.multi then 
                        local selected_index = find(cfg.multi_items, TextButton.Text)

                        if selected_index then 
                            remove(cfg.multi_items, selected_index)
                        else
                            insert(cfg.multi_items, TextButton.Text)
                        end

                        cfg.set(cfg.multi_items) 				
                    else 
                        cfg.set_visible(false)
                        cfg.open = false 

                        cfg.set(TextButton.Text)
                    end
                end)
            end
        end

        dropdown.MouseButton1Click:Connect(function()
            cfg.open = not cfg.open 

            cfg.set_visible(cfg.open)
        end)

        cfg:refresh_options(cfg.items) 

        cfg.set(cfg.default)
        
        library.config_flags[cfg.flag] = cfg.set
        library.visible_flags[cfg.flag] = cfg.set_element_visible

        cfg.set_element_visible(cfg.visible)

        return setmetatable(cfg, library)
    end 

    function library:list(options)
        local cfg = {
            callback = options and options.callback or function() end, 

            scale = options.size or 232, 
            items = options.items or {"1", "2", "3"}, 
            
            placeholdertext = options.placeholder or options.placeholdertext or "search here...",
            visible = options.visible or true,

            option_instances = {}, 
            current_instance = nil, 
            flag = options.flag or "SET A FLAG U NIGGER", 

        } 

        
            local list_holder = library:create("TextLabel", {
                Parent = self.holder,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                ZIndex = 2,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIPadding = library:create("UIPadding", {
                Parent = list_holder,
                Name = "",
                PaddingLeft = dim(0, 1)
            })
            
            local UIStroke = library:create("UIStroke", {
                Parent = list_holder,
                Name = ""
            })
            
            local bottom_components = library:create("Frame", {
                Parent = list_holder,
                Name = "",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 26, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIListLayout", {
                Parent = bottom_components,
                Name = "",
                Padding = dim(0, 10),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            local list = library:create("Frame", {
                Parent = bottom_components,
                Name = "",
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -27, 1, cfg.scale),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(main_holder, "outline", "BackgroundColor3") 
            
            local inline = library:create("Frame", {
                Parent = list,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
            
            local background = library:create("Frame", {
                Parent = inline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            }) library:apply_theme(background, "accent", "BackgroundColor3") 
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                rgbkey(0, rgb(255, 255, 255)),
                rgbkey(1, rgb(167, 167, 167))
            }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local contrast = library:create("Frame", {
                Parent = background,
                Name = "",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = contrast,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
            }) library:apply_theme(UIGradient, "contrast", "Color") 
            
            local ScrollingFrame = library:create("ScrollingFrame", {
                Parent = contrast,
                Name = "",
                ScrollBarImageColor3 = themes.preset.accent,
                Active = true,
                MidImage = "rbxassetid://103468666327206",
                TopImage = "rbxassetid://103468666327206",
                BottomImage = "rbxassetid://103468666327206",
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                ScrollBarThickness = 2,
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                CanvasSize = dim2(0, 0, 0, 0)
            }) library:apply_theme(ScrollingFrame, "accent", "ScrollBarImageColor3") 
            
            local UIPadding = library:create("UIPadding", {
                Parent = ScrollingFrame,
                Name = "",
                PaddingBottom = dim(0, 4),
                PaddingTop = dim(0, 4)
            })
            
            local UIListLayout = library:create("UIListLayout", {
                Parent = ScrollingFrame,
                Name = "",
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        

        function cfg.render_option(text) 
            local TextButton = library:create("TextButton", {
                Parent = ScrollingFrame,
                Name = "",
                Text = tostring(text),
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            library:apply_theme(TextButton, "accent", "TextColor3") 

            local UIStroke = library:create("UIStroke", {
                Parent = TextButton,
                Name = ""
            })

            return TextButton 
        end 

        function cfg.set_element_visible(bool)
            list_holder.Visible = bool 
        end

        function cfg.refresh_options(options) 
            if type(options) == "function" then 
                return 
            end 

            for _, v in next, cfg.option_instances do 
                v:Destroy() 
            end 

            for _, option in next, options do 
                local button = cfg.render_option(option) 

                insert(cfg.option_instances, button)

                button.MouseButton1Click:Connect(function()
                    if cfg.current_instance and cfg.current_instance ~= button then 
                        cfg.current_instance.TextColor3 = themes.preset.text 
                    end 

                    cfg.current_instance = button 
                    button.TextColor3 = themes.preset.accent 

                    flags[cfg.flag] = button.text
                    
                    cfg.callback(button.text)
                end)
            end 
        end     

        function cfg.filter_options(text)
            for _, v in next, cfg.option_instances do 
                if string.find(v.Text, text) then 
                    v.Visible = true 
                else 
                    v.Visible = false
                end
            end
        end 

        function cfg.set(value)
            for _, buttons in next, cfg.option_instances do 
                if buttons.Text == value then 
                    buttons.TextColor3 = themes.preset.accent 
                else 
                    buttons.TextColor3 = themes.preset.text 
                end 
            end 

            flags[cfg.flag] = value
            cfg.callback(value)
        end 

        cfg.refresh_options(cfg.items) 
        cfg.set_element_visible(cfg.visible)

        library.visible_flags[cfg.flag] = cfg.set_element_visible
        library.config_flags[cfg.flag] = cfg.set

        return setmetatable(cfg, library)
    end 

    function library:textbox(options)
        local cfg = {
            placeholder = options.placeholder or options.placeholdertext or options.holder or options.holdertext or "type here...",
            default = options.default,
            flag = options.flag or "SET ME NIGGA",
            callback = options.callback or function() end,
            visible = options.visible or true,
        }
        
        
            local textbox_holder = library:create("TextLabel", {
                Parent = self.holder,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                ZIndex = 2,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIPadding", {
                Parent = textbox_holder,
                Name = "",
                PaddingLeft = dim(0, 1)
            })
            
            library:create("UIStroke", {
                Parent = textbox_holder,
                Name = ""
            })
            
            local button = library:create("Frame", {
                Parent = textbox_holder,
                Name = "",
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -27, 0, 18),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            library:hoverify(textbox_holder, button)
            
            library:apply_theme(button, "outline", "BackgroundColor3") 
            
            local inline = library:create("Frame", {
                Parent = button,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                ZIndex = 2;
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            
            library:apply_theme(inline, "inline", "BackgroundColor3") 
            
            local background = library:create("Frame", {
                Parent = inline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                ZIndex = 2;
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            })
            
            library:apply_theme(background, "accent", "BackgroundColor3") 
            
            local TextBox = library:create("TextBox", {
                Parent = background,
                Name = "",
                CursorPosition = -1,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "", 
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                TextWrapped = true,
                BackgroundTransparency = 1,
                TextTruncate = Enum.TextTruncate.SplitWord,
                PlaceholderText = "Type here...",
                ClearTextOnFocus = false,
                ZIndex = 3;
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIStroke", {
                Parent = TextBox,
                Name = ""
            })
            
            local TextButton = library:create("TextButton", {
                Parent = background,
                Name = "",
                FontFace = Font.new("rbxasset://fonts/families/SourceSansPro.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal),
                TextColor3 = rgb(0, 0, 0),
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                AutoButtonColor = false,
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                TextSize = 14,
                ZIndex = 2;
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = TextButton,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(41, 41, 55)),
                    rgbkey(1, rgb(35, 35, 47))
                }
            })
            
            library:apply_theme(UIGradient, "contrast", "Color") 
            
            library:create("UIListLayout", {
                Parent = textbox_holder,
                Name = "",
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
                
            TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                flags[cfg.flag] = TextBox.text
                cfg.callback(TextBox.text)
            end)
        

        function cfg.set_element_visible(bool)
            textbox_holder.Visible = bool 
        end

        function cfg.set(text) 
            flags[cfg.flag] = text
            TextBox.Text = text
            cfg.callback(text)
        end 

        if cfg.default then 
            cfg.set(cfg.default) 
        end 

        cfg.set_element_visible(cfg.visible)

        library.config_flags[cfg.flag] = cfg.set
        library.visible_flags[cfg.flag] = cfg.set_element_visible

        return setmetatable(cfg, library) 
    end 

    function library:button_holder(options) 
        local cfg = {
            flag = options.flag or "hi", 
            visible = options.visible or true,
        }

        local button_holder = library:create("TextLabel", {
            Parent = self.holder,
            Name = "",
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            ZIndex = 2,
            Size = dim2(1, -8, 0, 12),
            BorderSizePixel = 0,
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            AutomaticSize = Enum.AutomaticSize.Y,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255), 
        })

        self.current_holder = button_holder

        
            library:create("UIStroke", {
                Parent = button_holder,
                Name = ""
            })
            
            library:create("UIListLayout", {
                Parent = button_holder,
                Name = "",
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Padding = dim(0, 5),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        
        
        function cfg.set_element_visible(bool)
            button_holder.Visible = bool 
        end

        cfg.set_element_visible(cfg.visible)

        library.visible_flags[cfg.flag] = cfg.set_element_visible

        return setmetatable(cfg, library)
    end 

    function library:button(options)
        local cfg = {
            callback = options.callback or function() end, 
            name = options.text or options.name or "Button",
        }   

        local button = library:create("TextButton", {
            Parent = self.current_holder,
            Name = "",
            Position = dim2(0, 0, 0, 2),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -27, 0, 18),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.outline,
            Text = ""
        })

        library:hoverify(button, button)
        
        library:apply_theme(button, "outline", "BackgroundColor3") 
        
        local inline = library:create("Frame", {
            Parent = button,
            Name = "",
            ZIndex = 2;
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.inline
        })
        
        library:apply_theme(inline, "inline", "BackgroundColor3") 
        
        local background = library:create("Frame", {
            Parent = inline,
            Name = "",
            ZIndex = 2;
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        })
        
        library:apply_theme(background, "accent", "BackgroundColor3") 
        
        local _UIGradient = library:create("UIGradient", {
            Parent = background,
            Name = "",
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(255, 255, 255)),
                rgbkey(1, rgb(167, 167, 167))
            }
        })
        
        library:apply_theme(_UIGradient, "contrast", "Color") 
        
        local contrast = library:create("Frame", {
            Parent = background,
            Name = "",
            ZIndex = 2;
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local UIGradient = library:create("UIGradient", {
            Parent = contrast,
            Name = "",
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
        })
        
        library:apply_theme(UIGradient, "contrast", "Color") 
        
        local text = library:create("TextLabel", {
            Parent = contrast,
            Name = "",
            TextWrapped = true,
            ZIndex = 2;
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Size = dim2(1, -4, 1, 0),
            Position = dim2(0, 4, 0, -1),
            BackgroundTransparency = 1,
            TextTruncate = Enum.TextTruncate.AtEnd,
            BorderSizePixel = 0,
            FontFace = library.font,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local UIStroke = library:create("UIStroke", {
            Parent = text,
            Name = "",
            LineJoinMode = Enum.LineJoinMode.Miter
        })

        button.MouseButton1Click:Connect(function()
            cfg.callback() 
        end)

        return setmetatable(cfg, library)
    end 

    function library:label(options)
        local cfg = {name = options.text or options.name or "Label"}

        local dropdown = library:create("TextLabel", {
            Parent = self.holder,
            Name = "",
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            ZIndex = 2,
            Size = dim2(1, -8, 0, 12),
            BorderSizePixel = 0,
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            AutomaticSize = Enum.AutomaticSize.Y,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local UIStroke = library:create("UIStroke", {
            Parent = dropdown,
            Name = ""
        })
        
        local left_components = library:create("Frame", {
            Parent = dropdown,
            Name = "",
            BackgroundTransparency = 1,
            Position = dim2(0, 2, 0, -1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 0, 0, 14),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local TextLabel = library:create("TextLabel", {
            Parent = left_components,
            Name = "",
            FontFace = library.font,
            TextColor3 = themes.preset.text,
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.Y,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local right_components = library:create("Frame", {
            Parent = dropdown,
            Name = "right_components",
            Position = dim2(1, -1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 0, 0, 12),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        }) cfg.right_holder = right_components

        local list = library:create("UIListLayout", {
            Parent = right_components,
            VerticalAlignment = Enum.VerticalAlignment.Center,
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            Padding = dim(0, 4),
            Name = "list",
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        local UIStroke = library:create("UIStroke", {
            Parent = TextLabel,
            Name = ""
        })

        function cfg.set(text) 
            TextLabel.Text = text 
        end 
        
        cfg.instance = TextLabel
                    
        return setmetatable(cfg, library)   
    end 

    function library:playerlist(options) 
        local cfg = {
            callback = options.callback or function() end, 

            labels = {
                name,
                display, 
                uid, 
            }
        }

        local selected_button; 

        local patterns = {
            ["Priority"] = rgb(255, 255, 0),
            ["Enemy"] = rgb(255, 0, 0),
            ["Neutral"] = themes.preset.text,
            ["Friendly"] = rgb(0, 255, 255)
        }

        
            local playerlist_holder = library:create("TextLabel", {
                Parent = self.holder,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                ZIndex = 2,
                Size = dim2(1, -8, 0, 12),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextYAlignment = Enum.TextYAlignment.Top,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIPadding = library:create("UIPadding", {
                Parent = playerlist_holder,
                Name = "",
                PaddingBottom = dim(0, -2),
                PaddingLeft = dim(0, 1)
            })
            
            local UIStroke = library:create("UIStroke", {
                Parent = playerlist_holder,
                Name = ""
            })
            
            local bottom_components = library:create("Frame", {
                Parent = playerlist_holder,
                Name = "",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 26, 0, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            library:create("UIListLayout", {
                Parent = bottom_components,
                Name = "",
                Padding = dim(0, 10),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            local list = library:create("Frame", {
                Parent = bottom_components,
                Name = "",
                Position = dim2(0, 0, 0, 2),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -27, 1, 232),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(list, "outline", "BackgroundColor3") 
            
            local inline = library:create("Frame", {
                Parent = list,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            }) library:apply_theme(inline, "inline", "BackgroundColor3") 
            
            local background = library:create("Frame", {
                Parent = inline,
                Name = "",
                Position = dim2(0, 1, 0, 1),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.accent
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = background,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 255, 255)),
                    rgbkey(1, rgb(167, 167, 167))
                }
            }); library:apply_theme(UIGradient, "contrast", "Color") 
            
            local contrast = library:create("Frame", {
                Parent = background,
                Name = "",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local UIGradient = library:create("UIGradient", {
                Parent = contrast,
                Name = "",
                Rotation = 90,
                Color = rgbseq{
                rgbkey(0, rgb(41, 41, 55)),
                rgbkey(1, rgb(35, 35, 47))
            }
            }); library:apply_theme(UIGradient, "contrast", "Color") 
            
            local ScrollingFrame = library:create("ScrollingFrame", {
                Parent = contrast,
                Name = "",
                ScrollBarImageColor3 = themes.preset.accent,
                Active = true,
                MidImage = "rbxassetid://103468666327206",
                TopImage = "rbxassetid://103468666327206",
                BottomImage = "rbxassetid://103468666327206",
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                ScrollBarThickness = 2,
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                BorderColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                CanvasSize = dim2(0, 0, 0, 0)
            }) library:apply_theme(ScrollingFrame, "accent", "ScrollBarImageColor3") 
            
            local UIPadding = library:create("UIPadding", {
                Parent = ScrollingFrame,
                Name = "",
                PaddingTop = dim(0, 4),
                PaddingBottom = dim(0, 4),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })
            
            local UIListLayout = library:create("UIListLayout", {
                Parent = ScrollingFrame,
                Name = "",
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        

        function cfg.create_player(player) 
            library.playerlist_data[tostring(player)] = {}
            local path = library.playerlist_data[tostring(player)]
            
            local TextButton = library:create("TextButton", {
                Parent = ScrollingFrame,
                Name = "",
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = "",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local player_name = library:create("TextLabel", {
                Parent = TextButton,
                FontFace = library.font,
                TextColor3 = themes.preset.text,
                BorderColor3 = rgb(0, 0, 0),
                Text = tostring(player),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                LayoutOrder = -100, 
                BackgroundColor3 = rgb(255, 255, 255)
            })
            library:apply_theme(player_name, "text", "TextColor3") 
            library:apply_theme(player_name, "accent", "TextColor3") 
                            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
                            
            
            
            
            
            
            
            
            
            
            
            local priority_text = library:create("TextLabel", {
                Parent = TextButton,
                Name = "",
                FontFace = library.font,
                TextColor3 = tostring(player) ~= lp.Name and themes.preset.text or rgb(0, 0, 255),
                BorderColor3 = rgb(0, 0, 0),
                Text = tostring(player) ~= lp.Name and "Neutral" or "LocalPlayer",
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local Frame = library:create("Frame", {
                Parent = priority_text,
                Name = "",
                Position = dim2(0, -10, 0, 0),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 1, 0, 12),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(main_holder, "outline", "BackgroundColor3") 
            
            local UIListLayout = library:create("UIListLayout", {
                Parent = TextButton,
                Name = "",
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                SortOrder = Enum.SortOrder.LayoutOrder,
                VerticalFlex = Enum.UIFlexAlignment.Fill
            })
            
            local UIPadding = library:create("UIPadding", {
                Parent = TextButton,
                Name = "",
                PaddingRight = dim(0, 2),
                PaddingLeft = dim(0, 2)
            })

            local line = library:create("Frame", {
                Parent = ScrollingFrame,
                Name = "",
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(1, 0, 0, 1),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            }) library:apply_theme(main_holder, "outline", "BackgroundColor3") 

            path.instance = TextButton 
            path.line = line 
            path.priority = "Neutral"
            path.priority_text = priority_text
            
            
            TextButton.MouseButton1Click:Connect(function()
                if player_name == lp.Name then 
                    return 
                end 

                if selected_button then 
                    selected_button.TextColor3 = themes.preset.text 
                    selected_button = nil 
                end     

                selected_button = player_name 
                player_name.TextColor3 = themes.preset.accent 

                library.selected_player = player_name.Text
                library.config_flags["PLAYERLIST_DROPDOWN"](path.priority_text.Text)

                if cfg.labels.name then 
                    cfg.labels.name.set("User: " .. player_name.Text)
                    cfg.labels.display.set("DisplayName: " .. players[player_name.Text].DisplayName)
                    cfg.labels.uid.set("User Id: " .. players[player_name.Text].UserId)
                end
            end)

            return path 
        end 

        function cfg.search(text)
            for _, player in next, players:GetPlayers() do 
                local name = tostring(player)
                local path = library.playerlist_data[name]

                if path then 
                    local sanity = string.lower(name):match(string.lower(text)) and true or false
                    path.instance.Visible = sanity
                    path.line.Visible = sanity
                end 
            end 
        end 

        function cfg.remove_player(player) 
            local path = library.playerlist_data[tostring(player)]
            path.instance:Destroy() 
            path.line:Destroy() 
            path = nil 
        end 

        function library.prioritize(text) 
            if not library.selected_player then 
                return 
            end 

            local path = library.playerlist_data[library.selected_player]
            path.priority_text.Text = text
            path.priority_text.TextColor3 = patterns[text]
            path.priority = text
        end 

        function library.get_priority(player) 
            local path = library.playerlist_data[tostring(player)]

            if path then 
                return path.priority
            end 
        end 

        players.PlayerAdded:Connect(cfg.create_player)
        players.PlayerRemoving:Connect(cfg.remove_player)
        
        for _, player in players:GetPlayers() do 
            local player_object = cfg.create_player(player.Name)
            insert(library.playerlist_data, player_object)
        end 

        self:textbox({name = "Search", callback = function(txt)
            cfg.search(txt)
        end})
        cfg.labels.name = self:label({name = "Name: ??"})
        cfg.labels.display = self:label({name = "Display Name: ??"})
        cfg.labels.uid = self:label({name = "User Id: ??"})

        return setmetatable(cfg, library)
    end 




local window = library:window({name = os.date('Home |  - %b %d %Y'), size = dim2(0, 750, 0, 782)})

local Aiming = window:tab({name = "Combat"})
local Visuals = window:tab({name = "Visuals"})


Aiming.open_tab() 


do
    local aimingLeft = Aiming:column()
    local aimingRight = Aiming:column()
    local Combat, CombatVisuals = aimingLeft:multi_section({names = {"Combat", "Visuals"}})

    CombatVisuals:toggle({
        name = "Target HUD", 
        flag = "toggle_target_hud", 
        default = false,
    })

    local TargetHUD = library:indicator()
    TargetHUD.set_visible(false)
    TargetHUD.items.Window.Position = dim2(0.5, -161, 1, -280)
    TargetHUD.items.InfoTitle.Text = "Target"
    
    run.RenderStepped:Connect(function(dt)
        if flags.toggle_target_hud and CurrentTarget and CurrentTarget.Character and CurrentTarget.Character:FindFirstChild("Humanoid") then
            TargetHUD.change_profile(CurrentTarget)
            local hum = CurrentTarget.Character.Humanoid
            TargetHUD.change_health((hum.Health / hum.MaxHealth) * 100)
            TargetHUD.set_visible(true)
        else
            TargetHUD.set_visible(false)
        end
    end)

    local Checks, ChecksMisc = aimingRight:multi_section({names = {"Checks", "Misc"}})
    local CharacterMods = aimingRight:section({name = "Character modifications"})
    local camLockToggle = Combat:toggle({name = "Camera Lock", flag = "toggle_camera_lock"})
    camLockToggle:keybind({
        name = "Camera Lock",
        flag = "keybind_camera_lock",
        key = Enum.UserInputType.MouseButton2,
        mode = "hold",
        default = false
    })
    Combat:toggle({name = "Sticky", flag = "toggle_sticky_lock"})
    Checks:toggle({name = "Knocked", flag = "toggle_death_check", default = true})
    Checks:toggle({name = "Visible", flag = "toggle_raycast", default = true})
    Checks:toggle({name = "Team", flag = "toggle_team_check", default = true})
    Checks:toggle({name = "Friend", flag = "toggle_friend_check"})
    Checks:toggle({name = "ForceField", flag = "toggle_forcefield_check"})
    ChecksMisc:toggle({
        name = "Fullbright",
        flag = "toggle_fullbright",
        default = false,
        callback = function(v)
            if v then
                lighting.Brightness = 2
                lighting.ClockTime = 14
                lighting.FogEnd = 100000
                lighting.GlobalShadows = false
                lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
            else
                lighting.Brightness = oldLightingSettings.Brightness
                lighting.ClockTime = oldLightingSettings.ClockTime
                lighting.FogEnd = oldLightingSettings.FogEnd
                lighting.GlobalShadows = oldLightingSettings.GlobalShadows
                lighting.OutdoorAmbient = oldLightingSettings.OutdoorAmbient
            end
        end
    })

    local autoAimConnBegan, autoAimConnEnded
    ChecksMisc:toggle({
        name = "Auto Aim",
        flag = "toggle_auto_aim",
        default = false,
        callback = function(v)
            local vim = game:GetService("VirtualInputManager")
            local uis = game:GetService("UserInputService")
            
            if v then
                -- Check initial state
                if uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
                    vim:SendMouseButtonEvent(0, 0, 1, true, game, 1)
                end
                
                if autoAimConnBegan then autoAimConnBegan:Disconnect() end
                if autoAimConnEnded then autoAimConnEnded:Disconnect() end

                autoAimConnBegan = uis.InputBegan:Connect(function(input, gpe)
                    if gpe then return end
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        vim:SendMouseButtonEvent(0, 0, 1, true, game, 1)
                    end
                end)
                
                autoAimConnEnded = uis.InputEnded:Connect(function(input, gpe)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        vim:SendMouseButtonEvent(0, 0, 1, false, game, 1)
                    end
                end)
            else
                if autoAimConnBegan then autoAimConnBegan:Disconnect() end
                if autoAimConnEnded then autoAimConnEnded:Disconnect() end
                autoAimConnBegan = nil
                autoAimConnEnded = nil
                vim:SendMouseButtonEvent(0, 0, 1, false, game, 1)
            end
        end
    })

    local autoRunConn, autoRunInputConn, autoRunCharConn
    local autoRunToggle = ChecksMisc:toggle({
        name = "Auto Run",
        flag = "toggle_auto_run",
        default = false,
        callback = function(v)
            local vim = game:GetService("VirtualInputManager")
            local rs = game:GetService("RunService")
            local uis = game:GetService("UserInputService")
            local players = game:GetService("Players")
            
            if v then
                -- Reset State
                local isCrouchPaused = false
                local lastToggleTime = 0
                
                if autoRunConn then autoRunConn:Disconnect() end
                if autoRunInputConn then autoRunInputConn:Disconnect() end
                if autoRunCharConn then autoRunCharConn:Disconnect() end
                
                -- 1. Input Listener: Toggle "Pause" when Crouch Key is pressed (Toggle Behavior)
                autoRunInputConn = uis.InputBegan:Connect(function(input, gpe)
                    if gpe then return end
                    if input.KeyCode == Enum.KeyCode.LeftControl or input.KeyCode == Enum.KeyCode.RightControl or input.KeyCode == Enum.KeyCode.C then
                        isCrouchPaused = not isCrouchPaused
                        lastToggleTime = tick()
                    end
                end)
                
                -- 2. Character Listener: Reset state on respawn
                -- This fixes the issue where auto run stops working after death
                autoRunCharConn = players.LocalPlayer.CharacterAdded:Connect(function(newChar)
                    -- Wait for the character to be ready and controllable
                    -- We use task.delay to avoid yielding the main thread if this was in a synchronous context
                    task.delay(0.5, function()
                        if newChar and newChar:FindFirstChild("Humanoid") then
                            isCrouchPaused = false -- Reset to running
                            lastToggleTime = tick()
                            -- Force release momentarily to reset input state for the new character
                            vim:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
                        end
                    end)
                end)
                
                -- 3. Loop: Apply Shift based on state
                autoRunConn = rs.RenderStepped:Connect(function()
                    if isCrouchPaused then
                        -- Crouching: Force Shift Release
                        vim:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
                    else
                        -- Running: Force Shift Hold
                        -- Small delay after toggling uncrouch to allow animation to start
                        if tick() - lastToggleTime > 0.15 then
                            vim:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
                        else
                            vim:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
                        end
                    end
                end)
            else
                if autoRunConn then autoRunConn:Disconnect() end
                autoRunConn = nil
                
                if autoRunInputConn then autoRunInputConn:Disconnect() end
                autoRunInputConn = nil
                
                if autoRunCharConn then autoRunCharConn:Disconnect() end
                autoRunCharConn = nil
                
                vim:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
            end
        end
    })
    autoRunToggle:keybind({
        name = "Auto Run",
        flag = "keybind_auto_run",
        key = nil,
        mode = "toggle",
        default = false,
        callback = function(active)
            autoRunToggle.set(active)
        end
    })
    local PlayersService = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local antiVoidToggle -- Forward declaration
    local noclipConn
    local noclipActive = false
    local noclipParts = {}
    local noclipToggle = ChecksMisc:toggle({
        name = "Noclip",
        flag = "toggle_noclip",
        default = false,
        callback = function(v)
            noclipActive = v
            if antiVoidToggle and antiVoidToggle.set_element_visible then
                antiVoidToggle.set_element_visible(v)
            end
            if v then
                if noclipConn then noclipConn:Disconnect() end
                noclipConn = RunService.Stepped:Connect(function()
                    local char = PlayersService.LocalPlayer.Character
                    if noclipActive and char then
                        for _, part in ipairs(char:GetDescendants()) do
                            if part:IsA("BasePart") and part.CanCollide then
                                part.CanCollide = false
                                noclipParts[part] = true
                            end
                        end
                    end
                end)
            else
                if noclipConn then noclipConn:Disconnect() end
                noclipConn = nil
                for p,_ in pairs(noclipParts) do
                    if p and p.Parent then
                        p.CanCollide = true
                    end
                end
                noclipParts = {}
            end
        end
    })
    noclipToggle:keybind({
        name = "Noclip",
        flag = "keybind_noclip",
        key = nil,
        mode = "toggle",
        default = false,
        callback = function(active)
            noclipToggle.set(active)
        end
    })

    local antiVoidConn
    local antiVoidActive = false
    local voidTiles = {}
    local tileSize = Vector3.new(12, 1, 12)
    local antiVoidFloorY = nil
    local catchPlane
    local lastSafeCFrame
    local noGroundTicks = 0
    local voidThresholdY = -200
    antiVoidToggle = ChecksMisc:toggle({
        name = "Anti Void",
        flag = "toggle_anti_void",
        default = false,
        callback = function(v)
            antiVoidActive = v
            if v then
                local player = PlayersService.LocalPlayer
                local hrp
                local function setup(character)
                    hrp = character:WaitForChild("HumanoidRootPart")
                end
                if player.Character then setup(player.Character) end
                player.CharacterAdded:Connect(setup)
                if antiVoidConn then antiVoidConn:Disconnect() end
                antiVoidConn = RunService.Heartbeat:Connect(function()
                    if not antiVoidActive or not hrp then return end
                    local params = RaycastParams.new()
                    params.FilterType = Enum.RaycastFilterType.Blacklist
                    params.FilterDescendantsInstances = {player.Character}
                    local result = workspace:Raycast(hrp.Position, Vector3.new(0, -1000, 0), params)
                    if result then
                        lastSafeCFrame = hrp.CFrame
                        noGroundTicks = 0
                    else
                        noGroundTicks = noGroundTicks + 1
                        local gx = math.floor(hrp.Position.X / tileSize.X)
                        local gz = math.floor(hrp.Position.Z / tileSize.Z)
                        local key = tostring(gx) .. "_" .. tostring(gz)
                        if not antiVoidFloorY then
                            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
                            local hip = humanoid and humanoid.HipHeight or 2
                            antiVoidFloorY = hrp.Position.Y - (hip + 4)
                        end
                        if not voidTiles[key] then
                            local cx = gx * tileSize.X + tileSize.X/2
                            local cz = gz * tileSize.Z + tileSize.Z/2
                            local p = Instance.new("Part")
                            p.Name = "AntiVoidTile"
                            p.Size = tileSize
                            p.Position = Vector3.new(cx, antiVoidFloorY, cz)
                            p.Anchored = true
                            p.CanCollide = true
                            p.Transparency = 1
                            p.Parent = workspace
                            voidTiles[key] = p
                        end
                        if not catchPlane then
                            catchPlane = Instance.new("Part")
                            catchPlane.Name = "AntiVoidFloor"
                            catchPlane.Size = Vector3.new(1000, 1, 1000)
                            local targetY = antiVoidFloorY or math.min(hrp.Position.Y - 10, voidThresholdY)
                            catchPlane.Position = Vector3.new(hrp.Position.X, targetY, hrp.Position.Z)
                            catchPlane.Anchored = true
                            catchPlane.CanCollide = true
                            catchPlane.Transparency = 1
                            catchPlane.Parent = workspace
                            else
                            catchPlane.Position = Vector3.new(hrp.Position.X, catchPlane.Position.Y, hrp.Position.Z)
                        end
                        if hrp.Position.Y < (catchPlane.Position.Y - 5) or hrp.Position.Y < voidThresholdY then
                            hrp.CFrame = CFrame.new(hrp.Position.X, catchPlane.Position.Y + 3, hrp.Position.Z)
                        end
                    end
                end)
            else
                if antiVoidConn then antiVoidConn:Disconnect() end
                antiVoidConn = nil
                antiVoidFloorY = nil
                noGroundTicks = 0
                lastSafeCFrame = nil
                if catchPlane then
                    catchPlane:Destroy()
                    catchPlane = nil
                end
                for _, p in pairs(voidTiles) do
                    p:Destroy()
                end
                voidTiles = {}
            end
        end
    })
    
    -- Hide Anti Void by default
    if antiVoidToggle.set_element_visible then
        antiVoidToggle.set_element_visible(false)
    end

    local spinbotConn
    local spinbotActive = false
    local spinbotSpeed = 20
    
    local spinbotToggle = ChecksMisc:toggle({
        name = "Spinbot",
        flag = "toggle_spinbot",
        default = false,
        callback = function(v)
            spinbotActive = v
            local char = PlayersService.LocalPlayer.Character
            if v then
                if char then
                     local hum = char:FindFirstChild("Humanoid")
                     if hum then hum.AutoRotate = false end
                end
                if spinbotConn then spinbotConn:Disconnect() end
                spinbotConn = RunService.Stepped:Connect(function()
                    local char = PlayersService.LocalPlayer.Character
                    if not char then return end
                    local hrp = char:FindFirstChild("HumanoidRootPart")
                    local hum = char:FindFirstChild("Humanoid")
                    if hum then hum.AutoRotate = false end
                    if hrp then
                        local oldVel = hrp.AssemblyLinearVelocity
                        hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(spinbotSpeed), 0)
                        hrp.AssemblyLinearVelocity = oldVel
                    end
                end)
            else
                if spinbotConn then spinbotConn:Disconnect() end
                spinbotConn = nil
                if char then
                     local hum = char:FindFirstChild("Humanoid")
                     if hum then hum.AutoRotate = true end
                end
            end
        end
    })
    ChecksMisc:slider({
        name = "Spinbot Speed",
        flag = "spinbot_speed",
        min = -50,
        max = 50,
        default = 20,
        callback = function(v)
            spinbotSpeed = v
        end
    })
    spinbotToggle:keybind({
        name = "Spinbot",
        flag = "keybind_spinbot",
        key = nil,
        mode = "toggle",
        default = false,
        callback = function(active)
            spinbotToggle.set(active)
        end
    })
    -- Set Spinbot text color to red
    if spinbotToggle.text_label then
        spinbotToggle.text_label.TextColor3 = Color3.fromRGB(255, 80, 80)
    end
    
    
    do
        local SpeedEnabled = false
        local SpeedAmount = 16
        local SpeedToggle = CharacterMods:toggle({
            name = "Walk Speed",
            flag = "BypassWalkSpeed",
            default = false,
            callback = function(v)
                SpeedEnabled = v
            end
        })
        SpeedToggle:keybind({
            name = "Speed",
            flag = "SpeedKeybind",
            key = nil,
            mode = "toggle",
            default = false,
            callback = function(active)
                SpeedToggle.set(active)
            end
        })

        CharacterMods:slider({
            name = "Speed Amount",
            flag = "SpeedAmount",
            min = 16,
            max = 50,
            default = 16,
            callback = function(v)
                SpeedAmount = v
            end
        })
        game:GetService("RunService").RenderStepped:Connect(function()
            if SpeedEnabled then
                local player = game:GetService("Players").LocalPlayer
                local character = player.Character
                local rootPart
                if character then
                    rootPart = character:FindFirstChild("HumanoidRootPart")
                end
                local humanoid
                if character then
                    humanoid = character:FindFirstChildWhichIsA("Humanoid")
                end
                if rootPart and (humanoid and humanoid.MoveDirection.Magnitude > 0) then
                    rootPart.Velocity = humanoid.MoveDirection * SpeedAmount + Vector3.new(0, rootPart.Velocity.Y, 0)
                end
            end
        end)
    end

    do
        local FlyEnabled = false
        local FlySpeed = 40
        local FlyConnection = nil
        local FlyToggle = CharacterMods:toggle({
            name = "Fly",
            flag = "FlyToggle",
            default = false,
            callback = function(v)
                FlyEnabled = v
                local player = game:GetService("Players").LocalPlayer
                local character = player.Character or player.CharacterAdded:Wait()
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                local rootPart = character:FindFirstChild("HumanoidRootPart")
                local uis = game:GetService("UserInputService")
                local camera = workspace.CurrentCamera

                if humanoid and rootPart then
                    if FlyEnabled then
                        humanoid.PlatformStand = true
                        FlyConnection = game:GetService("RunService").RenderStepped:Connect(function()
                            rootPart.CFrame = CFrame.new(rootPart.Position, rootPart.Position + camera.CFrame.LookVector)
                            local moveDir = Vector3.zero
                            if uis:IsKeyDown(Enum.KeyCode.W) then
                                moveDir = moveDir + camera.CFrame.LookVector
                            end
                            if uis:IsKeyDown(Enum.KeyCode.S) then
                                moveDir = moveDir - camera.CFrame.LookVector
                            end
                            if uis:IsKeyDown(Enum.KeyCode.A) then
                                moveDir = moveDir - camera.CFrame.RightVector
                            end
                            if uis:IsKeyDown(Enum.KeyCode.D) then
                                moveDir = moveDir + camera.CFrame.RightVector
                            end
                            if uis:IsKeyDown(Enum.KeyCode.Space) then
                                moveDir = moveDir + camera.CFrame.UpVector
                            end
                            if uis:IsKeyDown(Enum.KeyCode.LeftControl) then
                                moveDir = moveDir - camera.CFrame.UpVector
                            end
                            if moveDir.Magnitude <= 0 then
                                rootPart.Velocity = Vector3.zero
                            else
                                rootPart.Velocity = moveDir.Unit * FlySpeed
                            end
                        end)
                    else
                        if FlyConnection then
                            FlyConnection:Disconnect()
                        end
                        humanoid.PlatformStand = false
                        rootPart.Velocity = Vector3.zero
                    end
                end
            end
        })
        FlyToggle:keybind({
            name = "Fly",
            flag = "FlyKeybind",
            key = nil,
            mode = "toggle",
            default = false,
            callback = function(active)
                FlyToggle.set(active)
            end
        })
        CharacterMods:slider({
            name = "Fly Speed",
            flag = "FlySpeed",
            min = 20,
            max = 45,
            default = 40,
            callback = function(v)
                FlySpeed = v
            end
        })
    end



    local Divider = library:create("Frame", {
        Parent = CombatVisuals.holder,
        Name = "Divider",
        Size = dim2(1, -20, 0, 1),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.accent
    })
    library:apply_theme(Divider, "accent", "BackgroundColor3")

    CombatVisuals:toggle({name = "Highlight Target", flag = "toggle_aimbot_highlight"})
    CombatVisuals:toggle({name = "Show Name", flag = "toggle_target_name"})
    CombatVisuals:toggle({name = "Show Distance", flag = "toggle_target_distance"})
    CombatVisuals:toggle({name = "Show Health", flag = "toggle_target_health"})
    local fovSlider
    local DottedToggle
    local DottedDivider
    local RequiredWeaponToggle
    local fovToggle = Combat:toggle({
        name = "FOV Visible",
        flag = "toggle_fov_circle",
        default = false,
        callback = function(v)
            if v then
                FOVCircle = createDraw("Circle", {
                    Thickness = 0.5,
                    NumSides = 64,
                    Color = FOVColor,
                    Transparency = FOVAlpha,
                    Filled = false,
                    Visible = true
                })
                FOVOutline = createDraw("Circle", {
                    Thickness = 4,
                    NumSides = 64,
                    Color = Color3.fromRGB(0,0,0),
                    Transparency = 0,
                    Filled = false,
                    Visible = true
                })
            else
                if FOVCircle then
                    FOVCircle:Remove()
                    FOVCircle = nil
                end
                if FOVOutline then
                    FOVOutline:Remove()
                    FOVOutline = nil
                end
            end
            if fovSlider then
                fovSlider.set_element_visible(v)
            end
            if DottedToggle then
                DottedToggle.set_element_visible(v)
            end
            if DottedDivider then
                DottedDivider.Visible = v
            end
            if RequiredWeaponToggle then
                RequiredWeaponToggle.set_element_visible(v)
            end
        end
    })
    DottedDivider = library:create("Frame", {
        Parent = Combat.holder,
        Name = "DottedDivider",
        Size = UDim2.new(1, -8, 0, 2),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.accent,
        Visible = false
    })
    library:apply_theme(DottedDivider, "accent", "BackgroundColor3")
    RequiredWeaponToggle = Combat:toggle({
        name = "Required Weapon",
        flag = "toggle_required_weapon",
        default = false,
        callback = function(v) end
    })
    RequiredWeaponToggle.set_element_visible(false)
    DottedToggle = Combat:toggle({
        name = "Dotted",
        flag = "toggle_dotted_fov",
        default = false,
        callback = function(v) end
    })
    DottedToggle.set_element_visible(false)
    fovToggle:colorpicker({
        name = "FOV Color",
        flag = "colorpicker_fov_circle",
        color = Color3.fromRGB(255,255,255),
        callback = function(color, alpha)
            FOVColor = color or Color3.fromRGB(255,255,255)
            FOVAlpha = alpha or 1
            if FOVCircle then
                FOVCircle.Color = FOVColor
                FOVCircle.Transparency = FOVAlpha
            end
        end
    })
    fovSlider = Combat:slider({
        name = "FOV Radius",
        flag = "slider_fov",
        suffix = "",
        min = 5, max = 100, default = 45,
        callback = function(v)
            TargetFOV = v
            if FOVCircle then
                FOVCircle.Radius = v * 5
            end
            if FOVOutline then
                FOVOutline.Radius = (v * 5) + 4
            end
        end
    })
    fovSlider.set_element_visible(false)
    Combat:dropdown({
        name = "Aim Part",
        flag = "dropdown_aim_part",
        items = {"Head", "Torso"},
        default = "Head",
        callback = function(v)
            selectedPart = (v == "Torso") and "UpperTorso" or "Head"
        end
    })
    local divider = library:create("Frame", {
        Parent = Combat.holder,
        Name = "",
        Size = UDim2.new(1, -8, 0, 2),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.accent
    })
    library:apply_theme(divider, "accent", "BackgroundColor3")
    local silentToggle = Combat:toggle({name = "Silent", flag = "toggle_silent"})
    silentToggle:keybind({
        name = "Silent Aim",
        flag = "keybind_silent_aim",
        mode = "hold",
        key = Enum.UserInputType.MouseButton2,
        default = false
    })
    
    local silentFovSlider
    local dottedSilentFovToggle
    local dottedSilentFovDivider
    local silentFovToggle = Combat:toggle({
        name = "FOV Visible",
        flag = "toggle_fov_circle_silent",
        default = false,
        callback = function(v)
            if v then
                SilentFOVCircle = createDraw("Circle", {
                    Thickness = 0.5,
                    NumSides = 64,
                    Color = SilentFOVColor or Color3.fromRGB(255,255,255),
                    Transparency = SilentFOVAlpha or 1,
                    Filled = false,
                    Visible = true
                })
                SilentFOVOutline = createDraw("Circle", {
                    Thickness = 4,
                    NumSides = 64,
                    Color = Color3.fromRGB(0,0,0),
                    Transparency = 0,
                    Filled = false,
                    Visible = true
                })
            else
                if SilentFOVCircle then
                    SilentFOVCircle:Remove()
                    SilentFOVCircle = nil
                end
                if SilentFOVOutline then
                    SilentFOVOutline:Remove()
                    SilentFOVOutline = nil
                end
            end
            if silentFovSlider then
                silentFovSlider.set_element_visible(v)
            end
            if dottedSilentFovToggle then
                dottedSilentFovToggle.set_element_visible(v)
            end
            if dottedSilentFovDivider then
                dottedSilentFovDivider.Visible = v
            end
        end
    })
    dottedSilentFovDivider = library:create("Frame", {
        Parent = Combat.holder,
        Name = "DottedSilentFOVDivider",
        Size = UDim2.new(1, -8, 0, 2),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.accent,
        Visible = false
    })
    library:apply_theme(dottedSilentFovDivider, "accent", "BackgroundColor3")
    dottedSilentFovToggle = Combat:toggle({
        name = "Dotted",
        flag = "toggle_dotted_fov_silent",
        default = false,
        callback = function(v) end
    })
    dottedSilentFovToggle.set_element_visible(false)
    silentFovToggle:colorpicker({
        name = "FOV Color",
        flag = "colorpicker_fov_circle_silent",
        color = Color3.fromRGB(255,255,255),
        callback = function(color, alpha)
            SilentFOVColor = color or Color3.fromRGB(255,255,255)
            SilentFOVAlpha = alpha or 1
            if SilentFOVCircle then
                SilentFOVCircle.Color = SilentFOVColor
                SilentFOVCircle.Transparency = SilentFOVAlpha
            end
        end
    })
    silentFovSlider = Combat:slider({
        name = "FOV Radius",
        flag = "slider_fov_silent",
        suffix = "",
        min = 5, max = 100, default = 45,
        callback = function(v)
            SilentTargetFOV = v
            if SilentFOVCircle then
                SilentFOVCircle.Radius = v * 5
            end
            if SilentFOVOutline then
                SilentFOVOutline.Radius = (v * 5) + 4
            end
        end
    })
    silentFovSlider.set_element_visible(false)

    local visualsLeft = Visuals:column()
    local visualsRight = Visuals:column()
    local MiscVisuals = visualsRight:section({name = "Misc Visuals"})
    MiscVisuals:slider({
        name = "ESP Distance",
        flag = "slider_esp_distance",
        suffix = "m",
        min = 100, max = 1000, default = 500,
        callback = function(v)
            ESPRenderDistance = v
        end
    })
    MiscVisuals:slider({
        name = "SCP Distance",
        flag = "slider_scp_distance",
        suffix = "m",
        min = 100, max = 1000, default = 500,
        callback = function(v)
            SCPRenderDistance = v
        end
    })
    MiscVisuals:dropdown({
        name = "Text Font",
        flag = "dropdown_visuals_text_font",
        items = {
            "Arcade","BuilderSans","Code","Pixel","Plex","Fantasy","FredokaOne","Gotham","GothamBlack","Minecraftia","Jura","Roboto","RobotoMono","SourceSans","SourceSansBold","Verdana"
        },
        multi = false,
        default = "SourceSansBold",
        callback = function(state)
            VisualsTextFontName = state
            -- Removed SCPNameCache update loop to prevent interference
            for p, cache in pairs(ESPCache) do
                if cache then
                    local df = DrawingFontFromName(state)
                    if cache.name_text then cache.name_text.Font = df end
                    if cache.dist_text then cache.dist_text.Font = df end
                end
            end
            DrawTargetName.Font = DrawingFontFromName(state)
            DrawTargetHealth.Font = DrawingFontFromName(state)
        end
    })
    MiscVisuals:slider({
        name = "Text Size",
        flag = "slider_visuals_text_size",
        min = 5, max = 15, default = 13,
        callback = function(v)
            VisualsTextSize = v
            -- Removed SCPNameCache update loop to prevent interference
            for _, cache in pairs(ESPCache) do
                if cache then
                    if cache.name_text then cache.name_text.Size = v end
                    if cache.dist_text then cache.dist_text.Size = v end
                end
            end
            DrawTargetName.Size = v
            DrawTargetHealth.Size = v
        end
    })

    local divider = library:create("Frame", {
        Parent = MiscVisuals.holder,
        Name = "Divider",
        Size = UDim2.new(1, 0, 0, 1),
        BackgroundColor3 = themes.preset.accent,
        BorderSizePixel = 0
    })
    library:apply_theme(divider, "accent", "BackgroundColor3")

    MiscVisuals:slider({
        name = "ESP FPS",
        flag = "slider_esp_fps",
        suffix = "fps",
        min = 1, max = 144, default = 60,
        callback = function(v)
            espUpdateInterval = 1/v
            skeletonUpdateInterval = 1/v
        end
    })
    local ESP, SCP = visualsLeft:multi_section({names = {"ESP", "SCP"}})
    SCP:toggle({
        name = "Highlight", 
        flag = "toggle_scp_esp",
        callback = function(v)
            if library.visible_flags["toggle_scp_name"] then
                library.visible_flags["toggle_scp_name"](v)
            end
        end
    })
    SCP:toggle({name = "Name", flag = "toggle_scp_name", visible = flags["toggle_scp_esp"]})
    ESP:toggle({
        name = "Skeleton",
        flag = "toggle_skeleton_esp",
        callback = function(v)
            flags["Skeleton"] = v
            if window.esp_section and window.esp_section.refresh_elements then
                window.esp_section.refresh_elements()
            end
        end
    })
    ESP:toggle({
        name = "Names",
        flag = "esp_names",
        callback = function(v)
            flags["Names"] = v
            if window.esp_section and window.esp_section.refresh_elements then
                window.esp_section.refresh_elements()
            end
        end
    })
    ESP:toggle({
        name = "Distance",
        flag = "esp_distance_text",
        callback = function(v)
            flags["Distance"] = v
            if window.esp_section and window.esp_section.refresh_elements then
                window.esp_section.refresh_elements()
            end
        end
    })
    ESP:toggle({
        name = "Chams",
        flag = "esp_chams",
        callback = function(v)
            flags["Chams"] = v
            if window.esp_section and window.esp_section.refresh_elements then
                window.esp_section.refresh_elements()
            end
        end
    })
end



library:config_list_update()
for index, value in themes.preset do 
pcall(function()
    library:update_theme(index, value)
end)
end
task.wait()
library.old_config = library:get_config()
